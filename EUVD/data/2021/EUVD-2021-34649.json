{"id": "EUVD-2021-34649", "enisaUuid": "c2b4e255-9dac-3de0-b6bd-529957f00d69", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\njffs2: fix use-after-free in jffs2_clear_xattr_subsystem\n\nWhen we mount a jffs2 image, assume that the first few blocks of\nthe image are normal and contain at least one xattr-related inode,\nbut the next block is abnormal. As a result, an error is returned\nin jffs2_scan_eraseblock(). jffs2_clear_xattr_subsystem() is then\ncalled in jffs2_build_filesystem() and then again in\njffs2_do_fill_super().\n\nFinally we can observe the following report:\n ==================================================================\n BUG: KASAN: use-after-free in jffs2_clear_xattr_subsystem+0x95/0x6ac\n Read of size 8 at addr ffff8881243384e0 by task mount/719\n\n Call Trace:\n  dump_stack+0x115/0x16b\n  jffs2_clear_xattr_subsystem+0x95/0x6ac\n  jffs2_do_fill_super+0x84f/0xc30\n  jffs2_fill_super+0x2ea/0x4c0\n  mtd_get_sb+0x254/0x400\n  mtd_get_sb_by_nr+0x4f/0xd0\n  get_tree_mtd+0x498/0x840\n  jffs2_get_tree+0x25/0x30\n  vfs_get_tree+0x8d/0x2e0\n  path_mount+0x50f/0x1e50\n  do_mount+0x107/0x130\n  __se_sys_mount+0x1c5/0x2f0\n  __x64_sys_mount+0xc7/0x160\n  do_syscall_64+0x45/0x70\n  entry_SYSCALL_64_after_hwframe+0x44/0xa9\n\n Allocated by task 719:\n  kasan_save_stack+0x23/0x60\n  __kasan_kmalloc.constprop.0+0x10b/0x120\n  kasan_slab_alloc+0x12/0x20\n  kmem_cache_alloc+0x1c0/0x870\n  jffs2_alloc_xattr_ref+0x2f/0xa0\n  jffs2_scan_medium.cold+0x3713/0x4794\n  jffs2_do_mount_fs.cold+0xa7/0x2253\n  jffs2_do_fill_super+0x383/0xc30\n  jffs2_fill_super+0x2ea/0x4c0\n [...]\n\n Freed by task 719:\n  kmem_cache_free+0xcc/0x7b0\n  jffs2_free_xattr_ref+0x78/0x98\n  jffs2_clear_xattr_subsystem+0xa1/0x6ac\n  jffs2_do_mount_fs.cold+0x5e6/0x2253\n  jffs2_do_fill_super+0x383/0xc30\n  jffs2_fill_super+0x2ea/0x4c0\n [...]\n\n The buggy address belongs to the object at ffff8881243384b8\n  which belongs to the cache jffs2_xattr_ref of size 48\n The buggy address is located 40 bytes inside of\n  48-byte region [ffff8881243384b8, ffff8881243384e8)\n [...]\n ==================================================================\n\nThe triggering of the BUG is shown in the following stack:\n-----------------------------------------------------------\njffs2_fill_super\n  jffs2_do_fill_super\n    jffs2_do_mount_fs\n      jffs2_build_filesystem\n        jffs2_scan_medium\n          jffs2_scan_eraseblock        <--- ERROR\n        jffs2_clear_xattr_subsystem    <--- free\n    jffs2_clear_xattr_subsystem        <--- free again\n-----------------------------------------------------------\n\nAn error is returned in jffs2_do_mount_fs(). If the error is returned\nby jffs2_sum_init(), the jffs2_clear_xattr_subsystem() does not need to\nbe executed. If the error is returned by jffs2_build_filesystem(), the\njffs2_clear_xattr_subsystem() also does not need to be executed again.\nSo move jffs2_clear_xattr_subsystem() from 'out_inohash' to 'out_root'\nto fix this UAF problem.", "datePublished": "2025-02-26T01:54:20", "dateUpdated": "2025-02-26T01:54:20", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/9150cb625b46f68d524f4cfd491f1aafc23e10a9", "https://git.kernel.org/stable/c/3bd2454162ec6bbb5503233c804fce6e4b6dcec5", "https://git.kernel.org/stable/c/c3b07c875fa8f906f932976460fd14798596f101", "https://git.kernel.org/stable/c/30bf7244acf32f19cb722c39f7bc1c2a9f300422", "https://git.kernel.org/stable/c/7bb7428dd73991bf4b3a7a61b493ca50046c2b13", "https://git.kernel.org/stable/c/7a75740206af5f17e9f3efa384211cba70213da1", "https://git.kernel.org/stable/c/22327bd7988f21de3a53c1373f3b81542bfe1f44", "https://git.kernel.org/stable/c/8c0f024f29e055840a5a89fe23b96ae3f921afed", "https://git.kernel.org/stable/c/4c7c44ee1650677fbe89d86edbad9497b7679b5c"], "aliases": ["CVE-2021-47656"], "assigner": "Linux", "epss": 0.03, "enisaIdProduct": [{"id": "163ad556-5389-3045-afb6-94c36ce1b066", "product": {"name": "Linux"}, "product_version": "patch: 5.16.19"}, {"id": "1f8bc701-36e0-3f7c-a1de-d23898d3405d", "product": {"name": "Linux"}, "product_version": "aa98d7cf59b5b0764d3502662053489585faf2fe <9150cb625b46f68d524f4cfd491f1aafc23e10a9"}, {"id": "23eec5ea-09ac-3c3e-8e7d-9a5f8a6872c0", "product": {"name": "Linux"}, "product_version": "patch: 5.17.2"}, {"id": "259cd261-4e4c-375a-8bb9-d75297b0c129", "product": {"name": "Linux"}, "product_version": "aa98d7cf59b5b0764d3502662053489585faf2fe <22327bd7988f21de3a53c1373f3b81542bfe1f44"}, {"id": "2b84dd8f-2093-3ae6-aa1e-7276954fb6f8", "product": {"name": "Linux"}, "product_version": "aa98d7cf59b5b0764d3502662053489585faf2fe <7bb7428dd73991bf4b3a7a61b493ca50046c2b13"}, {"id": "38443a14-03c9-393f-970b-8a98b6997583", "product": {"name": "Linux"}, "product_version": "patch: 4.9.311"}, {"id": "4c6704cb-ce1a-340b-8314-f1dfe220d507", "product": {"name": "Linux"}, "product_version": "patch: 4.19.238"}, {"id": "53ff5db8-8c44-384f-a4c4-f2533857cda0", "product": {"name": "Linux"}, "product_version": "2.6.18"}, {"id": "5981852b-a1aa-3582-be71-87ca228f9453", "product": {"name": "Linux"}, "product_version": "aa98d7cf59b5b0764d3502662053489585faf2fe <4c7c44ee1650677fbe89d86edbad9497b7679b5c"}, {"id": "614d88b4-48e0-3735-bd3c-5a145789a927", "product": {"name": "Linux"}, "product_version": "aa98d7cf59b5b0764d3502662053489585faf2fe <c3b07c875fa8f906f932976460fd14798596f101"}, {"id": "62b31857-084c-3dc6-8fe5-f6ce49e90223", "product": {"name": "Linux"}, "product_version": "aa98d7cf59b5b0764d3502662053489585faf2fe <30bf7244acf32f19cb722c39f7bc1c2a9f300422"}, {"id": "6490dabe-ffc0-350a-a8af-f450b54088d4", "product": {"name": "Linux"}, "product_version": "patch: 5.18"}, {"id": "8231fa83-57ee-3bc6-b572-ce4c309fff02", "product": {"name": "Linux"}, "product_version": "aa98d7cf59b5b0764d3502662053489585faf2fe <8c0f024f29e055840a5a89fe23b96ae3f921afed"}, {"id": "986b7c59-22b6-3b1c-b3c3-07cc6601f8ed", "product": {"name": "Linux"}, "product_version": "patch: 4.14.276"}, {"id": "9bca35c5-f391-3374-913a-a4d7cb0a51b2", "product": {"name": "Linux"}, "product_version": "patch: 5.15.33"}, {"id": "b86a34f7-34b7-388b-90af-c713ed9d7677", "product": {"name": "Linux"}, "product_version": "aa98d7cf59b5b0764d3502662053489585faf2fe <3bd2454162ec6bbb5503233c804fce6e4b6dcec5"}, {"id": "b9adcab4-d20f-3fa1-b282-30cd62c97ddc", "product": {"name": "Linux"}, "product_version": "patch: 5.4.189"}, {"id": "c218d85c-e78a-3288-9d5f-837a8bdd0c56", "product": {"name": "Linux"}, "product_version": "patch: 5.10.110"}, {"id": "c682d206-0aa7-3e96-a7f2-5398ff234325", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "d2fe0e16-7be5-3dcf-8510-cd3988a4031b", "product": {"name": "Linux"}, "product_version": "aa98d7cf59b5b0764d3502662053489585faf2fe <7a75740206af5f17e9f3efa384211cba70213da1"}], "enisaIdVendor": [{"id": "576253ec-4608-33bb-96a7-71032d3b3f1d", "vendor": {"name": "Linux"}}], "isExploited": false}