{"id": "EUVD-2022-55763", "enisaUuid": "c97d062d-e6a3-3ead-871c-9dc43f449ad4", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nnet/mlx5: Fix possible use-after-free in async command interface\n\nmlx5_cmd_cleanup_async_ctx should return only after all its callback\nhandlers were completed. Before this patch, the below race between\nmlx5_cmd_cleanup_async_ctx and mlx5_cmd_exec_cb_handler was possible and\nlead to a use-after-free:\n\n1. mlx5_cmd_cleanup_async_ctx is called while num_inflight is 2 (i.e.\n   elevated by 1, a single inflight callback).\n2. mlx5_cmd_cleanup_async_ctx decreases num_inflight to 1.\n3. mlx5_cmd_exec_cb_handler is called, decreases num_inflight to 0 and\n   is about to call wake_up().\n4. mlx5_cmd_cleanup_async_ctx calls wait_event, which returns\n   immediately as the condition (num_inflight == 0) holds.\n5. mlx5_cmd_cleanup_async_ctx returns.\n6. The caller of mlx5_cmd_cleanup_async_ctx frees the mlx5_async_ctx\n   object.\n7. mlx5_cmd_exec_cb_handler goes on and calls wake_up() on the freed\n   object.\n\nFix it by syncing using a completion object. Mark it completed when\nnum_inflight reaches 0.\n\nTrace:\n\nBUG: KASAN: use-after-free in do_raw_spin_lock+0x23d/0x270\nRead of size 4 at addr ffff888139cd12f4 by task swapper/5/0\n\nCPU: 5 PID: 0 Comm: swapper/5 Not tainted 6.0.0-rc3_for_upstream_debug_2022_08_30_13_10 #1\nHardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS rel-1.13.0-0-gf21b5a4aeb02-prebuilt.qemu.org 04/01/2014\nCall Trace:\n <IRQ>\n dump_stack_lvl+0x57/0x7d\n print_report.cold+0x2d5/0x684\n ? do_raw_spin_lock+0x23d/0x270\n kasan_report+0xb1/0x1a0\n ? do_raw_spin_lock+0x23d/0x270\n do_raw_spin_lock+0x23d/0x270\n ? rwlock_bug.part.0+0x90/0x90\n ? __delete_object+0xb8/0x100\n ? lock_downgrade+0x6e0/0x6e0\n _raw_spin_lock_irqsave+0x43/0x60\n ? __wake_up_common_lock+0xb9/0x140\n __wake_up_common_lock+0xb9/0x140\n ? __wake_up_common+0x650/0x650\n ? destroy_tis_callback+0x53/0x70 [mlx5_core]\n ? kasan_set_track+0x21/0x30\n ? destroy_tis_callback+0x53/0x70 [mlx5_core]\n ? kfree+0x1ba/0x520\n ? do_raw_spin_unlock+0x54/0x220\n mlx5_cmd_exec_cb_handler+0x136/0x1a0 [mlx5_core]\n ? mlx5_cmd_cleanup_async_ctx+0x220/0x220 [mlx5_core]\n ? mlx5_cmd_cleanup_async_ctx+0x220/0x220 [mlx5_core]\n mlx5_cmd_comp_handler+0x65a/0x12b0 [mlx5_core]\n ? dump_command+0xcc0/0xcc0 [mlx5_core]\n ? lockdep_hardirqs_on_prepare+0x400/0x400\n ? cmd_comp_notifier+0x7e/0xb0 [mlx5_core]\n cmd_comp_notifier+0x7e/0xb0 [mlx5_core]\n atomic_notifier_call_chain+0xd7/0x1d0\n mlx5_eq_async_int+0x3ce/0xa20 [mlx5_core]\n atomic_notifier_call_chain+0xd7/0x1d0\n ? irq_release+0x140/0x140 [mlx5_core]\n irq_int_handler+0x19/0x30 [mlx5_core]\n __handle_irq_event_percpu+0x1f2/0x620\n handle_irq_event+0xb2/0x1d0\n handle_edge_irq+0x21e/0xb00\n __common_interrupt+0x79/0x1a0\n common_interrupt+0x78/0xa0\n </IRQ>\n <TASK>\n asm_common_interrupt+0x22/0x40\nRIP: 0010:default_idle+0x42/0x60\nCode: c1 83 e0 07 48 c1 e9 03 83 c0 03 0f b6 14 11 38 d0 7c 04 84 d2 75 14 8b 05 eb 47 22 02 85 c0 7e 07 0f 00 2d e0 9f 48 00 fb f4 <c3> 48 c7 c7 80 08 7f 85 e8 d1 d3 3e fe eb de 66 66 2e 0f 1f 84 00\nRSP: 0018:ffff888100dbfdf0 EFLAGS: 00000242\nRAX: 0000000000000001 RBX: ffffffff84ecbd48 RCX: 1ffffffff0afe110\nRDX: 0000000000000004 RSI: 0000000000000000 RDI: ffffffff835cc9bc\nRBP: 0000000000000005 R08: 0000000000000001 R09: ffff88881dec4ac3\nR10: ffffed1103bd8958 R11: 0000017d0ca571c9 R12: 0000000000000005\nR13: ffffffff84f024e0 R14: 0000000000000000 R15: dffffc0000000000\n ? default_idle_call+0xcc/0x450\n default_idle_call+0xec/0x450\n do_idle+0x394/0x450\n ? arch_cpu_idle_exit+0x40/0x40\n ? do_idle+0x17/0x450\n cpu_startup_entry+0x19/0x20\n start_secondary+0x221/0x2b0\n ? set_cpu_sibling_map+0x2070/0x2070\n secondary_startup_64_no_verify+0xcd/0xdb\n </TASK>\n\nAllocated by task 49502:\n kasan_save_stack+0x1e/0x40\n __kasan_kmalloc+0x81/0xa0\n kvmalloc_node+0x48/0xe0\n mlx5e_bulk_async_init+0x35/0x110 [mlx5_core]\n mlx5e_tls_priv_tx_list_cleanup+0x84/0x3e0 [mlx5_core]\n mlx5e_ktls_cleanup_tx+0x38f/0x760 [mlx5_core]\n mlx5e_cleanup_nic_tx+0xa7/0x100 [mlx5_core]\n mlx5e_detach_netdev+0x1c\n---truncated---", "datePublished": "2025-12-24T15:30:32", "dateUpdated": "2025-12-24T15:30:32", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/69dd3ad406c49aa69ce4852c15231ac56af8caf9", "https://git.kernel.org/stable/c/bbcc06933f35651294ea1e963757502312c2171f", "https://git.kernel.org/stable/c/ab3de780c176bb91995c6166a576b370d9726e17", "https://git.kernel.org/stable/c/0aa3ee1e4e5c9ed5dda11249450d609c3072c54e", "https://git.kernel.org/stable/c/bacd22df95147ed673bec4692ab2d4d585935241", "https://nvd.nist.gov/vuln/detail/CVE-2022-50726"], "aliases": ["CVE-2022-50726"], "assigner": "Linux", "epss": 0.02, "enisaIdProduct": [{"id": "103c4221-896a-3e52-bdbb-633193283dec", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "1091886a-68a4-3187-a15a-d13cf41fd3a9", "product": {"name": "Linux"}, "product_version": "patch: 5.4.223"}, {"id": "11f8dd2a-7633-3ade-937c-51cb107d65e8", "product": {"name": "Linux"}, "product_version": "patch: 6.1"}, {"id": "22c2edd2-ad96-3c8a-8328-8809dfc778a8", "product": {"name": "Linux"}, "product_version": "e355477ed9e4f401e3931043df97325d38552d54 <bacd22df95147ed673bec4692ab2d4d585935241"}, {"id": "459eec4b-c46e-3c1d-8686-50d5f980d0f8", "product": {"name": "Linux"}, "product_version": "5.1"}, {"id": "4bc7322e-4fc4-3486-b324-4313abb3fdd8", "product": {"name": "Linux"}, "product_version": "e355477ed9e4f401e3931043df97325d38552d54 <ab3de780c176bb91995c6166a576b370d9726e17"}, {"id": "4fbeca54-bd61-3f02-ba96-68c12fe2cc95", "product": {"name": "Linux"}, "product_version": "e355477ed9e4f401e3931043df97325d38552d54 <0aa3ee1e4e5c9ed5dda11249450d609c3072c54e"}, {"id": "76a35b25-2585-31fb-8c08-54f20aef3f61", "product": {"name": "Linux"}, "product_version": "patch: 5.10.153"}, {"id": "8820224c-c4a7-35c4-bbd4-cfb77e1458ab", "product": {"name": "Linux"}, "product_version": "patch: 6.0.7"}, {"id": "afaf0990-6d32-3706-ad75-1d43dc2fea25", "product": {"name": "Linux"}, "product_version": "e355477ed9e4f401e3931043df97325d38552d54 <69dd3ad406c49aa69ce4852c15231ac56af8caf9"}, {"id": "f7e92879-0c23-3c04-971a-1b11b7031ee9", "product": {"name": "Linux"}, "product_version": "e355477ed9e4f401e3931043df97325d38552d54 <bbcc06933f35651294ea1e963757502312c2171f"}, {"id": "fa130b93-1be8-30a0-9472-23064531eced", "product": {"name": "Linux"}, "product_version": "patch: 5.15.77"}], "enisaIdVendor": [{"id": "b88d94f0-d5c2-333e-825a-3a0fa2d29256", "vendor": {"name": "Linux"}}], "isExploited": false}