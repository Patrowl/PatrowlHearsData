{"id": "EUVD-2022-54788", "enisaUuid": "be7a8bc2-b2ac-36af-ac19-dd7ac9d6c84f", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\ntty: fix deadlock caused by calling printk() under tty_port->lock\n\npty_write() invokes kmalloc() which may invoke a normal printk() to print\nfailure message.  This can cause a deadlock in the scenario reported by\nsyz-bot below:\n\n       CPU0              CPU1                    CPU2\n       ----              ----                    ----\n                         lock(console_owner);\n                                                 lock(&port_lock_key);\n  lock(&port->lock);\n                         lock(&port_lock_key);\n                                                 lock(&port->lock);\n  lock(console_owner);\n\nAs commit dbdda842fe96 (\"printk: Add console owner and waiter logic to\nload balance console writes\") said, such deadlock can be prevented by\nusing printk_deferred() in kmalloc() (which is invoked in the section\nguarded by the port->lock).  But there are too many printk() on the\nkmalloc() path, and kmalloc() can be called from anywhere, so changing\nprintk() to printk_deferred() is too complicated and inelegant.\n\nTherefore, this patch chooses to specify __GFP_NOWARN to kmalloc(), so\nthat printk() will not be called, and this deadlock problem can be\navoided.\n\nSyzbot reported the following lockdep error:\n\n======================================================\nWARNING: possible circular locking dependency detected\n5.4.143-00237-g08ccc19a-dirty #10 Not tainted\n------------------------------------------------------\nsyz-executor.4/29420 is trying to acquire lock:\nffffffff8aedb2a0 (console_owner){....}-{0:0}, at: console_trylock_spinning kernel/printk/printk.c:1752 [inline]\nffffffff8aedb2a0 (console_owner){....}-{0:0}, at: vprintk_emit+0x2ca/0x470 kernel/printk/printk.c:2023\n\nbut task is already holding lock:\nffff8880119c9158 (&port->lock){-.-.}-{2:2}, at: pty_write+0xf4/0x1f0 drivers/tty/pty.c:120\n\nwhich lock already depends on the new lock.\n\nthe existing dependency chain (in reverse order) is:\n\n-> #2 (&port->lock){-.-.}-{2:2}:\n       __raw_spin_lock_irqsave include/linux/spinlock_api_smp.h:110 [inline]\n       _raw_spin_lock_irqsave+0x35/0x50 kernel/locking/spinlock.c:159\n       tty_port_tty_get drivers/tty/tty_port.c:288 [inline]          \t\t<-- lock(&port->lock);\n       tty_port_default_wakeup+0x1d/0xb0 drivers/tty/tty_port.c:47\n       serial8250_tx_chars+0x530/0xa80 drivers/tty/serial/8250/8250_port.c:1767\n       serial8250_handle_irq.part.0+0x31f/0x3d0 drivers/tty/serial/8250/8250_port.c:1854\n       serial8250_handle_irq drivers/tty/serial/8250/8250_port.c:1827 [inline] \t<-- lock(&port_lock_key);\n       serial8250_default_handle_irq+0xb2/0x220 drivers/tty/serial/8250/8250_port.c:1870\n       serial8250_interrupt+0xfd/0x200 drivers/tty/serial/8250/8250_core.c:126\n       __handle_irq_event_percpu+0x109/0xa50 kernel/irq/handle.c:156\n       [...]\n\n-> #1 (&port_lock_key){-.-.}-{2:2}:\n       __raw_spin_lock_irqsave include/linux/spinlock_api_smp.h:110 [inline]\n       _raw_spin_lock_irqsave+0x35/0x50 kernel/locking/spinlock.c:159\n       serial8250_console_write+0x184/0xa40 drivers/tty/serial/8250/8250_port.c:3198\n\t\t\t\t\t\t\t\t\t\t<-- lock(&port_lock_key);\n       call_console_drivers kernel/printk/printk.c:1819 [inline]\n       console_unlock+0x8cb/0xd00 kernel/printk/printk.c:2504\n       vprintk_emit+0x1b5/0x470 kernel/printk/printk.c:2024\t\t\t<-- lock(console_owner);\n       vprintk_func+0x8d/0x250 kernel/printk/printk_safe.c:394\n       printk+0xba/0xed kernel/printk/printk.c:2084\n       register_console+0x8b3/0xc10 kernel/printk/printk.c:2829\n       univ8250_console_init+0x3a/0x46 drivers/tty/serial/8250/8250_core.c:681\n       console_init+0x49d/0x6d3 kernel/printk/printk.c:2915\n       start_kernel+0x5e9/0x879 init/main.c:713\n       secondary_startup_64+0xa4/0xb0 arch/x86/kernel/head_64.S:241\n\n-> #0 (console_owner){....}-{0:0}:\n       [...]\n       lock_acquire+0x127/0x340 kernel/locking/lockdep.c:4734\n       console_trylock_spinning kernel/printk/printk.c:1773 \n---truncated---", "datePublished": "2025-02-26T02:12:54", "dateUpdated": "2025-10-01T19:46:49", "baseScore": 5.5, "baseScoreVersion": "3.1", "baseScoreVector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H", "references": ["https://git.kernel.org/stable/c/4af21b12a60ed2d3642284f4f85b42d7dc6ac246", "https://git.kernel.org/stable/c/4c253caf9264d2aa47ee806a87986dd8eb91a5d9", "https://git.kernel.org/stable/c/04ee31678c128a6cc7bb057ea189a8624ba5a314", "https://git.kernel.org/stable/c/3219ac364ac3d8d30771612a6010f1e0b7fa0a28", "https://git.kernel.org/stable/c/9834b13e8b962caa28fbcf1f422dd82413da4ede", "https://git.kernel.org/stable/c/18ca0d55e8639b911df8aae1b47598b13f9acded", "https://git.kernel.org/stable/c/b3c974501d0c32258ae0e04e5cc3fb92383b40f6", "https://git.kernel.org/stable/c/0bcf44903ef4df742dcada86ccaedd25374ffb50", "https://git.kernel.org/stable/c/6b9dbedbe3499fef862c4dff5217cf91f34e43b3", "https://nvd.nist.gov/vuln/detail/CVE-2022-49441"], "aliases": ["CVE-2022-49441"], "assigner": "Linux", "epss": 0.01, "enisaIdProduct": [{"id": "05397182-8834-32a4-aae4-00ce4dd1ccef", "product": {"name": "Linux"}, "product_version": "deb1feaad03a78b545c949e54582ae57b3c56982 <4c253caf9264d2aa47ee806a87986dd8eb91a5d9"}, {"id": "0d24b807-9bac-32ae-809c-432a29a36be5", "product": {"name": "Linux"}, "product_version": "b6da31b2c07c46f2dcad1d86caa835227a16d9ff <6b9dbedbe3499fef862c4dff5217cf91f34e43b3"}, {"id": "1998c7c5-69cc-3b90-8237-c3301662ddb5", "product": {"name": "Linux"}, "product_version": "patch: 4.14.283"}, {"id": "23aa0571-c46a-31a5-ae7f-55300281e878", "product": {"name": "Linux"}, "product_version": "patch: 5.15.46"}, {"id": "2b9f75ec-b4a6-3e77-b7d4-0021ace75e89", "product": {"name": "Linux"}, "product_version": "b6da31b2c07c46f2dcad1d86caa835227a16d9ff <18ca0d55e8639b911df8aae1b47598b13f9acded"}, {"id": "34bb948e-6235-39ef-8a1a-36e4bb0b958d", "product": {"name": "Linux"}, "product_version": "patch: 5.17.14"}, {"id": "45c8b17d-333f-3cfa-9216-bd6efed11129", "product": {"name": "Linux"}, "product_version": "6d9cd12792270773fab9e5a129daff328d61ef9e"}, {"id": "527c33b8-c028-38a2-8c39-23282a7e8e79", "product": {"name": "Linux"}, "product_version": "patch: 4.9.318"}, {"id": "7b3e2f9a-e3c6-3576-a76c-7d2689c8016c", "product": {"name": "Linux"}, "product_version": "b6da31b2c07c46f2dcad1d86caa835227a16d9ff <0bcf44903ef4df742dcada86ccaedd25374ffb50"}, {"id": "8b080fc0-608a-3d49-92e4-99aefb80d9b0", "product": {"name": "Linux"}, "product_version": "patch: 5.18.3"}, {"id": "afbd38ac-d9f2-370e-b1ee-4b4f1af01344", "product": {"name": "Linux"}, "product_version": "b6da31b2c07c46f2dcad1d86caa835227a16d9ff <9834b13e8b962caa28fbcf1f422dd82413da4ede"}, {"id": "bd251f22-d8f5-3187-9a46-772db1a0bc79", "product": {"name": "Linux"}, "product_version": "patch: 5.10.121"}, {"id": "c1dbf3a6-ced5-318f-b66c-03a6d4f3e522", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "c563ac1f-d2e1-3a26-ae9a-e2e33636c98e", "product": {"name": "Linux"}, "product_version": "4.18"}, {"id": "c570edb1-9300-3c33-ae59-672264df7706", "product": {"name": "Linux"}, "product_version": "60c4e8db32815474bfaeabe888ebb14e698caea1"}, {"id": "cd21ae37-f008-37ef-991f-30c2747b394b", "product": {"name": "Linux"}, "product_version": "b6da31b2c07c46f2dcad1d86caa835227a16d9ff <b3c974501d0c32258ae0e04e5cc3fb92383b40f6"}, {"id": "ce7dc391-6374-358b-8568-09f33f7528a3", "product": {"name": "Linux"}, "product_version": "b6da31b2c07c46f2dcad1d86caa835227a16d9ff <3219ac364ac3d8d30771612a6010f1e0b7fa0a28"}, {"id": "d09986db-25a4-331a-ba0b-989030bbeec8", "product": {"name": "Linux"}, "product_version": "patch: 4.19.247"}, {"id": "da251c1a-31ef-3e08-b15c-4407aa3969ef", "product": {"name": "Linux"}, "product_version": "6dbfa9b5ae65063cd61dc7fa11332e00bb794d8b"}, {"id": "e25d0aaa-4ee8-3303-a2db-567b1005e3cd", "product": {"name": "Linux"}, "product_version": "b6da31b2c07c46f2dcad1d86caa835227a16d9ff <04ee31678c128a6cc7bb057ea189a8624ba5a314"}, {"id": "f073ebd3-e348-3a87-be7a-4da1a39df3f4", "product": {"name": "Linux"}, "product_version": "patch: 5.4.198"}, {"id": "f869d5d2-74ce-399a-a83c-d5c1ea478f9a", "product": {"name": "Linux"}, "product_version": "d83904cb2eb2c4d937eaf15032214b0578f25099 <4af21b12a60ed2d3642284f4f85b42d7dc6ac246"}, {"id": "fa6fa7f6-9088-320f-b1b2-9a92c483e181", "product": {"name": "Linux"}, "product_version": "patch: 5.19"}], "enisaIdVendor": [{"id": "df161cac-98e1-3aa5-94a5-59d6523ee4c8", "vendor": {"name": "Linux"}}], "isExploited": false}