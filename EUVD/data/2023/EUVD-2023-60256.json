{"id": "EUVD-2023-60256", "enisaUuid": "f6f734f1-a8b4-3f98-bb57-35bacf30a93c", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nigb: clean up in all error paths when enabling SR-IOV\n\nAfter commit 50f303496d92 (\"igb: Enable SR-IOV after reinit\"), removing\nthe igb module could hang or crash (depending on the machine) when the\nmodule has been loaded with the max_vfs parameter set to some value != 0.\n\nIn case of one test machine with a dual port 82580, this hang occurred:\n\n[  232.480687] igb 0000:41:00.1: removed PHC on enp65s0f1\n[  233.093257] igb 0000:41:00.1: IOV Disabled\n[  233.329969] pcieport 0000:40:01.0: AER: Multiple Uncorrected (Non-Fatal) err0\n[  233.340302] igb 0000:41:00.0: PCIe Bus Error: severity=Uncorrected (Non-Fata)\n[  233.352248] igb 0000:41:00.0:   device [8086:1516] error status/mask=00100000\n[  233.361088] igb 0000:41:00.0:    [20] UnsupReq               (First)\n[  233.368183] igb 0000:41:00.0: AER:   TLP Header: 40000001 0000040f cdbfc00c c\n[  233.376846] igb 0000:41:00.1: PCIe Bus Error: severity=Uncorrected (Non-Fata)\n[  233.388779] igb 0000:41:00.1:   device [8086:1516] error status/mask=00100000\n[  233.397629] igb 0000:41:00.1:    [20] UnsupReq               (First)\n[  233.404736] igb 0000:41:00.1: AER:   TLP Header: 40000001 0000040f cdbfc00c c\n[  233.538214] pci 0000:41:00.1: AER: can't recover (no error_detected callback)\n[  233.538401] igb 0000:41:00.0: removed PHC on enp65s0f0\n[  233.546197] pcieport 0000:40:01.0: AER: device recovery failed\n[  234.157244] igb 0000:41:00.0: IOV Disabled\n[  371.619705] INFO: task irq/35-aerdrv:257 blocked for more than 122 seconds.\n[  371.627489]       Not tainted 6.4.0-dirty #2\n[  371.632257] \"echo 0 > /proc/sys/kernel/hung_task_timeout_secs\" disables this.\n[  371.641000] task:irq/35-aerdrv   state:D stack:0     pid:257   ppid:2      f0\n[  371.650330] Call Trace:\n[  371.653061]  <TASK>\n[  371.655407]  __schedule+0x20e/0x660\n[  371.659313]  schedule+0x5a/0xd0\n[  371.662824]  schedule_preempt_disabled+0x11/0x20\n[  371.667983]  __mutex_lock.constprop.0+0x372/0x6c0\n[  371.673237]  ? __pfx_aer_root_reset+0x10/0x10\n[  371.678105]  report_error_detected+0x25/0x1c0\n[  371.682974]  ? __pfx_report_normal_detected+0x10/0x10\n[  371.688618]  pci_walk_bus+0x72/0x90\n[  371.692519]  pcie_do_recovery+0xb2/0x330\n[  371.696899]  aer_process_err_devices+0x117/0x170\n[  371.702055]  aer_isr+0x1c0/0x1e0\n[  371.705661]  ? __set_cpus_allowed_ptr+0x54/0xa0\n[  371.710723]  ? __pfx_irq_thread_fn+0x10/0x10\n[  371.715496]  irq_thread_fn+0x20/0x60\n[  371.719491]  irq_thread+0xe6/0x1b0\n[  371.723291]  ? __pfx_irq_thread_dtor+0x10/0x10\n[  371.728255]  ? __pfx_irq_thread+0x10/0x10\n[  371.732731]  kthread+0xe2/0x110\n[  371.736243]  ? __pfx_kthread+0x10/0x10\n[  371.740430]  ret_from_fork+0x2c/0x50\n[  371.744428]  </TASK>\n\nThe reproducer was a simple script:\n\n  #!/bin/sh\n  for i in `seq 1 5`; do\n    modprobe -rv igb\n    modprobe -v igb max_vfs=1\n    sleep 1\n    modprobe -rv igb\n  done\n\nIt turned out that this could only be reproduce on 82580 (quad and\ndual-port), but not on 82576, i350 and i210.  Further debugging showed\nthat igb_enable_sriov()'s call to pci_enable_sriov() is failing, because\ndev->is_physfn is 0 on 82580.\n\nPrior to commit 50f303496d92 (\"igb: Enable SR-IOV after reinit\"),\nigb_enable_sriov() jumped into the \"err_out\" cleanup branch.  After this\ncommit it only returned the error code.\n\nSo the cleanup didn't take place, and the incorrect VF setup in the\nigb_adapter structure fooled the igb driver into assuming that VFs have\nbeen set up where no VF actually existed.\n\nFix this problem by cleaning up again if pci_enable_sriov() fails.", "datePublished": "2025-12-24T15:30:36", "dateUpdated": "2025-12-24T15:30:36", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/0e3ea7e82a06014b9baf1b84ba579c38cbff3558", "https://git.kernel.org/stable/c/bc6ed2fa24b14e40e1005488bbe11268ce7108fa", "https://nvd.nist.gov/vuln/detail/CVE-2023-54070"], "aliases": ["CVE-2023-54070"], "assigner": "Linux", "epss": 0.02, "enisaIdProduct": [{"id": "05c6b788-5f60-3fc8-816e-8eac0aecc958", "product": {"name": "Linux"}, "product_version": "patch: 6.6"}, {"id": "3cd8ab42-ff33-35ca-84cc-0d8d2155b413", "product": {"name": "Linux"}, "product_version": "patch: 6.5.4"}, {"id": "6cf2f8c6-1a41-3c19-afb7-aa759fceb630", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "6f602799-a97f-3251-9187-7909ea4d76c5", "product": {"name": "Linux"}, "product_version": "50f303496d92e25b79bdfb73e3707ad0684ad67f <bc6ed2fa24b14e40e1005488bbe11268ce7108fa"}, {"id": "d8301ed2-7526-3e23-a3f7-4db5f1a75409", "product": {"name": "Linux"}, "product_version": "50f303496d92e25b79bdfb73e3707ad0684ad67f <0e3ea7e82a06014b9baf1b84ba579c38cbff3558"}, {"id": "f1c57fb9-492a-3ffe-a439-8ac5f5fb973e", "product": {"name": "Linux"}, "product_version": "6.3"}], "enisaIdVendor": [{"id": "16dca844-eba1-317b-bc29-4c2a56f3c322", "vendor": {"name": "Linux"}}], "isExploited": false}