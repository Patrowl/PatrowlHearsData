{"id": "EUVD-2023-0003", "enisaUuid": "2495bf79-cad6-319d-926b-775dadca9264", "description": "### Impact\\n\\naiohttp v3.8.4 and earlier are [bundled with llhttp v6.0.6](https://github.com/aio-libs/aiohttp/blob/v3.8.4/.gitmodules) which is vulnerable to CVE-2023-30589. The vulnerable code is used by aiohttp for its HTTP request parser when available which is the default case when installing from a wheel.\\n\\nThis vulnerability only affects users of aiohttp as an HTTP server (ie `aiohttp.Application`), you are not affected by this vulnerability if you are using aiohttp as an HTTP client library (ie `aiohttp.ClientSession`).\\n\\n### Reproducer\\n\\n```python\\nfrom aiohttp import web\\n\\nasync def example(request: web.Request):\\n    headers = dict(request.headers)\\n    body = await request.content.read()\\n    return web.Response(text=f\\\"headers: {headers} body: {body}\\\")\\n\\napp = web.Application()\\napp.add_routes([web.post('/', example)])\\nweb.run_app(app)\\n```\\n\\nSending a crafted HTTP request will cause the server to misinterpret one of the HTTP header values leading to HTTP request smuggling.\\n\\n```console\\n$ printf \\\"POST / HTTP/1.1\\\\r\\\\nHost: localhost:8080\\\\r\\\\nX-Abc: \\\\rxTransfer-Encoding: chunked\\\\r\\\\n\\\\r\\\\n1\\\\r\\\\nA\\\\r\\\\n0\\\\r\\\\n\\\\r\\\\n\\\" \\\\\\n  | nc localhost 8080\\n\\nExpected output:\\n  headers: {'Host': 'localhost:8080', 'X-Abc': '\\\\rxTransfer-Encoding: chunked'} body: b''\\n\\nActual output (note that 'Transfer-Encoding: chunked' is an HTTP header now and body is treated differently)\\n  headers: {'Host': 'localhost:8080', 'X-Abc': '', 'Transfer-Encoding': 'chunked'} body: b'A'\\n```\\n\\n### Patches\\n\\nUpgrade to the latest version of aiohttp to resolve this vulnerability. It has been fixed in v3.8.5: [`pip install aiohttp >= 3.8.5`](https://pypi.org/project/aiohttp/3.8.5/)\\n\\n### Workarounds\\n\\nIf you aren't able to upgrade you can reinstall aiohttp using `AIOHTTP_NO_EXTENSIONS=1` as an environment variable to disable the llhttp HTTP request parser implementation. The pure Python implementation isn't vulnerable to request smuggling:\\n\\n```console\\n$ python -m pip uninstall --yes aiohttp\\n$ AIOHTTP_NO_EXTENSIONS=1 python -m pip install --no-binary=aiohttp --no-cache aiohttp\\n```\\n\\n### References\\n\\n* https://nvd.nist.gov/vuln/detail/CVE-2023-30589\\n* https://hackerone.com/reports/2001873\\n", "datePublished": "2023-07-20T05:52:00", "dateUpdated": "2023-07-24T05:58:05", "baseScore": 5.3, "baseScoreVersion": "3.1", "baseScoreVector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N", "references": ["https://github.com/aio-libs/aiohttp/security/advisories/GHSA-45c4-8wx5-qw6w", "https://nvd.nist.gov/vuln/detail/CVE-2023-37276", "https://github.com/aio-libs/aiohttp", "https://hackerone.com/reports/2001873", "https://github.com/aio-libs/aiohttp/commit/9337fb3f2ab2b5f38d7e98a194bde6f7e3d16c40", "https://github.com/aio-libs/aiohttp/commit/9c13a52c21c23dfdb49ed89418d28a5b116d0681", "https://github.com/aio-libs/aiohttp/blob/v3.8.4/.gitmodules", "https://github.com/pypa/advisory-database/tree/main/vulns/aiohttp/PYSEC-2023-120.yaml"], "aliases": ["GHSA-45c4-8wx5-qw6w", "CVE-2023-37276", "PYSEC-2023-120"], "assigner": "GitHub_M", "epss": 5.78, "enisaIdProduct": [{"id": "b879bc27-c0f3-300a-a954-c62204400b6d", "product": {"name": "aiohttp"}, "product_version": "< 3.8.5"}], "enisaIdVendor": [{"id": "eb5a8223-1833-398c-bd51-7d2ec45560c0", "vendor": {"name": "aio-libs"}}], "isExploited": false}