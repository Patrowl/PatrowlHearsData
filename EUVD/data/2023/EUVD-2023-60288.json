{"id": "EUVD-2023-60288", "enisaUuid": "46d54c46-7799-3236-9986-2c889750f33b", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nbinder: fix UAF of alloc->vma in race with munmap()\n\n[ cmllamas: clean forward port from commit 015ac18be7de (\"binder: fix\n  UAF of alloc->vma in race with munmap()\") in 5.10 stable. It is needed\n  in mainline after the revert of commit a43cfc87caaf (\"android: binder:\n  stop saving a pointer to the VMA\") as pointed out by Liam. The commit\n  log and tags have been tweaked to reflect this. ]\n\nIn commit 720c24192404 (\"ANDROID: binder: change down_write to\ndown_read\") binder assumed the mmap read lock is sufficient to protect\nalloc->vma inside binder_update_page_range(). This used to be accurate\nuntil commit dd2283f2605e (\"mm: mmap: zap pages with read mmap_sem in\nmunmap\"), which now downgrades the mmap_lock after detaching the vma\nfrom the rbtree in munmap(). Then it proceeds to teardown and free the\nvma with only the read lock held.\n\nThis means that accesses to alloc->vma in binder_update_page_range() now\nwill race with vm_area_free() in munmap() and can cause a UAF as shown\nin the following KASAN trace:\n\n  ==================================================================\n  BUG: KASAN: use-after-free in vm_insert_page+0x7c/0x1f0\n  Read of size 8 at addr ffff16204ad00600 by task server/558\n\n  CPU: 3 PID: 558 Comm: server Not tainted 5.10.150-00001-gdc8dcf942daa #1\n  Hardware name: linux,dummy-virt (DT)\n  Call trace:\n   dump_backtrace+0x0/0x2a0\n   show_stack+0x18/0x2c\n   dump_stack+0xf8/0x164\n   print_address_description.constprop.0+0x9c/0x538\n   kasan_report+0x120/0x200\n   __asan_load8+0xa0/0xc4\n   vm_insert_page+0x7c/0x1f0\n   binder_update_page_range+0x278/0x50c\n   binder_alloc_new_buf+0x3f0/0xba0\n   binder_transaction+0x64c/0x3040\n   binder_thread_write+0x924/0x2020\n   binder_ioctl+0x1610/0x2e5c\n   __arm64_sys_ioctl+0xd4/0x120\n   el0_svc_common.constprop.0+0xac/0x270\n   do_el0_svc+0x38/0xa0\n   el0_svc+0x1c/0x2c\n   el0_sync_handler+0xe8/0x114\n   el0_sync+0x180/0x1c0\n\n  Allocated by task 559:\n   kasan_save_stack+0x38/0x6c\n   __kasan_kmalloc.constprop.0+0xe4/0xf0\n   kasan_slab_alloc+0x18/0x2c\n   kmem_cache_alloc+0x1b0/0x2d0\n   vm_area_alloc+0x28/0x94\n   mmap_region+0x378/0x920\n   do_mmap+0x3f0/0x600\n   vm_mmap_pgoff+0x150/0x17c\n   ksys_mmap_pgoff+0x284/0x2dc\n   __arm64_sys_mmap+0x84/0xa4\n   el0_svc_common.constprop.0+0xac/0x270\n   do_el0_svc+0x38/0xa0\n   el0_svc+0x1c/0x2c\n   el0_sync_handler+0xe8/0x114\n   el0_sync+0x180/0x1c0\n\n  Freed by task 560:\n   kasan_save_stack+0x38/0x6c\n   kasan_set_track+0x28/0x40\n   kasan_set_free_info+0x24/0x4c\n   __kasan_slab_free+0x100/0x164\n   kasan_slab_free+0x14/0x20\n   kmem_cache_free+0xc4/0x34c\n   vm_area_free+0x1c/0x2c\n   remove_vma+0x7c/0x94\n   __do_munmap+0x358/0x710\n   __vm_munmap+0xbc/0x130\n   __arm64_sys_munmap+0x4c/0x64\n   el0_svc_common.constprop.0+0xac/0x270\n   do_el0_svc+0x38/0xa0\n   el0_svc+0x1c/0x2c\n   el0_sync_handler+0xe8/0x114\n   el0_sync+0x180/0x1c0\n\n  [...]\n  ==================================================================\n\nTo prevent the race above, revert back to taking the mmap write lock\ninside binder_update_page_range(). One might expect an increase of mmap\nlock contention. However, binder already serializes these calls via top\nlevel alloc->mutex. Also, there was no performance impact shown when\nrunning the binder benchmark tests.", "datePublished": "2025-12-24T15:30:40", "dateUpdated": "2025-12-24T15:30:40", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/1bb8a65190d45cd5c7dbc85e29b9102110cd6be6", "https://git.kernel.org/stable/c/931ea1ed31be939c1efdbc49bc66d2a45684f9b4", "https://git.kernel.org/stable/c/ca0cc0a9c6e56c699e2acbb93d8024523021f3c3", "https://git.kernel.org/stable/c/d1d8875c8c13517f6fd1ff8d4d3e1ac366a17e07", "https://nvd.nist.gov/vuln/detail/CVE-2023-54157"], "aliases": ["CVE-2023-54157"], "assigner": "Linux", "epss": 0.02, "enisaIdProduct": [{"id": "1b140537-b012-3ef5-aa00-d59c852a77e8", "product": {"name": "Linux"}, "product_version": "dd2283f2605e3b3e9c61bcae844b34f2afa4813f <931ea1ed31be939c1efdbc49bc66d2a45684f9b4"}, {"id": "217a6cfc-5e4b-39b7-9984-47bbe30a608c", "product": {"name": "Linux"}, "product_version": "patch: 6.3.5"}, {"id": "5b49ba6b-553f-3b33-99b6-724c996d0f63", "product": {"name": "Linux"}, "product_version": "patch: 5.15.115"}, {"id": "610d2a19-c709-380e-9304-76cba13409af", "product": {"name": "Linux"}, "product_version": "dd2283f2605e3b3e9c61bcae844b34f2afa4813f <ca0cc0a9c6e56c699e2acbb93d8024523021f3c3"}, {"id": "70e95105-7285-3f18-a06a-f6292e65ff08", "product": {"name": "Linux"}, "product_version": "4.20"}, {"id": "855b7d41-bdf3-305c-a803-cf6656a012dc", "product": {"name": "Linux"}, "product_version": "patch: 6.4"}, {"id": "891a4b2b-1cc9-3482-9644-d3381f34284d", "product": {"name": "Linux"}, "product_version": "dd2283f2605e3b3e9c61bcae844b34f2afa4813f <1bb8a65190d45cd5c7dbc85e29b9102110cd6be6"}, {"id": "bbcd4917-4291-3156-8376-2af51fdde5d3", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "d7ff0275-b079-3692-835b-889508084fd1", "product": {"name": "Linux"}, "product_version": "dd2283f2605e3b3e9c61bcae844b34f2afa4813f <d1d8875c8c13517f6fd1ff8d4d3e1ac366a17e07"}, {"id": "de42e080-a4c7-333e-8afd-e480b7f114fe", "product": {"name": "Linux"}, "product_version": "patch: 6.1.31"}], "enisaIdVendor": [{"id": "9f77486e-1537-30e1-bf7e-a8ba6545e866", "vendor": {"name": "Linux"}}], "isExploited": false}