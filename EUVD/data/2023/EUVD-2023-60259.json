{"id": "EUVD-2023-60259", "enisaUuid": "f7d96c15-c662-3dfc-9520-eae95d9d66c5", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nbtrfs: fix race when deleting free space root from the dirty cow roots list\n\nWhen deleting the free space tree we are deleting the free space root\nfrom the list fs_info->dirty_cowonly_roots without taking the lock that\nprotects it, which is struct btrfs_fs_info::trans_lock.\nThis unsynchronized list manipulation may cause chaos if there's another\nconcurrent manipulation of this list, such as when adding a root to it\nwith ctree.c:add_root_to_dirty_list().\n\nThis can result in all sorts of weird failures caused by a race, such as\nthe following crash:\n\n  [337571.278245] general protection fault, probably for non-canonical address 0xdead000000000108: 0000 [#1] PREEMPT SMP PTI\n  [337571.278933] CPU: 1 PID: 115447 Comm: btrfs Tainted: G        W          6.4.0-rc6-btrfs-next-134+ #1\n  [337571.279153] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.14.0-0-g155821a1990b-prebuilt.qemu.org 04/01/2014\n  [337571.279572] RIP: 0010:commit_cowonly_roots+0x11f/0x250 [btrfs]\n  [337571.279928] Code: 85 38 06 00 (...)\n  [337571.280363] RSP: 0018:ffff9f63446efba0 EFLAGS: 00010206\n  [337571.280582] RAX: ffff942d98ec2638 RBX: ffff9430b82b4c30 RCX: 0000000449e1c000\n  [337571.280798] RDX: dead000000000100 RSI: ffff9430021e4900 RDI: 0000000000036070\n  [337571.281015] RBP: ffff942d98ec2000 R08: ffff942d98ec2000 R09: 000000000000015b\n  [337571.281254] R10: 0000000000000009 R11: 0000000000000001 R12: ffff942fe8fbf600\n  [337571.281476] R13: ffff942dabe23040 R14: ffff942dabe20800 R15: ffff942d92cf3b48\n  [337571.281723] FS:  00007f478adb7340(0000) GS:ffff94349fa40000(0000) knlGS:0000000000000000\n  [337571.281950] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n  [337571.282184] CR2: 00007f478ab9a3d5 CR3: 000000001e02c001 CR4: 0000000000370ee0\n  [337571.282416] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n  [337571.282647] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\n  [337571.282874] Call Trace:\n  [337571.283101]  <TASK>\n  [337571.283327]  ? __die_body+0x1b/0x60\n  [337571.283570]  ? die_addr+0x39/0x60\n  [337571.283796]  ? exc_general_protection+0x22e/0x430\n  [337571.284022]  ? asm_exc_general_protection+0x22/0x30\n  [337571.284251]  ? commit_cowonly_roots+0x11f/0x250 [btrfs]\n  [337571.284531]  btrfs_commit_transaction+0x42e/0xf90 [btrfs]\n  [337571.284803]  ? _raw_spin_unlock+0x15/0x30\n  [337571.285031]  ? release_extent_buffer+0x103/0x130 [btrfs]\n  [337571.285305]  reset_balance_state+0x152/0x1b0 [btrfs]\n  [337571.285578]  btrfs_balance+0xa50/0x11e0 [btrfs]\n  [337571.285864]  ? __kmem_cache_alloc_node+0x14a/0x410\n  [337571.286086]  btrfs_ioctl+0x249a/0x3320 [btrfs]\n  [337571.286358]  ? mod_objcg_state+0xd2/0x360\n  [337571.286577]  ? refill_obj_stock+0xb0/0x160\n  [337571.286798]  ? seq_release+0x25/0x30\n  [337571.287016]  ? __rseq_handle_notify_resume+0x3ba/0x4b0\n  [337571.287235]  ? percpu_counter_add_batch+0x2e/0xa0\n  [337571.287455]  ? __x64_sys_ioctl+0x88/0xc0\n  [337571.287675]  __x64_sys_ioctl+0x88/0xc0\n  [337571.287901]  do_syscall_64+0x38/0x90\n  [337571.288126]  entry_SYSCALL_64_after_hwframe+0x72/0xdc\n  [337571.288352] RIP: 0033:0x7f478aaffe9b\n\nSo fix this by locking struct btrfs_fs_info::trans_lock before deleting\nthe free space root from that list.", "datePublished": "2025-12-24T15:30:36", "dateUpdated": "2025-12-24T15:30:36", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/6f1c81886b0b56cb88b311e5d2f203625474d892", "https://git.kernel.org/stable/c/8ce9139aea5e60a247bde5af804312f54975f443", "https://git.kernel.org/stable/c/babebf023e661b90b1c78b2baa384fb03a226879", "https://nvd.nist.gov/vuln/detail/CVE-2023-54067"], "aliases": ["CVE-2023-54067"], "assigner": "Linux", "epss": 0.02, "enisaIdProduct": [{"id": "00b880c5-fb8b-3084-8d39-7e1664b99b61", "product": {"name": "Linux"}, "product_version": "patch: 6.4.4"}, {"id": "06071c4b-6986-3b58-aa66-805e293b474c", "product": {"name": "Linux"}, "product_version": "4.5"}, {"id": "12d29875-bfe8-3aa2-a707-aec12b62ec48", "product": {"name": "Linux"}, "product_version": "patch: 6.1.39"}, {"id": "3edd519c-df5d-3c1c-94ff-2c2475264360", "product": {"name": "Linux"}, "product_version": "a5ed91828518ab076209266c2bc510adabd078df <6f1c81886b0b56cb88b311e5d2f203625474d892"}, {"id": "74ab1d4a-0179-36da-a6f5-3e8397bc0b6a", "product": {"name": "Linux"}, "product_version": "patch: 6.5"}, {"id": "9dc9913f-7e40-3fec-bce2-edf56c1b61a0", "product": {"name": "Linux"}, "product_version": "a5ed91828518ab076209266c2bc510adabd078df <babebf023e661b90b1c78b2baa384fb03a226879"}, {"id": "9e157307-cc29-3850-855b-78f554baf1e4", "product": {"name": "Linux"}, "product_version": "a5ed91828518ab076209266c2bc510adabd078df <8ce9139aea5e60a247bde5af804312f54975f443"}, {"id": "c1fda6c0-55e6-3476-ae89-1ad6e600ab21", "product": {"name": "Linux"}, "product_version": "patch: 0"}], "enisaIdVendor": [{"id": "df1447df-8f6e-3a5c-bdb3-51fcdd8d59d8", "vendor": {"name": "Linux"}}], "isExploited": false}