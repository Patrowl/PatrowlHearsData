{"id": "EUVD-2023-60150", "enisaUuid": "66e2e8a7-5029-3946-a2ef-8bd0a101ee83", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nf2fs: fix to do sanity check on direct node in truncate_dnode()\n\nsyzbot reports below bug:\n\nBUG: KASAN: slab-use-after-free in f2fs_truncate_data_blocks_range+0x122a/0x14c0 fs/f2fs/file.c:574\nRead of size 4 at addr ffff88802a25c000 by task syz-executor148/5000\n\nCPU: 1 PID: 5000 Comm: syz-executor148 Not tainted 6.4.0-rc7-syzkaller-00041-ge660abd551f1 #0\nHardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 05/27/2023\nCall Trace:\n <TASK>\n __dump_stack lib/dump_stack.c:88 [inline]\n dump_stack_lvl+0xd9/0x150 lib/dump_stack.c:106\n print_address_description.constprop.0+0x2c/0x3c0 mm/kasan/report.c:351\n print_report mm/kasan/report.c:462 [inline]\n kasan_report+0x11c/0x130 mm/kasan/report.c:572\n f2fs_truncate_data_blocks_range+0x122a/0x14c0 fs/f2fs/file.c:574\n truncate_dnode+0x229/0x2e0 fs/f2fs/node.c:944\n f2fs_truncate_inode_blocks+0x64b/0xde0 fs/f2fs/node.c:1154\n f2fs_do_truncate_blocks+0x4ac/0xf30 fs/f2fs/file.c:721\n f2fs_truncate_blocks+0x7b/0x300 fs/f2fs/file.c:749\n f2fs_truncate.part.0+0x4a5/0x630 fs/f2fs/file.c:799\n f2fs_truncate include/linux/fs.h:825 [inline]\n f2fs_setattr+0x1738/0x2090 fs/f2fs/file.c:1006\n notify_change+0xb2c/0x1180 fs/attr.c:483\n do_truncate+0x143/0x200 fs/open.c:66\n handle_truncate fs/namei.c:3295 [inline]\n do_open fs/namei.c:3640 [inline]\n path_openat+0x2083/0x2750 fs/namei.c:3791\n do_filp_open+0x1ba/0x410 fs/namei.c:3818\n do_sys_openat2+0x16d/0x4c0 fs/open.c:1356\n do_sys_open fs/open.c:1372 [inline]\n __do_sys_creat fs/open.c:1448 [inline]\n __se_sys_creat fs/open.c:1442 [inline]\n __x64_sys_creat+0xcd/0x120 fs/open.c:1442\n do_syscall_x64 arch/x86/entry/common.c:50 [inline]\n do_syscall_64+0x39/0xb0 arch/x86/entry/common.c:80\n entry_SYSCALL_64_after_hwframe+0x63/0xcd\n\nThe root cause is, inodeA references inodeB via inodeB's ino, once inodeA\nis truncated, it calls truncate_dnode() to truncate data blocks in inodeB's\nnode page, it traverse mapping data from node->i.i_addr[0] to\nnode->i.i_addr[ADDRS_PER_BLOCK() - 1], result in out-of-boundary access.\n\nThis patch fixes to add sanity check on dnode page in truncate_dnode(),\nso that, it can help to avoid triggering such issue, and once it encounters\nsuch issue, it will record newly introduced ERROR_INVALID_NODE_REFERENCE\nerror into superblock, later fsck can detect such issue and try repairing.\n\nAlso, it removes f2fs_truncate_data_blocks() for cleanup due to the\nfunction has only one caller, and uses f2fs_truncate_data_blocks_range()\ninstead.", "datePublished": "2025-12-09T01:30:09", "dateUpdated": "2025-12-20T08:51:30", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/af0f716ad3b039cab9d426da63a5ee6c88751185", "https://git.kernel.org/stable/c/a6ec83786ab9f13f25fb18166dee908845713a95", "https://nvd.nist.gov/vuln/detail/CVE-2023-53846"], "aliases": ["CVE-2023-53846"], "assigner": "Linux", "epss": 0.02, "enisaIdProduct": [{"id": "38f5bf38-0c23-3659-9a08-58b658395eb6", "product": {"name": "Linux"}, "product_version": "98e4da8ca301e062d79ae168c67e56f3c3de3ce4 <a6ec83786ab9f13f25fb18166dee908845713a95"}, {"id": "4f63b573-731e-333e-b35e-796390025054", "product": {"name": "Linux"}, "product_version": "3.8"}, {"id": "5060bcd7-4230-3c86-ad0e-99a475c5f5fb", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <af0f716ad3b039cab9d426da63a5ee6c88751185"}, {"id": "8426781d-56c2-3576-9ec9-7798d8f1b11d", "product": {"name": "Linux"}, "product_version": "98e4da8ca301e062d79ae168c67e56f3c3de3ce4 <af0f716ad3b039cab9d426da63a5ee6c88751185"}, {"id": "923dfe21-ff16-39b2-b37c-cd84ae03068a", "product": {"name": "Linux"}, "product_version": "patch: 6.4.10"}, {"id": "cce0e9f5-c037-3844-8b28-0e54f186d02d", "product": {"name": "Linux"}, "product_version": "patch: 6.5"}, {"id": "e3a93689-ef13-390d-8cd3-b83fd4c193a1", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "f4787646-b93e-39ca-b5c2-ff13ddc1cc92", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <a6ec83786ab9f13f25fb18166dee908845713a95"}], "enisaIdVendor": [{"id": "9b62f370-a7e7-37a0-80d2-ba9588117109", "vendor": {"name": "Linux"}}], "isExploited": false}