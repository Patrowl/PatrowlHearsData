{"id": "EUVD-2025-20817", "enisaUuid": "c96d8e6f-99d0-3847-b8c5-4a3cdd8e9a7c", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nsmb: client: fix potential deadlock when reconnecting channels\n\nFix cifs_signal_cifsd_for_reconnect() to take the correct lock order\nand prevent the following deadlock from happening\n\n======================================================\nWARNING: possible circular locking dependency detected\n6.16.0-rc3-build2+ #1301 Tainted: G S      W\n------------------------------------------------------\ncifsd/6055 is trying to acquire lock:\nffff88810ad56038 (&tcp_ses->srv_lock){+.+.}-{3:3}, at: cifs_signal_cifsd_for_reconnect+0x134/0x200\n\nbut task is already holding lock:\nffff888119c64330 (&ret_buf->chan_lock){+.+.}-{3:3}, at: cifs_signal_cifsd_for_reconnect+0xcf/0x200\n\nwhich lock already depends on the new lock.\n\nthe existing dependency chain (in reverse order) is:\n\n-> #2 (&ret_buf->chan_lock){+.+.}-{3:3}:\n       validate_chain+0x1cf/0x270\n       __lock_acquire+0x60e/0x780\n       lock_acquire.part.0+0xb4/0x1f0\n       _raw_spin_lock+0x2f/0x40\n       cifs_setup_session+0x81/0x4b0\n       cifs_get_smb_ses+0x771/0x900\n       cifs_mount_get_session+0x7e/0x170\n       cifs_mount+0x92/0x2d0\n       cifs_smb3_do_mount+0x161/0x460\n       smb3_get_tree+0x55/0x90\n       vfs_get_tree+0x46/0x180\n       do_new_mount+0x1b0/0x2e0\n       path_mount+0x6ee/0x740\n       do_mount+0x98/0xe0\n       __do_sys_mount+0x148/0x180\n       do_syscall_64+0xa4/0x260\n       entry_SYSCALL_64_after_hwframe+0x76/0x7e\n\n-> #1 (&ret_buf->ses_lock){+.+.}-{3:3}:\n       validate_chain+0x1cf/0x270\n       __lock_acquire+0x60e/0x780\n       lock_acquire.part.0+0xb4/0x1f0\n       _raw_spin_lock+0x2f/0x40\n       cifs_match_super+0x101/0x320\n       sget+0xab/0x270\n       cifs_smb3_do_mount+0x1e0/0x460\n       smb3_get_tree+0x55/0x90\n       vfs_get_tree+0x46/0x180\n       do_new_mount+0x1b0/0x2e0\n       path_mount+0x6ee/0x740\n       do_mount+0x98/0xe0\n       __do_sys_mount+0x148/0x180\n       do_syscall_64+0xa4/0x260\n       entry_SYSCALL_64_after_hwframe+0x76/0x7e\n\n-> #0 (&tcp_ses->srv_lock){+.+.}-{3:3}:\n       check_noncircular+0x95/0xc0\n       check_prev_add+0x115/0x2f0\n       validate_chain+0x1cf/0x270\n       __lock_acquire+0x60e/0x780\n       lock_acquire.part.0+0xb4/0x1f0\n       _raw_spin_lock+0x2f/0x40\n       cifs_signal_cifsd_for_reconnect+0x134/0x200\n       __cifs_reconnect+0x8f/0x500\n       cifs_handle_standard+0x112/0x280\n       cifs_demultiplex_thread+0x64d/0xbc0\n       kthread+0x2f7/0x310\n       ret_from_fork+0x2a/0x230\n       ret_from_fork_asm+0x1a/0x30\n\nother info that might help us debug this:\n\nChain exists of:\n  &tcp_ses->srv_lock --> &ret_buf->ses_lock --> &ret_buf->chan_lock\n\n Possible unsafe locking scenario:\n\n       CPU0                    CPU1\n       ----                    ----\n  lock(&ret_buf->chan_lock);\n                               lock(&ret_buf->ses_lock);\n                               lock(&ret_buf->chan_lock);\n  lock(&tcp_ses->srv_lock);\n\n *** DEADLOCK ***\n\n3 locks held by cifsd/6055:\n #0: ffffffff857de398 (&cifs_tcp_ses_lock){+.+.}-{3:3}, at: cifs_signal_cifsd_for_reconnect+0x7b/0x200\n #1: ffff888119c64060 (&ret_buf->ses_lock){+.+.}-{3:3}, at: cifs_signal_cifsd_for_reconnect+0x9c/0x200\n #2: ffff888119c64330 (&ret_buf->chan_lock){+.+.}-{3:3}, at: cifs_signal_cifsd_for_reconnect+0xcf/0x200", "datePublished": "2025-07-09T12:31:34", "dateUpdated": "2025-11-20T21:30:30", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/c82c7041258d96e3286f6790ab700e4edd3cc9e3", "https://git.kernel.org/stable/c/7f3ead8ebc0ef65b6c89a13912b4e80218425629", "https://git.kernel.org/stable/c/fe035dc78aa6ca8f862857d45beaf7a0e03206ca", "https://git.kernel.org/stable/c/711741f94ac3cf9f4e3aa73aa171e76d188c0819", "https://nvd.nist.gov/vuln/detail/CVE-2025-38244"], "aliases": ["CVE-2025-38244"], "assigner": "Linux", "epss": 0.01, "enisaIdProduct": [{"id": "01001f87-c340-3ab5-b308-86fd37e1ea7b", "product": {"name": "Linux"}, "product_version": "patch: 6.16-rc4"}, {"id": "14cb4ea9-fb15-3685-9572-2361038a56a8", "product": {"name": "Linux"}, "product_version": "d7d7a66aacd6fd8ca57baf08a7bac5421282f6f8 <fe035dc78aa6ca8f862857d45beaf7a0e03206ca"}, {"id": "156c831d-644e-3c4e-bd35-ff5db04d2e38", "product": {"name": "Linux"}, "product_version": "d7d7a66aacd6fd8ca57baf08a7bac5421282f6f8 <711741f94ac3cf9f4e3aa73aa171e76d188c0819"}, {"id": "1c5c04a7-8464-3b58-a24e-4f397de39b0a", "product": {"name": "Linux"}, "product_version": "patch: 6.6.96"}, {"id": "3baf3e4a-c381-3324-95c1-2e35aefab067", "product": {"name": "Linux"}, "product_version": "patch: 6.15.5"}, {"id": "5332b15b-41b8-369e-86a6-1600cbde6848", "product": {"name": "Linux"}, "product_version": "patch: 6.12.36"}, {"id": "86ef8e37-08f1-33b6-bde5-73ff2f047937", "product": {"name": "Linux"}, "product_version": "patch: 6.16"}, {"id": "90eadc04-ba02-38eb-8cea-d1e0b807cbab", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "99c652ea-73d5-37d4-b183-42307dd906bd", "product": {"name": "Linux"}, "product_version": "d7d7a66aacd6fd8ca57baf08a7bac5421282f6f8 <7f3ead8ebc0ef65b6c89a13912b4e80218425629"}, {"id": "b910155d-fb11-3583-8954-e18863597236", "product": {"name": "Linux"}, "product_version": "d7d7a66aacd6fd8ca57baf08a7bac5421282f6f8 <c82c7041258d96e3286f6790ab700e4edd3cc9e3"}, {"id": "dfcb5a1d-b7fe-3739-b109-6b4bf01847c2", "product": {"name": "Linux"}, "product_version": "6.0"}], "enisaIdVendor": [{"id": "d94652de-965d-3de2-b9ff-e33b784c653e", "vendor": {"name": "Linux"}}], "isExploited": false}