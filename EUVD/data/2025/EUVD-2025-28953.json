{"id": "EUVD-2025-28953", "enisaUuid": "34e4b05d-da50-3713-853f-0ff735ce1085", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nbtrfs: qgroup: fix race between quota disable and quota rescan ioctl\n\nThere's a race between a task disabling quotas and another running the\nrescan ioctl that can result in a use-after-free of qgroup records from\nthe fs_info->qgroup_tree rbtree.\n\nThis happens as follows:\n\n1) Task A enters btrfs_ioctl_quota_rescan() -> btrfs_qgroup_rescan();\n\n2) Task B enters btrfs_quota_disable() and calls\n   btrfs_qgroup_wait_for_completion(), which does nothing because at that\n   point fs_info->qgroup_rescan_running is false (it wasn't set yet by\n   task A);\n\n3) Task B calls btrfs_free_qgroup_config() which starts freeing qgroups\n   from fs_info->qgroup_tree without taking the lock fs_info->qgroup_lock;\n\n4) Task A enters qgroup_rescan_zero_tracking() which starts iterating\n   the fs_info->qgroup_tree tree while holding fs_info->qgroup_lock,\n   but task B is freeing qgroup records from that tree without holding\n   the lock, resulting in a use-after-free.\n\nFix this by taking fs_info->qgroup_lock at btrfs_free_qgroup_config().\nAlso at btrfs_qgroup_rescan() don't start the rescan worker if quotas\nwere already disabled.", "datePublished": "2025-09-11T18:35:52", "dateUpdated": "2025-11-03T18:31:40", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/7cda0fdde5d9890976861421d207870500f9aace", "https://git.kernel.org/stable/c/b172535ccba12f0cf7d23b3b840989de47fc104d", "https://git.kernel.org/stable/c/dd0b28d877b293b1d7f8727a7de08ae36b6b9ef0", "https://git.kernel.org/stable/c/c38028ce0d0045ca600b6a8345a0ff92bfb47b66", "https://git.kernel.org/stable/c/2fd0f5ceb997f90f4332ccbab6c7e907e6b2d0eb", "https://git.kernel.org/stable/c/e1249667750399a48cafcf5945761d39fa584edf", "https://nvd.nist.gov/vuln/detail/CVE-2025-39759", "https://lists.debian.org/debian-lts-announce/2025/10/msg00008.html"], "aliases": ["CVE-2025-39759"], "assigner": "Linux", "epss": 0.04, "enisaIdProduct": [{"id": "1d47dbba-dc12-3874-980c-1561a74772e3", "product": {"name": "Linux"}, "product_version": "patch: 6.15.11"}, {"id": "4787b786-22af-370b-8997-1f576a6e86fc", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <b172535ccba12f0cf7d23b3b840989de47fc104d"}, {"id": "4ca5dc39-4cab-35d2-a076-b4ebe43a48fb", "product": {"name": "Linux"}, "product_version": "patch: 6.6.103"}, {"id": "5fd71332-0738-369c-9a67-a4d0992d5d4f", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <7cda0fdde5d9890976861421d207870500f9aace"}, {"id": "609b174b-faad-3c93-bb92-ab54d26a873c", "product": {"name": "Linux"}, "product_version": "patch: 6.17"}, {"id": "8a0bbe9d-bacb-3d30-8ecb-467ffe888c27", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <e1249667750399a48cafcf5945761d39fa584edf"}, {"id": "8c1677c8-7519-3d3e-bd72-7aa4b81a3025", "product": {"name": "Linux"}, "product_version": "patch: 6.12.44"}, {"id": "93a64c0f-d042-31d0-9c00-1a53ddb57f34", "product": {"name": "Linux"}, "product_version": "patch: 6.17-rc1"}, {"id": "baf33203-3a16-3734-b6c6-65c01fc008db", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <2fd0f5ceb997f90f4332ccbab6c7e907e6b2d0eb"}, {"id": "c7981c72-77cc-3f25-8222-ec5b1fdc6f78", "product": {"name": "Linux"}, "product_version": "patch: 6.16.2"}, {"id": "f51b4021-edaa-3271-b2f6-4a8d7f8eec0e", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <dd0b28d877b293b1d7f8727a7de08ae36b6b9ef0"}, {"id": "f704fcd5-e63e-37a5-8702-ac32c1f9cc76", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <c38028ce0d0045ca600b6a8345a0ff92bfb47b66"}, {"id": "f8803cf3-d84f-3ba8-afb8-fac54347c0c6", "product": {"name": "Linux"}, "product_version": "patch: 6.1.149"}], "enisaIdVendor": [{"id": "3e05c503-17be-3e42-ab02-40ae21d57fa0", "vendor": {"name": "Linux"}}], "isExploited": false}