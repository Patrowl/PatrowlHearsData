{"id": "EUVD-2025-201206", "enisaUuid": "f7545ee2-eddd-3402-9b7e-13fb9029c1a5", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\ndevlink: rate: Unset parent pointer in devl_rate_nodes_destroy\n\nThe function devl_rate_nodes_destroy is documented to \"Unset parent for\nall rate objects\". However, it was only calling the driver-specific\n`rate_leaf_parent_set` or `rate_node_parent_set` ops and decrementing\nthe parent's refcount, without actually setting the\n`devlink_rate->parent` pointer to NULL.\n\nThis leaves a dangling pointer in the `devlink_rate` struct, which cause\nrefcount error in netdevsim[1] and mlx5[2]. In addition, this is\ninconsistent with the behavior of `devlink_nl_rate_parent_node_set`,\nwhere the parent pointer is correctly cleared.\n\nThis patch fixes the issue by explicitly setting `devlink_rate->parent`\nto NULL after notifying the driver, thus fulfilling the function's\ndocumented behavior for all rate objects.\n\n[1]\nrepro steps:\necho 1 > /sys/bus/netdevsim/new_device\ndevlink dev eswitch set netdevsim/netdevsim1 mode switchdev\necho 1 > /sys/bus/netdevsim/devices/netdevsim1/sriov_numvfs\ndevlink port function rate add netdevsim/netdevsim1/test_node\ndevlink port function rate set netdevsim/netdevsim1/128 parent test_node\necho 1 > /sys/bus/netdevsim/del_device\n\ndmesg:\nrefcount_t: decrement hit 0; leaking memory.\nWARNING: CPU: 8 PID: 1530 at lib/refcount.c:31 refcount_warn_saturate+0x42/0xe0\nCPU: 8 UID: 0 PID: 1530 Comm: bash Not tainted 6.18.0-rc4+ #1 NONE\nHardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS rel-1.16.0-0-gd239552ce722-prebuilt.qemu.org 04/01/2014\nRIP: 0010:refcount_warn_saturate+0x42/0xe0\nCall Trace:\n <TASK>\n devl_rate_leaf_destroy+0x8d/0x90\n __nsim_dev_port_del+0x6c/0x70 [netdevsim]\n nsim_dev_reload_destroy+0x11c/0x140 [netdevsim]\n nsim_drv_remove+0x2b/0xb0 [netdevsim]\n device_release_driver_internal+0x194/0x1f0\n bus_remove_device+0xc6/0x130\n device_del+0x159/0x3c0\n device_unregister+0x1a/0x60\n del_device_store+0x111/0x170 [netdevsim]\n kernfs_fop_write_iter+0x12e/0x1e0\n vfs_write+0x215/0x3d0\n ksys_write+0x5f/0xd0\n do_syscall_64+0x55/0x10f0\n entry_SYSCALL_64_after_hwframe+0x4b/0x53\n\n[2]\ndevlink dev eswitch set pci/0000:08:00.0 mode switchdev\ndevlink port add pci/0000:08:00.0 flavour pcisf pfnum 0 sfnum 1000\ndevlink port function rate add pci/0000:08:00.0/group1\ndevlink port function rate set pci/0000:08:00.0/32768 parent group1\nmodprobe -r mlx5_ib mlx5_fwctl mlx5_core\n\ndmesg:\nrefcount_t: decrement hit 0; leaking memory.\nWARNING: CPU: 7 PID: 16151 at lib/refcount.c:31 refcount_warn_saturate+0x42/0xe0\nCPU: 7 UID: 0 PID: 16151 Comm: bash Not tainted 6.17.0-rc7_for_upstream_min_debug_2025_10_02_12_44 #1 NONE\nHardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS rel-1.16.3-0-ga6ed6b701f0a-prebuilt.qemu.org 04/01/2014\nRIP: 0010:refcount_warn_saturate+0x42/0xe0\nCall Trace:\n <TASK>\n devl_rate_leaf_destroy+0x8d/0x90\n mlx5_esw_offloads_devlink_port_unregister+0x33/0x60 [mlx5_core]\n mlx5_esw_offloads_unload_rep+0x3f/0x50 [mlx5_core]\n mlx5_eswitch_unload_sf_vport+0x40/0x90 [mlx5_core]\n mlx5_sf_esw_event+0xc4/0x120 [mlx5_core]\n notifier_call_chain+0x33/0xa0\n blocking_notifier_call_chain+0x3b/0x50\n mlx5_eswitch_disable_locked+0x50/0x110 [mlx5_core]\n mlx5_eswitch_disable+0x63/0x90 [mlx5_core]\n mlx5_unload+0x1d/0x170 [mlx5_core]\n mlx5_uninit_one+0xa2/0x130 [mlx5_core]\n remove_one+0x78/0xd0 [mlx5_core]\n pci_device_remove+0x39/0xa0\n device_release_driver_internal+0x194/0x1f0\n unbind_store+0x99/0xa0\n kernfs_fop_write_iter+0x12e/0x1e0\n vfs_write+0x215/0x3d0\n ksys_write+0x5f/0xd0\n do_syscall_64+0x53/0x1f0\n entry_SYSCALL_64_after_hwframe+0x4b/0x53", "datePublished": "2025-12-04T16:08:13", "dateUpdated": "2025-12-04T16:08:13", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/715d9cda646a8a38ea8b2bb5afb679a7464055e2", "https://git.kernel.org/stable/c/c70df6c17d389cc743f0eb30160e2d6bc6910db8", "https://git.kernel.org/stable/c/542f45486f1ce2d2dde75bd85aca0389ef7046c3", "https://git.kernel.org/stable/c/f94c1a114ac209977bdf5ca841b98424295ab1f0", "https://nvd.nist.gov/vuln/detail/CVE-2025-40251"], "aliases": ["CVE-2025-40251"], "assigner": "Linux", "epss": 0.02, "enisaIdProduct": [{"id": "18846663-7303-3080-a358-a47949bf5674", "product": {"name": "Linux"}, "product_version": "d7555984507822458b32a6405881038241d140be <f94c1a114ac209977bdf5ca841b98424295ab1f0"}, {"id": "1ab32b68-03b5-3db3-b8d8-2026e495af66", "product": {"name": "Linux"}, "product_version": "patch: 6.6.118"}, {"id": "1b02afaa-4e05-3851-809f-b46b3744e0b9", "product": {"name": "Linux"}, "product_version": "d7555984507822458b32a6405881038241d140be <542f45486f1ce2d2dde75bd85aca0389ef7046c3"}, {"id": "45bcf88e-8ed1-37df-bd20-e75a91345e8c", "product": {"name": "Linux"}, "product_version": "patch: 6.12.60"}, {"id": "7627bb0c-93f6-3440-9c13-d09a2f7c7903", "product": {"name": "Linux"}, "product_version": "5.14"}, {"id": "99b55293-f3e2-34fa-a99c-abbe922285e6", "product": {"name": "Linux"}, "product_version": "d7555984507822458b32a6405881038241d140be <715d9cda646a8a38ea8b2bb5afb679a7464055e2"}, {"id": "b4c0c8c8-09e6-35dd-984c-ded872263281", "product": {"name": "Linux"}, "product_version": "d7555984507822458b32a6405881038241d140be <c70df6c17d389cc743f0eb30160e2d6bc6910db8"}, {"id": "b955c8f4-09b5-3722-ab63-d0e7e6164e79", "product": {"name": "Linux"}, "product_version": "patch: 6.18"}, {"id": "e8970049-cb83-33d7-a7ee-9efb8cb3a96f", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "f5a04023-f88b-3d0f-8d4a-9cd58a35143d", "product": {"name": "Linux"}, "product_version": "patch: 6.17.10"}], "enisaIdVendor": [{"id": "a94d8685-6635-38ce-87f9-78d5521b4a22", "vendor": {"name": "Linux"}}], "isExploited": false}