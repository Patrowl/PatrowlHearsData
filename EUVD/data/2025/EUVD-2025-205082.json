{"id": "EUVD-2025-205082", "enisaUuid": "4cf34586-7f98-374a-bcda-01ba55addacb", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nnbd: defer config put in recv_work\n\nThere is one uaf issue in recv_work when running NBD_CLEAR_SOCK and\nNBD_CMD_RECONFIGURE:\n  nbd_genl_connect     // conf_ref=2 (connect and recv_work A)\n  nbd_open\t       // conf_ref=3\n  recv_work A done     // conf_ref=2\n  NBD_CLEAR_SOCK       // conf_ref=1\n  nbd_genl_reconfigure // conf_ref=2 (trigger recv_work B)\n  close nbd\t       // conf_ref=1\n  recv_work B\n    config_put         // conf_ref=0\n    atomic_dec(&config->recv_threads); -> UAF\n\nOr only running NBD_CLEAR_SOCK:\n  nbd_genl_connect   // conf_ref=2\n  nbd_open \t     // conf_ref=3\n  NBD_CLEAR_SOCK     // conf_ref=2\n  close nbd\n    nbd_release\n      config_put     // conf_ref=1\n  recv_work\n    config_put \t     // conf_ref=0\n    atomic_dec(&config->recv_threads); -> UAF\n\nCommit 87aac3a80af5 (\"nbd: call nbd_config_put() before notifying the\nwaiter\") moved nbd_config_put() to run before waking up the waiter in\nrecv_work, in order to ensure that nbd_start_device_ioctl() would not\nbe woken up while nbd->task_recv was still uncleared.\n\nHowever, in nbd_start_device_ioctl(), after being woken up it explicitly\ncalls flush_workqueue() to make sure all current works are finished.\nTherefore, there is no need to move the config put ahead of the wakeup.\n\nMove nbd_config_put() to the end of recv_work, so that the reference is\nheld for the whole lifetime of the worker thread. This makes sure the\nconfig cannot be freed while recv_work is still running, even if clear\n+ reconfigure interleave.\n\nIn addition, we don't need to worry about recv_work dropping the last\nnbd_put (which causes deadlock):\n\npath A (netlink with NBD_CFLAG_DESTROY_ON_DISCONNECT):\n  connect  // nbd_refs=1 (trigger recv_work)\n  open nbd // nbd_refs=2\n  NBD_CLEAR_SOCK\n  close nbd\n    nbd_release\n      nbd_disconnect_and_put\n        flush_workqueue // recv_work done\n      nbd_config_put\n        nbd_put // nbd_refs=1\n      nbd_put // nbd_refs=0\n        queue_work\n\npath B (netlink without NBD_CFLAG_DESTROY_ON_DISCONNECT):\n  connect  // nbd_refs=2 (trigger recv_work)\n  open nbd // nbd_refs=3\n  NBD_CLEAR_SOCK // conf_refs=2\n  close nbd\n    nbd_release\n      nbd_config_put // conf_refs=1\n      nbd_put // nbd_refs=2\n  recv_work done // conf_refs=0, nbd_refs=1\n  rmmod // nbd_refs=0\n\nDepends-on: e2daec488c57 (\"nbd: Fix hungtask when nbd_config_put\")", "datePublished": "2025-12-24T12:30:29", "dateUpdated": "2025-12-24T12:30:30", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/6b69593f72e1bfba6ca47ca8d9b619341fded7d6", "https://git.kernel.org/stable/c/443a1721806b6ff6303b5229e9811d68172d622f", "https://git.kernel.org/stable/c/742012f6bf29553fdc460bf646a58df3a7b43d01", "https://git.kernel.org/stable/c/9517b82d8d422d426a988b213fdd45c6b417b86d", "https://nvd.nist.gov/vuln/detail/CVE-2025-68372"], "aliases": ["CVE-2025-68372"], "assigner": "Linux", "epss": 0.02, "enisaIdProduct": [{"id": "3cc58481-b942-300a-89c1-e195b87f6215", "product": {"name": "Linux"}, "product_version": "patch: 6.12.63"}, {"id": "3d8747f0-272d-32c1-b2ed-6a26ceed504c", "product": {"name": "Linux"}, "product_version": "0a4e383fc3aa6540f804c4fd1184a96ae5de6ef8"}, {"id": "47987a68-2f81-3b73-9dd9-6176e610cb8a", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "52215af0-e241-3e9d-a8ec-acd8a76c339f", "product": {"name": "Linux"}, "product_version": "patch: 6.19-rc1"}, {"id": "6aeeb3c9-fa02-3dbf-8d69-844f0fb49886", "product": {"name": "Linux"}, "product_version": "87aac3a80af5cbad93e63250e8a1e19095ba0d30 <9517b82d8d422d426a988b213fdd45c6b417b86d"}, {"id": "6f99360e-d336-3856-aef2-862c211a1980", "product": {"name": "Linux"}, "product_version": "patch: 6.18.2"}, {"id": "7c235df3-82d4-32cc-af30-9f6a7ace1a62", "product": {"name": "Linux"}, "product_version": "742fd49cf811ca164489e339b862e3fb8e240a73"}, {"id": "7fa506fb-80b8-32d4-94f1-7f70dd3b3aa8", "product": {"name": "Linux"}, "product_version": "87aac3a80af5cbad93e63250e8a1e19095ba0d30 <742012f6bf29553fdc460bf646a58df3a7b43d01"}, {"id": "88578693-9762-30b1-988d-925df4d3c8f6", "product": {"name": "Linux"}, "product_version": "2ef6f4bd60411934e3fc2715442c2afe70f84bf3"}, {"id": "9cbb12d5-0a24-3671-977b-0f311681014d", "product": {"name": "Linux"}, "product_version": "patch: 6.17.13"}, {"id": "af424859-6c52-3a46-aa69-0b5d25756100", "product": {"name": "Linux"}, "product_version": "5.10"}, {"id": "b6053bfa-c3de-3e57-bc09-fd38ae360bf4", "product": {"name": "Linux"}, "product_version": "87aac3a80af5cbad93e63250e8a1e19095ba0d30 <6b69593f72e1bfba6ca47ca8d9b619341fded7d6"}, {"id": "c85b6500-9183-32d9-a383-d3cf4337e598", "product": {"name": "Linux"}, "product_version": "87aac3a80af5cbad93e63250e8a1e19095ba0d30 <443a1721806b6ff6303b5229e9811d68172d622f"}, {"id": "ce73d764-75d6-39a3-aa26-d0bafa139b7f", "product": {"name": "Linux"}, "product_version": "14df8724aeeef338172e2a2d6efadc989921ca0f"}], "enisaIdVendor": [{"id": "fd571240-2a05-3413-9c20-97412606885c", "vendor": {"name": "Linux"}}], "isExploited": false}