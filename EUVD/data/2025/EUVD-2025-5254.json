{"id": "EUVD-2025-5254", "enisaUuid": "22f46a1c-2821-3fbb-8f46-4ce6ee25e3d7", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nnet_sched: sch_sfq: don't allow 1 packet limit\n\nThe current implementation does not work correctly with a limit of\n1. iproute2 actually checks for this and this patch adds the check in\nkernel as well.\n\nThis fixes the following syzkaller reported crash:\n\nUBSAN: array-index-out-of-bounds in net/sched/sch_sfq.c:210:6\nindex 65535 is out of range for type 'struct sfq_head[128]'\nCPU: 0 PID: 2569 Comm: syz-executor101 Not tainted 5.10.0-smp-DEV #1\nHardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024\nCall Trace:\n  __dump_stack lib/dump_stack.c:79 [inline]\n  dump_stack+0x125/0x19f lib/dump_stack.c:120\n  ubsan_epilogue lib/ubsan.c:148 [inline]\n  __ubsan_handle_out_of_bounds+0xed/0x120 lib/ubsan.c:347\n  sfq_link net/sched/sch_sfq.c:210 [inline]\n  sfq_dec+0x528/0x600 net/sched/sch_sfq.c:238\n  sfq_dequeue+0x39b/0x9d0 net/sched/sch_sfq.c:500\n  sfq_reset+0x13/0x50 net/sched/sch_sfq.c:525\n  qdisc_reset+0xfe/0x510 net/sched/sch_generic.c:1026\n  tbf_reset+0x3d/0x100 net/sched/sch_tbf.c:319\n  qdisc_reset+0xfe/0x510 net/sched/sch_generic.c:1026\n  dev_reset_queue+0x8c/0x140 net/sched/sch_generic.c:1296\n  netdev_for_each_tx_queue include/linux/netdevice.h:2350 [inline]\n  dev_deactivate_many+0x6dc/0xc20 net/sched/sch_generic.c:1362\n  __dev_close_many+0x214/0x350 net/core/dev.c:1468\n  dev_close_many+0x207/0x510 net/core/dev.c:1506\n  unregister_netdevice_many+0x40f/0x16b0 net/core/dev.c:10738\n  unregister_netdevice_queue+0x2be/0x310 net/core/dev.c:10695\n  unregister_netdevice include/linux/netdevice.h:2893 [inline]\n  __tun_detach+0x6b6/0x1600 drivers/net/tun.c:689\n  tun_detach drivers/net/tun.c:705 [inline]\n  tun_chr_close+0x104/0x1b0 drivers/net/tun.c:3640\n  __fput+0x203/0x840 fs/file_table.c:280\n  task_work_run+0x129/0x1b0 kernel/task_work.c:185\n  exit_task_work include/linux/task_work.h:33 [inline]\n  do_exit+0x5ce/0x2200 kernel/exit.c:931\n  do_group_exit+0x144/0x310 kernel/exit.c:1046\n  __do_sys_exit_group kernel/exit.c:1057 [inline]\n  __se_sys_exit_group kernel/exit.c:1055 [inline]\n  __x64_sys_exit_group+0x3b/0x40 kernel/exit.c:1055\n do_syscall_64+0x6c/0xd0\n entry_SYSCALL_64_after_hwframe+0x61/0xcb\nRIP: 0033:0x7fe5e7b52479\nCode: Unable to access opcode bytes at RIP 0x7fe5e7b5244f.\nRSP: 002b:00007ffd3c800398 EFLAGS: 00000246 ORIG_RAX: 00000000000000e7\nRAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe5e7b52479\nRDX: 000000000000003c RSI: 00000000000000e7 RDI: 0000000000000000\nRBP: 00007fe5e7bcd2d0 R08: ffffffffffffffb8 R09: 0000000000000014\nR10: 0000000000000000 R11: 0000000000000246 R12: 00007fe5e7bcd2d0\nR13: 0000000000000000 R14: 00007fe5e7bcdd20 R15: 00007fe5e7b24270\n\nThe crash can be also be reproduced with the following (with a tc\nrecompiled to allow for sfq limits of 1):\n\ntc qdisc add dev dummy0 handle 1: root tbf rate 1Kbit burst 100b lat 1s\n../iproute2-6.9.0/tc/tc qdisc add dev dummy0 handle 2: parent 1:10 sfq limit 1\nifconfig dummy0 up\nping -I dummy0 -f -c2 -W0.1 8.8.8.8\nsleep 1\n\nScenario that triggers the crash:\n\n* the first packet is sent and queued in TBF and SFQ; qdisc qlen is 1\n\n* TBF dequeues: it peeks from SFQ which moves the packet to the\n  gso_skb list and keeps qdisc qlen set to 1. TBF is out of tokens so\n  it schedules itself for later.\n\n* the second packet is sent and TBF tries to queues it to SFQ. qdisc\n  qlen is now 2 and because the SFQ limit is 1 the packet is dropped\n  by SFQ. At this point qlen is 1, and all of the SFQ slots are empty,\n  however q->tail is not NULL.\n\nAt this point, assuming no more packets are queued, when sch_dequeue\nruns again it will decrement the qlen for the current empty slot\ncausing an underflow and the subsequent out of bounds access.", "datePublished": "2025-02-27T02:07:16", "dateUpdated": "2025-11-03T19:33:07", "baseScore": 0.0, "references": ["https://nvd.nist.gov/vuln/detail/CVE-2024-57996", "https://git.kernel.org/stable/c/10685681bafce6febb39770f3387621bf5d67d0b", "https://git.kernel.org/stable/c/35d0137305ae2f97260a9047f445bd4434bd6cc7", "https://git.kernel.org/stable/c/7d8947f2153ee9c5ab4cb17861a11cc45f30e8c4", "https://git.kernel.org/stable/c/7fefc294204f10a3405f175f4ac2be16d63f135e", "https://git.kernel.org/stable/c/833e9a1c27b82024db7ff5038a51651f48f05e5e", "https://git.kernel.org/stable/c/e12f6013d0a69660e8b99bfe381b9546ae667328", "https://git.kernel.org/stable/c/1e6d9d87626cf89eeffb4d943db12cb5b10bf961", "https://git.kernel.org/stable/c/1b562b7f9231432da40d12e19786c1bd7df653a7", "https://lists.debian.org/debian-lts-announce/2025/03/msg00028.html", "https://lists.debian.org/debian-lts-announce/2025/10/msg00007.html"], "aliases": ["CVE-2024-57996", "GHSA-25pp-pjqx-3f66"], "assigner": "Linux", "epss": 0.05, "enisaIdProduct": [{"id": "080231ad-00e9-3f2d-9077-65a4947282cd", "product": {"name": "Linux"}, "product_version": "patch: 5.4.297"}, {"id": "0e40c5c3-8140-3e6e-903c-98a52b774486", "product": {"name": "Linux"}, "product_version": "patch: 6.14"}, {"id": "1aaa8169-cd04-30e3-992a-980980876e8e", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <1e6d9d87626cf89eeffb4d943db12cb5b10bf961"}, {"id": "340d276b-d43b-3ecc-99d1-ae7760c1dcc1", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <7d8947f2153ee9c5ab4cb17861a11cc45f30e8c4"}, {"id": "3dc93d89-f355-3761-a4ea-5fed47180a91", "product": {"name": "Linux"}, "product_version": "patch: 6.13.2"}, {"id": "3fda320d-c31d-3558-a711-f7acfe23429a", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <e12f6013d0a69660e8b99bfe381b9546ae667328"}, {"id": "51335825-5a55-3c71-b319-ce70fe06d7ee", "product": {"name": "Linux"}, "product_version": "patch: 5.15.186"}, {"id": "522893d3-5a75-35b8-8356-f34690bfdfa7", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "6763db9f-da37-3548-b0b2-24bb33903c2c", "product": {"name": "Linux"}, "product_version": "2.6.12"}, {"id": "7b488e57-301d-3593-aef1-906a95befb9b", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <7fefc294204f10a3405f175f4ac2be16d63f135e"}, {"id": "9dc3ec7e-ee96-39c8-a9c8-d88542815a3d", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <10685681bafce6febb39770f3387621bf5d67d0b"}, {"id": "ab1f9706-2bed-34cc-89a1-8800b7581c93", "product": {"name": "Linux"}, "product_version": "patch: 6.12.13"}, {"id": "ad181b75-7585-3b69-9d68-e12efacf2aaa", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <1b562b7f9231432da40d12e19786c1bd7df653a7"}, {"id": "afcc7464-c817-336f-b995-056de5ac7144", "product": {"name": "Linux"}, "product_version": "patch: 6.6.76"}, {"id": "b0256ea2-4387-3f9a-b77a-036984af7161", "product": {"name": "Linux"}, "product_version": "patch: 6.1.129"}, {"id": "c2d33119-787a-37b4-bf2b-50d57706cd12", "product": {"name": "Linux"}, "product_version": "patch: 5.10.239"}, {"id": "d2c3f765-154b-3283-a66c-328964f42693", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <35d0137305ae2f97260a9047f445bd4434bd6cc7"}, {"id": "d39b2f6f-e7df-3e02-9166-6dcb02590e8b", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <833e9a1c27b82024db7ff5038a51651f48f05e5e"}], "enisaIdVendor": [{"id": "193a209b-67b4-38b0-8d5c-ac2ca39736c7", "vendor": {"name": "Linux"}}], "isExploited": false}