{"id": "EUVD-2025-34577", "enisaUuid": "5ee5a4cd-18b6-32f5-b91c-b70a11750737", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nmedia: b2c2: Fix use-after-free causing by irq_check_work in flexcop_pci_remove\n\nThe original code uses cancel_delayed_work() in flexcop_pci_remove(), which\ndoes not guarantee that the delayed work item irq_check_work has fully\ncompleted if it was already running. This leads to use-after-free scenarios\nwhere flexcop_pci_remove() may free the flexcop_device while irq_check_work\nis still active and attempts to dereference the device.\n\nA typical race condition is illustrated below:\n\nCPU 0 (remove)                         | CPU 1 (delayed work callback)\nflexcop_pci_remove()                   | flexcop_pci_irq_check_work()\n  cancel_delayed_work()                |\n  flexcop_device_kfree(fc_pci->fc_dev) |\n                                       |   fc = fc_pci->fc_dev; // UAF\n\nThis is confirmed by a KASAN report:\n\n==================================================================\nBUG: KASAN: slab-use-after-free in __run_timer_base.part.0+0x7d7/0x8c0\nWrite of size 8 at addr ffff8880093aa8c8 by task bash/135\n...\nCall Trace:\n <IRQ>\n dump_stack_lvl+0x55/0x70\n print_report+0xcf/0x610\n ? __run_timer_base.part.0+0x7d7/0x8c0\n kasan_report+0xb8/0xf0\n ? __run_timer_base.part.0+0x7d7/0x8c0\n __run_timer_base.part.0+0x7d7/0x8c0\n ? __pfx___run_timer_base.part.0+0x10/0x10\n ? __pfx_read_tsc+0x10/0x10\n ? ktime_get+0x60/0x140\n ? lapic_next_event+0x11/0x20\n ? clockevents_program_event+0x1d4/0x2a0\n run_timer_softirq+0xd1/0x190\n handle_softirqs+0x16a/0x550\n irq_exit_rcu+0xaf/0xe0\n sysvec_apic_timer_interrupt+0x70/0x80\n </IRQ>\n...\n\nAllocated by task 1:\n kasan_save_stack+0x24/0x50\n kasan_save_track+0x14/0x30\n __kasan_kmalloc+0x7f/0x90\n __kmalloc_noprof+0x1be/0x460\n flexcop_device_kmalloc+0x54/0xe0\n flexcop_pci_probe+0x1f/0x9d0\n local_pci_probe+0xdc/0x190\n pci_device_probe+0x2fe/0x470\n really_probe+0x1ca/0x5c0\n __driver_probe_device+0x248/0x310\n driver_probe_device+0x44/0x120\n __driver_attach+0xd2/0x310\n bus_for_each_dev+0xed/0x170\n bus_add_driver+0x208/0x500\n driver_register+0x132/0x460\n do_one_initcall+0x89/0x300\n kernel_init_freeable+0x40d/0x720\n kernel_init+0x1a/0x150\n ret_from_fork+0x10c/0x1a0\n ret_from_fork_asm+0x1a/0x30\n\nFreed by task 135:\n kasan_save_stack+0x24/0x50\n kasan_save_track+0x14/0x30\n kasan_save_free_info+0x3a/0x60\n __kasan_slab_free+0x3f/0x50\n kfree+0x137/0x370\n flexcop_device_kfree+0x32/0x50\n pci_device_remove+0xa6/0x1d0\n device_release_driver_internal+0xf8/0x210\n pci_stop_bus_device+0x105/0x150\n pci_stop_and_remove_bus_device_locked+0x15/0x30\n remove_store+0xcc/0xe0\n kernfs_fop_write_iter+0x2c3/0x440\n vfs_write+0x871/0xd70\n ksys_write+0xee/0x1c0\n do_syscall_64+0xac/0x280\n entry_SYSCALL_64_after_hwframe+0x77/0x7f\n...\n\nReplace cancel_delayed_work() with cancel_delayed_work_sync() to ensure\nthat the delayed work item is properly canceled and any executing delayed\nwork has finished before the device memory is deallocated.\n\nThis bug was initially identified through static analysis. To reproduce\nand test it, I simulated the B2C2 FlexCop PCI device in QEMU and introduced\nartificial delays within the flexcop_pci_irq_check_work() function to\nincrease the likelihood of triggering the bug.", "datePublished": "2025-10-15T07:58:21", "dateUpdated": "2025-12-01T06:16:07", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/bb10a9ddc8d6c5dbf098f21eb1055a652652e524", "https://git.kernel.org/stable/c/514a519baa9e2be7ddc2714bd730bc5a883e1244", "https://git.kernel.org/stable/c/3ffabc79388e68877d9c02f724a0b7a38d519daf", "https://git.kernel.org/stable/c/6a92f5796880f5aa345f0fed53ef511e3fd6f706", "https://git.kernel.org/stable/c/01e03fb7db419d39e18d6090d4873c1bff103914", "https://nvd.nist.gov/vuln/detail/CVE-2025-39996", "https://git.kernel.org/stable/c/d502df8a716d993fa0f9d8c00684f1190750e28e", "https://git.kernel.org/stable/c/120e221b4bbe9d0f6c09b5c4dc53ca4ad91d956b", "https://git.kernel.org/stable/c/607010d07b8a509b01ed15ea12744acac6536a98", "https://git.kernel.org/stable/c/bde8173def374230226e8554efb51b271f4066ec"], "aliases": ["CVE-2025-39996"], "assigner": "Linux", "epss": 0.07, "enisaIdProduct": [{"id": "2c0bcbc3-5a65-33f6-9002-e07330802f31", "product": {"name": "Linux"}, "product_version": "382c5546d618f24dc7d6ae7ca33412083720efbf <514a519baa9e2be7ddc2714bd730bc5a883e1244"}, {"id": "2cfbb578-3085-3fa5-9ce8-9270cde5bd56", "product": {"name": "Linux"}, "product_version": "patch: 5.4.301"}, {"id": "2feff89b-c4c4-3509-8b52-2aa1f70343c3", "product": {"name": "Linux"}, "product_version": "patch: 6.17.1"}, {"id": "308a86f5-2e31-31e1-8da3-a0db4ee3acee", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "3ae441d6-947c-3641-b69a-7b2f5ea1b414", "product": {"name": "Linux"}, "product_version": "382c5546d618f24dc7d6ae7ca33412083720efbf <01e03fb7db419d39e18d6090d4873c1bff103914"}, {"id": "3b6919d1-1a36-31d6-9b34-f9742384e04d", "product": {"name": "Linux"}, "product_version": "382c5546d618f24dc7d6ae7ca33412083720efbf <6a92f5796880f5aa345f0fed53ef511e3fd6f706"}, {"id": "464daeb8-71aa-31d9-b5e0-cb07f9e5e9b0", "product": {"name": "Linux"}, "product_version": "patch: 6.12.51"}, {"id": "4788fff6-8b85-38a1-a9b7-54d091f86045", "product": {"name": "Linux"}, "product_version": "382c5546d618f24dc7d6ae7ca33412083720efbf <3ffabc79388e68877d9c02f724a0b7a38d519daf"}, {"id": "68c33377-c7eb-3e7c-b068-214227c90203", "product": {"name": "Linux"}, "product_version": "patch: 6.18-rc1"}, {"id": "835b4809-51f5-3c37-b1f4-9bed8f20bdc4", "product": {"name": "Linux"}, "product_version": "2.6.29"}, {"id": "83d7868d-84f7-3059-8cc7-e41e56359e87", "product": {"name": "Linux"}, "product_version": "patch: 6.16.11"}, {"id": "84eca7eb-0f98-3189-8959-b2964021380c", "product": {"name": "Linux"}, "product_version": "382c5546d618f24dc7d6ae7ca33412083720efbf <d502df8a716d993fa0f9d8c00684f1190750e28e"}, {"id": "9460ac3a-2648-32a2-bb87-f923b54f96ac", "product": {"name": "Linux"}, "product_version": "patch: 5.10.246"}, {"id": "b9da9780-de67-392a-80eb-0a12d84323b5", "product": {"name": "Linux"}, "product_version": "patch: 5.15.195"}, {"id": "c32ed522-a31f-3150-b0d5-dc2d73da6a2a", "product": {"name": "Linux"}, "product_version": "382c5546d618f24dc7d6ae7ca33412083720efbf <bb10a9ddc8d6c5dbf098f21eb1055a652652e524"}, {"id": "cdf7d649-ac9f-3b86-bc8e-ca9e6bf37f23", "product": {"name": "Linux"}, "product_version": "382c5546d618f24dc7d6ae7ca33412083720efbf <607010d07b8a509b01ed15ea12744acac6536a98"}, {"id": "cf66e572-d717-3722-b327-4617361a2d99", "product": {"name": "Linux"}, "product_version": "382c5546d618f24dc7d6ae7ca33412083720efbf <bde8173def374230226e8554efb51b271f4066ec"}, {"id": "d3d9f66a-0b42-393c-b525-fb2d56c04711", "product": {"name": "Linux"}, "product_version": "patch: 6.6.110"}, {"id": "e0360070-ab1d-38e5-a3b2-c044da3acc6a", "product": {"name": "Linux"}, "product_version": "382c5546d618f24dc7d6ae7ca33412083720efbf <120e221b4bbe9d0f6c09b5c4dc53ca4ad91d956b"}, {"id": "eac3db9a-2233-3009-b2a9-77a3854f3929", "product": {"name": "Linux"}, "product_version": "patch: 6.1.156"}, {"id": "ec916be2-d785-3334-b620-fed709b4d128", "product": {"name": "Linux"}, "product_version": "patch: 6.18"}], "enisaIdVendor": [{"id": "22e74c97-5eb7-3c60-9d04-bdc26648cfd3", "vendor": {"name": "Linux"}}], "isExploited": false}