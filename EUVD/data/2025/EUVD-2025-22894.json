{"id": "EUVD-2025-22894", "enisaUuid": "43d55d01-5c47-39b3-b53a-098a52b84e4d", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nnet/sched: Return NULL when htb_lookup_leaf encounters an empty rbtree\n\nhtb_lookup_leaf has a BUG_ON that can trigger with the following:\n\ntc qdisc del dev lo root\ntc qdisc add dev lo root handle 1: htb default 1\ntc class add dev lo parent 1: classid 1:1 htb rate 64bit\ntc qdisc add dev lo parent 1:1 handle 2: netem\ntc qdisc add dev lo parent 2:1 handle 3: blackhole\nping -I lo -c1 -W0.001 127.0.0.1\n\nThe root cause is the following:\n\n1. htb_dequeue calls htb_dequeue_tree which calls the dequeue handler on\n   the selected leaf qdisc\n2. netem_dequeue calls enqueue on the child qdisc\n3. blackhole_enqueue drops the packet and returns a value that is not\n   just NET_XMIT_SUCCESS\n4. Because of this, netem_dequeue calls qdisc_tree_reduce_backlog, and\n   since qlen is now 0, it calls htb_qlen_notify -> htb_deactivate ->\n   htb_deactiviate_prios -> htb_remove_class_from_row -> htb_safe_rb_erase\n5. As this is the only class in the selected hprio rbtree,\n   __rb_change_child in __rb_erase_augmented sets the rb_root pointer to\n   NULL\n6. Because blackhole_dequeue returns NULL, netem_dequeue returns NULL,\n   which causes htb_dequeue_tree to call htb_lookup_leaf with the same\n   hprio rbtree, and fail the BUG_ON\n\nThe function graph for this scenario is shown here:\n 0)               |  htb_enqueue() {\n 0) + 13.635 us   |    netem_enqueue();\n 0)   4.719 us    |    htb_activate_prios();\n 0) # 2249.199 us |  }\n 0)               |  htb_dequeue() {\n 0)   2.355 us    |    htb_lookup_leaf();\n 0)               |    netem_dequeue() {\n 0) + 11.061 us   |      blackhole_enqueue();\n 0)               |      qdisc_tree_reduce_backlog() {\n 0)               |        qdisc_lookup_rcu() {\n 0)   1.873 us    |          qdisc_match_from_root();\n 0)   6.292 us    |        }\n 0)   1.894 us    |        htb_search();\n 0)               |        htb_qlen_notify() {\n 0)   2.655 us    |          htb_deactivate_prios();\n 0)   6.933 us    |        }\n 0) + 25.227 us   |      }\n 0)   1.983 us    |      blackhole_dequeue();\n 0) + 86.553 us   |    }\n 0) # 2932.761 us |    qdisc_warn_nonwc();\n 0)               |    htb_lookup_leaf() {\n 0)               |      BUG_ON();\n ------------------------------------------\n\nThe full original bug report can be seen here [1].\n\nWe can fix this just by returning NULL instead of the BUG_ON,\nas htb_dequeue_tree returns NULL when htb_lookup_leaf returns\nNULL.\n\n[1] https://lore.kernel.org/netdev/pF5XOOIim0IuEfhI-SOxTgRvNoDwuux7UHKnE_Y5-zVd4wmGvNk2ceHjKb8ORnzw0cGwfmVu42g9dL7XyJLf1NEzaztboTWcm0Ogxuojoeo=@willsroot.io/", "datePublished": "2025-07-28T12:30:34", "dateUpdated": "2025-12-22T21:30:30", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/890a5d423ef0a7bd13447ceaffad21189f557301", "https://git.kernel.org/stable/c/7ff2d83ecf2619060f30ecf9fad4f2a700fca344", "https://git.kernel.org/stable/c/e5c480dc62a3025b8428d4818e722da30ad6804f", "https://git.kernel.org/stable/c/3691f84269a23f7edd263e9b6edbc27b7ae332f4", "https://git.kernel.org/stable/c/0e1d5d9b5c5966e2e42e298670808590db5ed628", "https://git.kernel.org/stable/c/fed3570e548a6c9f95c5f4c9e1a7afc1679fd90d", "https://git.kernel.org/stable/c/5c0506cd1b1a3b145bda2612bbf7fe78d186c355", "https://git.kernel.org/stable/c/850226aef8d28a00cf966ef26d2f8f2bff344535", "https://nvd.nist.gov/vuln/detail/CVE-2025-38468", "https://lists.debian.org/debian-lts-announce/2025/10/msg00007.html", "https://lists.debian.org/debian-lts-announce/2025/10/msg00008.html"], "aliases": ["CVE-2025-38468"], "assigner": "Linux", "epss": 0.01, "enisaIdProduct": [{"id": "0f2610cf-78c6-3c57-ba98-674ffbb0b7db", "product": {"name": "Linux"}, "product_version": "512bb43eb5422ee69a1be05ea0d89dc074fac9a2 <5c0506cd1b1a3b145bda2612bbf7fe78d186c355"}, {"id": "2cac1cb4-6055-329b-9b47-99c1ef664049", "product": {"name": "Linux"}, "product_version": "512bb43eb5422ee69a1be05ea0d89dc074fac9a2 <7ff2d83ecf2619060f30ecf9fad4f2a700fca344"}, {"id": "2d728db3-3210-3d4e-9245-34b2a912ecff", "product": {"name": "Linux"}, "product_version": "patch: 6.1.147"}, {"id": "328f6899-fad4-37c2-aca1-677fec870ace", "product": {"name": "Linux"}, "product_version": "512bb43eb5422ee69a1be05ea0d89dc074fac9a2 <3691f84269a23f7edd263e9b6edbc27b7ae332f4"}, {"id": "34212717-1b70-3f17-a1cb-34988fe3bdfc", "product": {"name": "Linux"}, "product_version": "patch: 6.6.100"}, {"id": "37dfcd5b-3f71-332d-8f8f-24b141da03ba", "product": {"name": "Linux"}, "product_version": "512bb43eb5422ee69a1be05ea0d89dc074fac9a2 <850226aef8d28a00cf966ef26d2f8f2bff344535"}, {"id": "3af8236b-9259-346c-bc15-b958eab81b88", "product": {"name": "Linux"}, "product_version": "patch: 6.16"}, {"id": "43def1d8-403d-3ae6-b80b-aaac6c948144", "product": {"name": "Linux"}, "product_version": "patch: 5.10.241"}, {"id": "4a56ab84-8fd9-3cbe-be84-bac4174ce3d6", "product": {"name": "Linux"}, "product_version": "512bb43eb5422ee69a1be05ea0d89dc074fac9a2 <fed3570e548a6c9f95c5f4c9e1a7afc1679fd90d"}, {"id": "57d7b5ae-273f-342e-9510-24d825123a6b", "product": {"name": "Linux"}, "product_version": "patch: 5.4.297"}, {"id": "9c79a1e2-b42b-3118-9c01-8ae7f87c7c94", "product": {"name": "Linux"}, "product_version": "512bb43eb5422ee69a1be05ea0d89dc074fac9a2 <0e1d5d9b5c5966e2e42e298670808590db5ed628"}, {"id": "ae5b668d-7c41-3692-b43d-028641301f29", "product": {"name": "Linux"}, "product_version": "patch: 6.15.8"}, {"id": "b0bbb5b2-4755-3d02-a823-b66468249c2e", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "b523f82a-5b19-32d6-8b16-765b5fc82497", "product": {"name": "Linux"}, "product_version": "patch: 6.12.40"}, {"id": "c249e7b1-3427-3119-855b-ddd65e2049c6", "product": {"name": "Linux"}, "product_version": "512bb43eb5422ee69a1be05ea0d89dc074fac9a2 <e5c480dc62a3025b8428d4818e722da30ad6804f"}, {"id": "cbf956c8-e45f-37c6-b88d-96fd7b28ea4b", "product": {"name": "Linux"}, "product_version": "512bb43eb5422ee69a1be05ea0d89dc074fac9a2 <890a5d423ef0a7bd13447ceaffad21189f557301"}, {"id": "d27b6ae1-df58-3d59-a966-8127936f946b", "product": {"name": "Linux"}, "product_version": "patch: 5.15.190"}, {"id": "d6771d65-d02f-32ec-a098-68eb44316147", "product": {"name": "Linux"}, "product_version": "2.6.29"}], "enisaIdVendor": [{"id": "89028be5-a720-35aa-99ea-8aad085a0402", "vendor": {"name": "Linux"}}], "isExploited": false}