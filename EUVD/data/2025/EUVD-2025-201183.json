{"id": "EUVD-2025-201183", "enisaUuid": "0f2b6955-b4cb-34ca-ab8d-6a6cc6dfe9de", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nfuse: fix livelock in synchronous file put from fuseblk workers\n\nI observed a hang when running generic/323 against a fuseblk server.\nThis test opens a file, initiates a lot of AIO writes to that file\ndescriptor, and closes the file descriptor before the writes complete.\nUnsurprisingly, the AIO exerciser threads are mostly stuck waiting for\nresponses from the fuseblk server:\n\n# cat /proc/372265/task/372313/stack\n[<0>] request_wait_answer+0x1fe/0x2a0 [fuse]\n[<0>] __fuse_simple_request+0xd3/0x2b0 [fuse]\n[<0>] fuse_do_getattr+0xfc/0x1f0 [fuse]\n[<0>] fuse_file_read_iter+0xbe/0x1c0 [fuse]\n[<0>] aio_read+0x130/0x1e0\n[<0>] io_submit_one+0x542/0x860\n[<0>] __x64_sys_io_submit+0x98/0x1a0\n[<0>] do_syscall_64+0x37/0xf0\n[<0>] entry_SYSCALL_64_after_hwframe+0x4b/0x53\n\nBut the /weird/ part is that the fuseblk server threads are waiting for\nresponses from itself:\n\n# cat /proc/372210/task/372232/stack\n[<0>] request_wait_answer+0x1fe/0x2a0 [fuse]\n[<0>] __fuse_simple_request+0xd3/0x2b0 [fuse]\n[<0>] fuse_file_put+0x9a/0xd0 [fuse]\n[<0>] fuse_release+0x36/0x50 [fuse]\n[<0>] __fput+0xec/0x2b0\n[<0>] task_work_run+0x55/0x90\n[<0>] syscall_exit_to_user_mode+0xe9/0x100\n[<0>] do_syscall_64+0x43/0xf0\n[<0>] entry_SYSCALL_64_after_hwframe+0x4b/0x53\n\nThe fuseblk server is fuse2fs so there's nothing all that exciting in\nthe server itself.  So why is the fuse server calling fuse_file_put?\nThe commit message for the fstest sheds some light on that:\n\n\"By closing the file descriptor before calling io_destroy, you pretty\nmuch guarantee that the last put on the ioctx will be done in interrupt\ncontext (during I/O completion).\n\nAha.  AIO fgets a new struct file from the fd when it queues the ioctx.\nThe completion of the FUSE_WRITE command from userspace causes the fuse\nserver to call the AIO completion function.  The completion puts the\nstruct file, queuing a delayed fput to the fuse server task.  When the\nfuse server task returns to userspace, it has to run the delayed fput,\nwhich in the case of a fuseblk server, it does synchronously.\n\nSending the FUSE_RELEASE command sychronously from fuse server threads\nis a bad idea because a client program can initiate enough simultaneous\nAIOs such that all the fuse server threads end up in delayed_fput, and\nnow there aren't any threads left to handle the queued fuse commands.\n\nFix this by only using asynchronous fputs when closing files, and leave\na comment explaining why.", "datePublished": "2025-12-04T14:50:44", "dateUpdated": "2025-12-04T14:50:44", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/548e1f2bac1d4df91a6138f26bb4ab00323fd948", "https://git.kernel.org/stable/c/cfd1aa3e2b71f3327cb373c45a897c9028c62b35", "https://git.kernel.org/stable/c/83b375c6efef69b1066ad2d79601221e7892745a", "https://git.kernel.org/stable/c/bfd17b6138df0122a95989457d8e18ce0b86165e", "https://git.kernel.org/stable/c/b26923512dbe57ae4917bafd31396d22a9d1691a", "https://git.kernel.org/stable/c/f19a1390af448d9e193c08e28ea5f727bf3c3049", "https://git.kernel.org/stable/c/26e5c67deb2e1f42a951f022fdf5b9f7eb747b01", "https://nvd.nist.gov/vuln/detail/CVE-2025-40220"], "aliases": ["CVE-2025-40220"], "assigner": "Linux", "epss": 0.06, "enisaIdProduct": [{"id": "00abb81b-e2e2-3cfe-9e3a-55cfbd619474", "product": {"name": "Linux"}, "product_version": "5a18ec176c934ca1bc9dc61580a5e0e90a9b5733 <b26923512dbe57ae4917bafd31396d22a9d1691a"}, {"id": "3552476b-6ff5-3b7a-ad77-d6da8e5a2fce", "product": {"name": "Linux"}, "product_version": "5a18ec176c934ca1bc9dc61580a5e0e90a9b5733 <83b375c6efef69b1066ad2d79601221e7892745a"}, {"id": "42c336d4-9dd7-3c56-8425-3b786f2b4fc0", "product": {"name": "Linux"}, "product_version": "5a18ec176c934ca1bc9dc61580a5e0e90a9b5733 <26e5c67deb2e1f42a951f022fdf5b9f7eb747b01"}, {"id": "559bec48-0969-3348-be19-625be54048f6", "product": {"name": "Linux"}, "product_version": "patch: 6.6.115"}, {"id": "5ff661cc-0477-3f51-b7b1-857a8374951c", "product": {"name": "Linux"}, "product_version": "patch: 6.17.4"}, {"id": "72abe46b-2790-3cfb-ad09-e3d70aad7bbb", "product": {"name": "Linux"}, "product_version": "5c46eb076e0a1b2c1769287cd6942e4594ade1b1"}, {"id": "818c7263-9ca4-3cc0-a376-225af223df59", "product": {"name": "Linux"}, "product_version": "23d154c71721fd0fa6199851078f32e6bd765664"}, {"id": "92a26750-28b8-394c-8e22-32dad20c48f7", "product": {"name": "Linux"}, "product_version": "5a18ec176c934ca1bc9dc61580a5e0e90a9b5733 <f19a1390af448d9e193c08e28ea5f727bf3c3049"}, {"id": "93fe0b4b-9758-394c-b8ee-f4bb58e66d84", "product": {"name": "Linux"}, "product_version": "patch: 5.15.196"}, {"id": "9d9dda37-40c0-3906-bce4-5414939396dc", "product": {"name": "Linux"}, "product_version": "ca3edc920f5fd7d8ac040caaf109f925c24620a0"}, {"id": "a0e66af9-9e85-3964-ae0f-abbe70d12149", "product": {"name": "Linux"}, "product_version": "patch: 6.18"}, {"id": "a0fd81e9-0288-3bb0-9285-897d46f867ac", "product": {"name": "Linux"}, "product_version": "5a18ec176c934ca1bc9dc61580a5e0e90a9b5733 <cfd1aa3e2b71f3327cb373c45a897c9028c62b35"}, {"id": "a6b48a78-538f-3a92-b0ee-24943976f1d2", "product": {"name": "Linux"}, "product_version": "patch: 5.10.246"}, {"id": "b8963805-2343-3252-a4d9-eb1d28fa624c", "product": {"name": "Linux"}, "product_version": "patch: 6.1.158"}, {"id": "bdcef7a0-bd03-3c72-827c-a1d96b850719", "product": {"name": "Linux"}, "product_version": "9efe56738fecd591b5bf366a325440f9b457ebd6"}, {"id": "c5174942-8bb2-36bc-a835-380164d593b6", "product": {"name": "Linux"}, "product_version": "5a18ec176c934ca1bc9dc61580a5e0e90a9b5733 <bfd17b6138df0122a95989457d8e18ce0b86165e"}, {"id": "d4a98f8a-7377-377d-a338-6e8b85b6af8b", "product": {"name": "Linux"}, "product_version": "5a18ec176c934ca1bc9dc61580a5e0e90a9b5733 <548e1f2bac1d4df91a6138f26bb4ab00323fd948"}, {"id": "de58c716-69ce-3746-9016-8a271be326b4", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "ed00d24c-40d0-3d52-a092-172ea229ad67", "product": {"name": "Linux"}, "product_version": "83e6726210d6c815ce044437106c738eda5ff6f6"}, {"id": "ef836bf3-e1a6-36c7-9d52-c2e26853e9c3", "product": {"name": "Linux"}, "product_version": "patch: 6.12.54"}, {"id": "f8c8e6f3-d57f-398a-8bda-f6059662678b", "product": {"name": "Linux"}, "product_version": "2.6.38"}], "enisaIdVendor": [{"id": "cf430ab5-5b20-3a60-9a6e-3ce26d9b5088", "vendor": {"name": "Linux"}}], "isExploited": false}