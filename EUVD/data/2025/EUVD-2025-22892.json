{"id": "EUVD-2025-22892", "enisaUuid": "c6d47b14-c730-3341-868b-74cf764dabd1", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nnet: vlan: fix VLAN 0 refcount imbalance of toggling filtering during runtime\n\nAssuming the \"rx-vlan-filter\" feature is enabled on a net device, the\n8021q module will automatically add or remove VLAN 0 when the net device\nis put administratively up or down, respectively. There are a couple of\nproblems with the above scheme.\n\nThe first problem is a memory leak that can happen if the \"rx-vlan-filter\"\nfeature is disabled while the device is running:\n\n # ip link add bond1 up type bond mode 0\n # ethtool -K bond1 rx-vlan-filter off\n # ip link del dev bond1\n\nWhen the device is put administratively down the \"rx-vlan-filter\"\nfeature is disabled, so the 8021q module will not remove VLAN 0 and the\nmemory will be leaked [1].\n\nAnother problem that can happen is that the kernel can automatically\ndelete VLAN 0 when the device is put administratively down despite not\nadding it when the device was put administratively up since during that\ntime the \"rx-vlan-filter\" feature was disabled. null-ptr-unref or\nbug_on[2] will be triggered by unregister_vlan_dev() for refcount\nimbalance if toggling filtering during runtime:\n\n$ ip link add bond0 type bond mode 0\n$ ip link add link bond0 name vlan0 type vlan id 0 protocol 802.1q\n$ ethtool -K bond0 rx-vlan-filter off\n$ ifconfig bond0 up\n$ ethtool -K bond0 rx-vlan-filter on\n$ ifconfig bond0 down\n$ ip link del vlan0\n\nRoot cause is as below:\nstep1: add vlan0 for real_dev, such as bond, team.\nregister_vlan_dev\n    vlan_vid_add(real_dev,htons(ETH_P_8021Q),0) //refcnt=1\nstep2: disable vlan filter feature and enable real_dev\nstep3: change filter from 0 to 1\nvlan_device_event\n    vlan_filter_push_vids\n        ndo_vlan_rx_add_vid //No refcnt added to real_dev vlan0\nstep4: real_dev down\nvlan_device_event\n    vlan_vid_del(dev, htons(ETH_P_8021Q), 0); //refcnt=0\n        vlan_info_rcu_free //free vlan0\nstep5: delete vlan0\nunregister_vlan_dev\n    BUG_ON(!vlan_info); //vlan_info is null\n\nFix both problems by noting in the VLAN info whether VLAN 0 was\nautomatically added upon NETDEV_UP and based on that decide whether it\nshould be deleted upon NETDEV_DOWN, regardless of the state of the\n\"rx-vlan-filter\" feature.\n\n[1]\nunreferenced object 0xffff8880068e3100 (size 256):\n  comm \"ip\", pid 384, jiffies 4296130254\n  hex dump (first 32 bytes):\n    00 20 30 0d 80 88 ff ff 00 00 00 00 00 00 00 00  . 0.............\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace (crc 81ce31fa):\n    __kmalloc_cache_noprof+0x2b5/0x340\n    vlan_vid_add+0x434/0x940\n    vlan_device_event.cold+0x75/0xa8\n    notifier_call_chain+0xca/0x150\n    __dev_notify_flags+0xe3/0x250\n    rtnl_configure_link+0x193/0x260\n    rtnl_newlink_create+0x383/0x8e0\n    __rtnl_newlink+0x22c/0xa40\n    rtnl_newlink+0x627/0xb00\n    rtnetlink_rcv_msg+0x6fb/0xb70\n    netlink_rcv_skb+0x11f/0x350\n    netlink_unicast+0x426/0x710\n    netlink_sendmsg+0x75a/0xc20\n    __sock_sendmsg+0xc1/0x150\n    ____sys_sendmsg+0x5aa/0x7b0\n    ___sys_sendmsg+0xfc/0x180\n\n[2]\nkernel BUG at net/8021q/vlan.c:99!\nOops: invalid opcode: 0000 [#1] SMP KASAN PTI\nCPU: 0 UID: 0 PID: 382 Comm: ip Not tainted 6.16.0-rc3 #61 PREEMPT(voluntary)\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996),\nBIOS rel-1.13.0-0-gf21b5a4aeb02-prebuilt.qemu.org 04/01/2014\nRIP: 0010:unregister_vlan_dev (net/8021q/vlan.c:99 (discriminator 1))\nRSP: 0018:ffff88810badf310 EFLAGS: 00010246\nRAX: 0000000000000000 RBX: ffff88810da84000 RCX: ffffffffb47ceb9a\nRDX: dffffc0000000000 RSI: 0000000000000008 RDI: ffff88810e8b43c8\nRBP: 0000000000000000 R08: 0000000000000000 R09: fffffbfff6cefe80\nR10: ffffffffb677f407 R11: ffff88810badf3c0 R12: ffff88810e8b4000\nR13: 0000000000000000 R14: ffff88810642a5c0 R15: 000000000000017e\nFS:  00007f1ff68c20c0(0000) GS:ffff888163a24000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 00007f1ff5dad240 CR3: 0000000107e56000 CR4: 00000000000006f0\nCall Trace:\n <TASK\n---truncated---", "datePublished": "2025-07-28T12:30:34", "dateUpdated": "2025-12-22T21:30:30", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/d43ef15bf4856c8c4c6c3572922331a5f06deb77", "https://git.kernel.org/stable/c/bb515c41306454937464da055609b5fb0a27821b", "https://git.kernel.org/stable/c/8984bcbd1edf5bee5be06ad771d157333b790c33", "https://git.kernel.org/stable/c/93715aa2d80e6c5cea1bb486321fc4585076928b", "https://git.kernel.org/stable/c/579d4f9ca9a9a605184a9b162355f6ba131f678d", "https://git.kernel.org/stable/c/ba48d3993af23753e1f1f01c8d592de9c7785f24", "https://git.kernel.org/stable/c/35142b3816832889e50164d993018ea5810955ae", "https://git.kernel.org/stable/c/047b61a24d7c866c502aeeea482892969a68f216", "https://nvd.nist.gov/vuln/detail/CVE-2025-38470", "https://lists.debian.org/debian-lts-announce/2025/10/msg00007.html", "https://lists.debian.org/debian-lts-announce/2025/10/msg00008.html"], "aliases": ["CVE-2025-38470"], "assigner": "Linux", "epss": 0.01, "enisaIdProduct": [{"id": "028fa560-79b3-3c28-88ed-d8c9e553a275", "product": {"name": "Linux"}, "product_version": "patch: 6.1.147"}, {"id": "05fd9d60-76c8-39d3-82a3-b52a51a50114", "product": {"name": "Linux"}, "product_version": "ad1afb00393915a51c21b1ae8704562bf036855f <047b61a24d7c866c502aeeea482892969a68f216"}, {"id": "0af48697-c501-36df-b7b8-7e09e624072e", "product": {"name": "Linux"}, "product_version": "patch: 5.4.297"}, {"id": "173cd46a-9b35-3709-81ce-6f09fc82d970", "product": {"name": "Linux"}, "product_version": "patch: 6.6.100"}, {"id": "18383308-e349-3d79-aa2d-9f3be45f6cd2", "product": {"name": "Linux"}, "product_version": "patch: 5.10.241"}, {"id": "3350fea2-0661-33bf-8222-e28958d3b442", "product": {"name": "Linux"}, "product_version": "patch: 6.12.40"}, {"id": "4731162f-a772-38cc-b4b0-aaa4bba0d0d5", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "54414dd1-ed70-3a73-8c5d-d90b3e62dac7", "product": {"name": "Linux"}, "product_version": "patch: 6.15.8"}, {"id": "5f1f9f77-8768-38a0-b1ac-10eaf90eb57d", "product": {"name": "Linux"}, "product_version": "ad1afb00393915a51c21b1ae8704562bf036855f <8984bcbd1edf5bee5be06ad771d157333b790c33"}, {"id": "6e53108c-3827-3662-8610-61c8f471a78d", "product": {"name": "Linux"}, "product_version": "ad1afb00393915a51c21b1ae8704562bf036855f <ba48d3993af23753e1f1f01c8d592de9c7785f24"}, {"id": "b6c28d5d-f3bd-3bad-9321-d6a2dc2b2cee", "product": {"name": "Linux"}, "product_version": "ad1afb00393915a51c21b1ae8704562bf036855f <93715aa2d80e6c5cea1bb486321fc4585076928b"}, {"id": "c85e01e9-cb20-3ffb-9d59-27f73ba264bb", "product": {"name": "Linux"}, "product_version": "patch: 6.16"}, {"id": "cec44235-723d-3b71-8458-ab932ae3875d", "product": {"name": "Linux"}, "product_version": "ad1afb00393915a51c21b1ae8704562bf036855f <579d4f9ca9a9a605184a9b162355f6ba131f678d"}, {"id": "d2c86a43-b1bf-3cec-8e9b-9edf89976a65", "product": {"name": "Linux"}, "product_version": "ad1afb00393915a51c21b1ae8704562bf036855f <35142b3816832889e50164d993018ea5810955ae"}, {"id": "dd69ed50-b164-3aea-9f76-7bfc09686504", "product": {"name": "Linux"}, "product_version": "2.6.36"}, {"id": "e733d3a1-0de7-3fb0-9a59-2c604842ad04", "product": {"name": "Linux"}, "product_version": "ad1afb00393915a51c21b1ae8704562bf036855f <bb515c41306454937464da055609b5fb0a27821b"}, {"id": "faed254c-75c8-353d-8f1f-f3b767e00d9c", "product": {"name": "Linux"}, "product_version": "ad1afb00393915a51c21b1ae8704562bf036855f <d43ef15bf4856c8c4c6c3572922331a5f06deb77"}, {"id": "fc0ea048-c094-3c10-b7a1-2818e5c4a6e0", "product": {"name": "Linux"}, "product_version": "patch: 5.15.190"}], "enisaIdVendor": [{"id": "98e02595-bd67-3e15-acc2-24d2df33fc79", "vendor": {"name": "Linux"}}], "isExploited": false}