{"id": "EUVD-2025-124933", "enisaUuid": "2fd9f23e-6e7d-3683-87db-c20f81f598cb", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nf2fs: fix to avoid migrating empty section\n\nIt reports a bug from device w/ zufs:\n\nF2FS-fs (dm-64): Inconsistent segment (173822) type [1, 0] in SSA and SIT\nF2FS-fs (dm-64): Stopped filesystem due to reason: 4\n\nThread A\t\t\t\tThread B\n- f2fs_expand_inode_data\n - f2fs_allocate_pinning_section\n  - f2fs_gc_range\n   - do_garbage_collect w/ segno #x\n\t\t\t\t\t- writepage\n\t\t\t\t\t - f2fs_allocate_data_block\n\t\t\t\t\t  - new_curseg\n\t\t\t\t\t   - allocate segno #x\n\nThe root cause is: fallocate on pinning file may race w/ block allocation\nas above, result in do_garbage_collect() from fallocate() may migrate\nsegment which is just allocated by a log, the log will update segment type\nin its in-memory structure, however GC will get segment type from on-disk\nSSA block, once segment type changes by log, we can detect such\ninconsistency, then shutdown filesystem.\n\nIn this case, on-disk SSA shows type of segno #173822 is 1 (SUM_TYPE_NODE),\nhowever segno #173822 was just allocated as data type segment, so in-memory\nSIT shows type of segno #173822 is 0 (SUM_TYPE_DATA).\n\nChange as below to fix this issue:\n- check whether current section is empty before gc\n- add sanity checks on do_garbage_collect() to avoid any race case, result\nin migrating segment used by log.\n- btw, it fixes misc issue in printed logs: \"SSA and SIT\" -> \"SIT and SSA\".", "datePublished": "2025-11-12T10:23:27", "dateUpdated": "2025-12-01T06:18:59", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/eec1589be36fcf7440755703e4faeee2c01e360b", "https://git.kernel.org/stable/c/d625a2b08c089397d3a03bff13fa8645e4ec7a01", "https://nvd.nist.gov/vuln/detail/CVE-2025-40150"], "aliases": ["CVE-2025-40150"], "assigner": "Linux", "epss": 0.03, "enisaIdProduct": [{"id": "33093372-c58a-35cf-988b-ff2f7b348ee1", "product": {"name": "Linux"}, "product_version": "patch: 6.18-rc1"}, {"id": "475672e2-9d4e-3d10-8803-739bfdd19b0b", "product": {"name": "Linux"}, "product_version": "9703d69d9d153bb230711d0d577454552aeb13d4 <eec1589be36fcf7440755703e4faeee2c01e360b"}, {"id": "50ae5589-366a-306e-b3eb-17b253a1b1e9", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "57370d52-8383-3f51-a328-f3d27cd19dcd", "product": {"name": "Linux"}, "product_version": "patch: 6.17.3"}, {"id": "5be5a39b-11f2-3e7f-bf86-83a404512067", "product": {"name": "Linux"}, "product_version": "6.9"}, {"id": "809ef552-8d25-340a-9914-c1b322a70736", "product": {"name": "Linux"}, "product_version": "40d76c393cca83938b11eb7ca8983aa3cd0ed69b"}, {"id": "9e5078f8-0176-3f60-88e9-04318fbada67", "product": {"name": "Linux"}, "product_version": "9703d69d9d153bb230711d0d577454552aeb13d4 <d625a2b08c089397d3a03bff13fa8645e4ec7a01"}, {"id": "ae775c54-8f86-3400-b9b1-3e7f657b4fdf", "product": {"name": "Linux"}, "product_version": "patch: 6.18"}], "enisaIdVendor": [{"id": "5559c581-9297-3426-9585-4b0211e0c31f", "vendor": {"name": "Linux"}}], "isExploited": false}