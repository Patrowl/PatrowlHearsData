{"id": "EUVD-2025-204726", "enisaUuid": "f823e080-10e1-3570-a487-ff7f2474ec63", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nusb: uas: fix urb unmapping issue when the uas device is remove during ongoing data transfer\n\nWhen a UAS device is unplugged during data transfer, there is\na probability of a system panic occurring. The root cause is\nan access to an invalid memory address during URB callback handling.\nSpecifically, this happens when the dma_direct_unmap_sg() function\nis called within the usb_hcd_unmap_urb_for_dma() interface, but the\nsg->dma_address field is 0 and the sg data structure has already been\nfreed.\n\nThe SCSI driver sends transfer commands by invoking uas_queuecommand_lck()\nin uas.c, using the uas_submit_urbs() function to submit requests to USB.\nWithin the uas_submit_urbs() implementation, three URBs (sense_urb,\ndata_urb, and cmd_urb) are sequentially submitted. Device removal may\noccur at any point during uas_submit_urbs execution, which may result\nin URB submission failure. However, some URBs might have been successfully\nsubmitted before the failure, and uas_submit_urbs will return the -ENODEV\nerror code in this case. The current error handling directly calls\nscsi_done(). In the SCSI driver, this eventually triggers scsi_complete()\nto invoke scsi_end_request() for releasing the sgtable. The successfully\nsubmitted URBs, when being unlinked to giveback, call\nusb_hcd_unmap_urb_for_dma() in hcd.c, leading to exceptions during sg\nunmapping operations since the sg data structure has already been freed.\n\nThis patch modifies the error condition check in the uas_submit_urbs()\nfunction. When a UAS device is removed but one or more URBs have already\nbeen successfully submitted to USB, it avoids immediately invoking\nscsi_done() and save the cmnd to devinfo->cmnd array. If the successfully\nsubmitted URBs is completed before devinfo->resetting being set, then\nthe scsi_done() function will be called within uas_try_complete() after\nall pending URB operations are finalized. Otherwise, the scsi_done()\nfunction will be called within uas_zap_pending(), which is executed after\nusb_kill_anchored_urbs().\n\nThe error handling only takes effect when uas_queuecommand_lck() calls\nuas_submit_urbs() and returns the error value -ENODEV . In this case,\nthe device is disconnected, and the flow proceeds to uas_disconnect(),\nwhere uas_zap_pending() is invoked to call uas_try_complete().", "datePublished": "2025-12-22T16:12:24", "dateUpdated": "2025-12-22T16:14:09", "baseScore": 0.0, "references": ["https://nvd.nist.gov/vuln/detail/CVE-2025-68331", "https://git.kernel.org/stable/c/26d56a9fcb2014b99e654127960aa0a48a391e3c", "https://git.kernel.org/stable/c/2b90a8131c83f6f2be69397d2b7d14d217d95d2f", "https://git.kernel.org/stable/c/426edbfc88b22601ea34a441a469092e7b301c52", "https://git.kernel.org/stable/c/6289fc489e94c9beb6be2b502ccc263663733d72", "https://git.kernel.org/stable/c/66ac05e7b0d6bbd1bee9fcf729e20fd4cce86d17", "https://git.kernel.org/stable/c/75f8e2643085db4f7e136fc6b368eb114dd80a64", "https://git.kernel.org/stable/c/e3a55221f4de080cb7a91ba10f01c4f708603f8d"], "aliases": ["CVE-2025-68331", "GHSA-cmqf-qgg2-7p77"], "assigner": "Linux", "epss": 0.02, "enisaIdProduct": [{"id": "04e625b4-21de-3aa4-a3f4-024852aaae5d", "product": {"name": "Linux"}, "product_version": "patch: 6.1.159"}, {"id": "17922171-1970-382b-ac09-0a78851e0a39", "product": {"name": "Linux"}, "product_version": "eb2a86ae8c544be0ab04aa8169390c0669bc7148 <75f8e2643085db4f7e136fc6b368eb114dd80a64"}, {"id": "1b6a6307-a854-3df5-87aa-b556c49b91b2", "product": {"name": "Linux"}, "product_version": "patch: 6.12.61"}, {"id": "3748814d-a7ae-33cf-ac4f-5abd0d4db49f", "product": {"name": "Linux"}, "product_version": "eb2a86ae8c544be0ab04aa8169390c0669bc7148 <26d56a9fcb2014b99e654127960aa0a48a391e3c"}, {"id": "40ec26d9-bff3-3d81-9ae2-26b158274127", "product": {"name": "Linux"}, "product_version": "5.10"}, {"id": "89695490-a82a-3ec4-aa39-3c54a7c9dfd3", "product": {"name": "Linux"}, "product_version": "patch: 5.10.247"}, {"id": "8c3f3e1c-59a9-3981-a112-88eafe026643", "product": {"name": "Linux"}, "product_version": "patch: 6.18"}, {"id": "ab682500-2e4c-3537-8eec-42ee5ad432cd", "product": {"name": "Linux"}, "product_version": "eb2a86ae8c544be0ab04aa8169390c0669bc7148 <426edbfc88b22601ea34a441a469092e7b301c52"}, {"id": "b4787bb0-3254-338a-a718-5f506d00753c", "product": {"name": "Linux"}, "product_version": "patch: 6.6.119"}, {"id": "caaf562a-6b4b-37e9-bdbd-bd1d8a7d3508", "product": {"name": "Linux"}, "product_version": "eb2a86ae8c544be0ab04aa8169390c0669bc7148 <2b90a8131c83f6f2be69397d2b7d14d217d95d2f"}, {"id": "d8549b36-ac5b-32e6-878f-8ace0709ff1e", "product": {"name": "Linux"}, "product_version": "eb2a86ae8c544be0ab04aa8169390c0669bc7148 <e3a55221f4de080cb7a91ba10f01c4f708603f8d"}, {"id": "e59bcce3-61a9-39d2-9b83-24193830c836", "product": {"name": "Linux"}, "product_version": "patch: 6.17.11"}, {"id": "e69a2341-90dd-3d38-97f6-1d5be6c59dea", "product": {"name": "Linux"}, "product_version": "patch: 5.15.197"}, {"id": "e819211b-f2e3-3924-b4da-03971d055d38", "product": {"name": "Linux"}, "product_version": "eb2a86ae8c544be0ab04aa8169390c0669bc7148 <66ac05e7b0d6bbd1bee9fcf729e20fd4cce86d17"}, {"id": "ea97b31b-a298-3850-947f-9d780f60337b", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "fd349d60-d2b2-354a-8946-6daa5cface86", "product": {"name": "Linux"}, "product_version": "eb2a86ae8c544be0ab04aa8169390c0669bc7148 <6289fc489e94c9beb6be2b502ccc263663733d72"}], "enisaIdVendor": [{"id": "ace6ee89-6b3c-3f3e-bfe8-83882b4273cb", "vendor": {"name": "Linux"}}], "isExploited": false}