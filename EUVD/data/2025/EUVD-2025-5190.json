{"id": "EUVD-2025-5190", "enisaUuid": "870029f9-3619-357d-92c0-8ea3889b5f80", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nbtrfs: fix use-after-free when attempting to join an aborted transaction\n\nWhen we are trying to join the current transaction and if it's aborted,\nwe read its 'aborted' field after unlocking fs_info->trans_lock and\nwithout holding any extra reference count on it. This means that a\nconcurrent task that is aborting the transaction may free the transaction\nbefore we read its 'aborted' field, leading to a use-after-free.\n\nFix this by reading the 'aborted' field while holding fs_info->trans_lock\nsince any freeing task must first acquire that lock and set\nfs_info->running_transaction to NULL before freeing the transaction.\n\nThis was reported by syzbot and Dmitry with the following stack traces\nfrom KASAN:\n\n   ==================================================================\n   BUG: KASAN: slab-use-after-free in join_transaction+0xd9b/0xda0 fs/btrfs/transaction.c:278\n   Read of size 4 at addr ffff888011839024 by task kworker/u4:9/1128\n\n   CPU: 0 UID: 0 PID: 1128 Comm: kworker/u4:9 Not tainted 6.13.0-rc7-syzkaller-00019-gc45323b7560e #0\n   Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.16.3-debian-1.16.3-2~bpo12+1 04/01/2014\n   Workqueue: events_unbound btrfs_async_reclaim_data_space\n   Call Trace:\n    <TASK>\n    __dump_stack lib/dump_stack.c:94 [inline]\n    dump_stack_lvl+0x241/0x360 lib/dump_stack.c:120\n    print_address_description mm/kasan/report.c:378 [inline]\n    print_report+0x169/0x550 mm/kasan/report.c:489\n    kasan_report+0x143/0x180 mm/kasan/report.c:602\n    join_transaction+0xd9b/0xda0 fs/btrfs/transaction.c:278\n    start_transaction+0xaf8/0x1670 fs/btrfs/transaction.c:697\n    flush_space+0x448/0xcf0 fs/btrfs/space-info.c:803\n    btrfs_async_reclaim_data_space+0x159/0x510 fs/btrfs/space-info.c:1321\n    process_one_work kernel/workqueue.c:3236 [inline]\n    process_scheduled_works+0xa66/0x1840 kernel/workqueue.c:3317\n    worker_thread+0x870/0xd30 kernel/workqueue.c:3398\n    kthread+0x2f0/0x390 kernel/kthread.c:389\n    ret_from_fork+0x4b/0x80 arch/x86/kernel/process.c:147\n    ret_from_fork_asm+0x1a/0x30 arch/x86/entry/entry_64.S:244\n    </TASK>\n\n   Allocated by task 5315:\n    kasan_save_stack mm/kasan/common.c:47 [inline]\n    kasan_save_track+0x3f/0x80 mm/kasan/common.c:68\n    poison_kmalloc_redzone mm/kasan/common.c:377 [inline]\n    __kasan_kmalloc+0x98/0xb0 mm/kasan/common.c:394\n    kasan_kmalloc include/linux/kasan.h:260 [inline]\n    __kmalloc_cache_noprof+0x243/0x390 mm/slub.c:4329\n    kmalloc_noprof include/linux/slab.h:901 [inline]\n    join_transaction+0x144/0xda0 fs/btrfs/transaction.c:308\n    start_transaction+0xaf8/0x1670 fs/btrfs/transaction.c:697\n    btrfs_create_common+0x1b2/0x2e0 fs/btrfs/inode.c:6572\n    lookup_open fs/namei.c:3649 [inline]\n    open_last_lookups fs/namei.c:3748 [inline]\n    path_openat+0x1c03/0x3590 fs/namei.c:3984\n    do_filp_open+0x27f/0x4e0 fs/namei.c:4014\n    do_sys_openat2+0x13e/0x1d0 fs/open.c:1402\n    do_sys_open fs/open.c:1417 [inline]\n    __do_sys_creat fs/open.c:1495 [inline]\n    __se_sys_creat fs/open.c:1489 [inline]\n    __x64_sys_creat+0x123/0x170 fs/open.c:1489\n    do_syscall_x64 arch/x86/entry/common.c:52 [inline]\n    do_syscall_64+0xf3/0x230 arch/x86/entry/common.c:83\n    entry_SYSCALL_64_after_hwframe+0x77/0x7f\n\n   Freed by task 5336:\n    kasan_save_stack mm/kasan/common.c:47 [inline]\n    kasan_save_track+0x3f/0x80 mm/kasan/common.c:68\n    kasan_save_free_info+0x40/0x50 mm/kasan/generic.c:582\n    poison_slab_object mm/kasan/common.c:247 [inline]\n    __kasan_slab_free+0x59/0x70 mm/kasan/common.c:264\n    kasan_slab_free include/linux/kasan.h:233 [inline]\n    slab_free_hook mm/slub.c:2353 [inline]\n    slab_free mm/slub.c:4613 [inline]\n    kfree+0x196/0x430 mm/slub.c:4761\n    cleanup_transaction fs/btrfs/transaction.c:2063 [inline]\n    btrfs_commit_transaction+0x2c97/0x3720 fs/btrfs/transaction.c:2598\n    insert_balance_item+0x1284/0x20b0 fs/btrfs/volumes.c:3757\n    btrfs_balance+0x992/\n---truncated---", "datePublished": "2025-02-27T02:12:23", "dateUpdated": "2025-11-03T19:36:58", "baseScore": 7.8, "baseScoreVersion": "3.1", "baseScoreVector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "references": ["https://nvd.nist.gov/vuln/detail/CVE-2025-21753", "https://git.kernel.org/stable/c/6ba4663ada6c6315af23a6669d386146634808ec", "https://git.kernel.org/stable/c/86d71a026a7f63da905db9add845c8ee88801eca", "https://git.kernel.org/stable/c/8f5cff471039caa2b088060c074c2bf2081bcb01", "https://git.kernel.org/stable/c/ce628048390dad80320d5a1f74de6ca1e1be91e7", "https://git.kernel.org/stable/c/e2f0943cf37305dbdeaf9846e3c941451bcdef63", "https://git.kernel.org/stable/c/7e954b6bb95d67ae4d1a20e9cfd83c182cf929bc", "https://git.kernel.org/stable/c/c7a53757717e68af94a56929d57f1e6daff220ec", "https://git.kernel.org/stable/c/cee55b1219568c80bf0d5dc55066e4a859baf753", "https://lists.debian.org/debian-lts-announce/2025/03/msg00028.html", "https://lists.debian.org/debian-lts-announce/2025/05/msg00030.html"], "aliases": ["CVE-2025-21753", "GHSA-595v-ghj9-chj5"], "assigner": "Linux", "epss": 0.05, "enisaIdProduct": [{"id": "0aad966f-e4e4-385c-b620-d6529bf58a53", "product": {"name": "Linux"}, "product_version": "patch: 5.15.179"}, {"id": "10a692a3-72e9-385d-91e8-6ed8c5aa9e02", "product": {"name": "Linux"}, "product_version": "patch: 6.14"}, {"id": "110b012e-5e82-3ffb-a06e-3e2ebf6b8d53", "product": {"name": "Linux"}, "product_version": "patch: 6.6.78"}, {"id": "1fd6cb01-e814-335e-ade4-f11a986ba8aa", "product": {"name": "Linux"}, "product_version": "patch: 6.13.3"}, {"id": "25d01445-1344-39c4-a5b6-856dbb795b1f", "product": {"name": "Linux"}, "product_version": "patch: 6.12.14"}, {"id": "361dcaef-e765-3c5c-b6fc-ad82c63c6da1", "product": {"name": "Linux"}, "product_version": "871383be592ba7e819d27556591e315a0df38cee <cee55b1219568c80bf0d5dc55066e4a859baf753"}, {"id": "47b2fe38-ae40-3ee0-a8fd-f790403e6471", "product": {"name": "Linux"}, "product_version": "871383be592ba7e819d27556591e315a0df38cee <c7a53757717e68af94a56929d57f1e6daff220ec"}, {"id": "6367b48a-8fcb-37c4-b888-684409c47ca7", "product": {"name": "Linux"}, "product_version": "871383be592ba7e819d27556591e315a0df38cee <7e954b6bb95d67ae4d1a20e9cfd83c182cf929bc"}, {"id": "71db79b6-3d87-36cd-b848-635e63b86afd", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "912ef997-c38b-3c8c-806d-85288141359f", "product": {"name": "Linux"}, "product_version": "patch: 5.10.235"}, {"id": "953e241c-e117-3343-a4d1-cfaf64ef2ad4", "product": {"name": "Linux"}, "product_version": "871383be592ba7e819d27556591e315a0df38cee <e2f0943cf37305dbdeaf9846e3c941451bcdef63"}, {"id": "ab8a38d2-8349-344a-88ea-51c963222666", "product": {"name": "Linux"}, "product_version": "871383be592ba7e819d27556591e315a0df38cee <8f5cff471039caa2b088060c074c2bf2081bcb01"}, {"id": "b6a360bf-9cd7-3ee0-a872-d228f5f1b51c", "product": {"name": "Linux"}, "product_version": "871383be592ba7e819d27556591e315a0df38cee <6ba4663ada6c6315af23a6669d386146634808ec"}, {"id": "c3eb964f-0a47-30e0-8201-e101a9af3eae", "product": {"name": "Linux"}, "product_version": "patch: 6.1.129"}, {"id": "c97bf080-c152-3aba-be77-7d30e7f09afd", "product": {"name": "Linux"}, "product_version": "871383be592ba7e819d27556591e315a0df38cee <ce628048390dad80320d5a1f74de6ca1e1be91e7"}, {"id": "e8ccdd4c-a481-3c40-8efd-285f3b8f9ca2", "product": {"name": "Linux"}, "product_version": "patch: 5.4.291"}, {"id": "ec7da50d-5148-3f6e-b3dd-26af6a0cab57", "product": {"name": "Linux"}, "product_version": "871383be592ba7e819d27556591e315a0df38cee <86d71a026a7f63da905db9add845c8ee88801eca"}, {"id": "fad90488-0862-378f-a1a7-f046cde9c62d", "product": {"name": "Linux"}, "product_version": "3.4"}], "enisaIdVendor": [{"id": "25f604a0-5b48-3876-9ab7-41be5c970a21", "vendor": {"name": "Linux"}}], "isExploited": false}