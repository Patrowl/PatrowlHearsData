{"id": "EUVD-2025-20943", "enisaUuid": "ff684c09-70ff-36d8-9a70-a1ec60221330", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nptp: remove ptp->n_vclocks check logic in ptp_vclock_in_use()\n\nThere is no disagreement that we should check both ptp->is_virtual_clock\nand ptp->n_vclocks to check if the ptp virtual clock is in use.\n\nHowever, when we acquire ptp->n_vclocks_mux to read ptp->n_vclocks in\nptp_vclock_in_use(), we observe a recursive lock in the call trace\nstarting from n_vclocks_store().\n\n============================================\nWARNING: possible recursive locking detected\n6.15.0-rc6 #1 Not tainted\n--------------------------------------------\nsyz.0.1540/13807 is trying to acquire lock:\nffff888035a24868 (&ptp->n_vclocks_mux){+.+.}-{4:4}, at:\n ptp_vclock_in_use drivers/ptp/ptp_private.h:103 [inline]\nffff888035a24868 (&ptp->n_vclocks_mux){+.+.}-{4:4}, at:\n ptp_clock_unregister+0x21/0x250 drivers/ptp/ptp_clock.c:415\n\nbut task is already holding lock:\nffff888030704868 (&ptp->n_vclocks_mux){+.+.}-{4:4}, at:\n n_vclocks_store+0xf1/0x6d0 drivers/ptp/ptp_sysfs.c:215\n\nother info that might help us debug this:\n Possible unsafe locking scenario:\n\n       CPU0\n       ----\n  lock(&ptp->n_vclocks_mux);\n  lock(&ptp->n_vclocks_mux);\n\n *** DEADLOCK ***\n....\n============================================\n\nThe best way to solve this is to remove the logic that checks\nptp->n_vclocks in ptp_vclock_in_use().\n\nThe reason why this is appropriate is that any path that uses\nptp->n_vclocks must unconditionally check if ptp->n_vclocks is greater\nthan 0 before unregistering vclocks, and all functions are already\nwritten this way. And in the function that uses ptp->n_vclocks, we\nalready get ptp->n_vclocks_mux before unregistering vclocks.\n\nTherefore, we need to remove the redundant check for ptp->n_vclocks in\nptp_vclock_in_use() to prevent recursive locking.", "datePublished": "2025-07-10T09:32:30", "dateUpdated": "2025-12-19T18:31:05", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/5d217e7031a5c06d366580fc6ddbf43527b780d4", "https://git.kernel.org/stable/c/b1b73c452331451020be3bf4b014901015ae6663", "https://git.kernel.org/stable/c/259119595227fd20f6aa29d85abe086b6fdd9eb1", "https://git.kernel.org/stable/c/b93e6fef4eda48e17d9c642b9abad98a066fd4a3", "https://git.kernel.org/stable/c/ef8fc007c28a30a4c0d90bf755e0f343d99bb392", "https://git.kernel.org/stable/c/87f7ce260a3c838b49e1dc1ceedf1006795157a2", "https://nvd.nist.gov/vuln/detail/CVE-2025-38305", "https://lists.debian.org/debian-lts-announce/2025/10/msg00008.html"], "aliases": ["CVE-2025-38305"], "assigner": "Linux", "epss": 0.02, "enisaIdProduct": [{"id": "16fe52fa-3d3f-3911-b5b5-9c966e14caa0", "product": {"name": "Linux"}, "product_version": "73f37068d540eba5f93ba3a0019bf479d35ebd76 <5d217e7031a5c06d366580fc6ddbf43527b780d4"}, {"id": "1a88f22b-5096-363e-b2a2-f79d8880e685", "product": {"name": "Linux"}, "product_version": "patch: 6.6.94"}, {"id": "2e7abb05-c652-37c6-8019-003a9533d2cc", "product": {"name": "Linux"}, "product_version": "73f37068d540eba5f93ba3a0019bf479d35ebd76 <b93e6fef4eda48e17d9c642b9abad98a066fd4a3"}, {"id": "2fb2a973-5f4f-32c9-81fd-6be141963f09", "product": {"name": "Linux"}, "product_version": "73f37068d540eba5f93ba3a0019bf479d35ebd76 <b1b73c452331451020be3bf4b014901015ae6663"}, {"id": "36703626-579c-36c7-aa13-e514617f3594", "product": {"name": "Linux"}, "product_version": "patch: 6.1.142"}, {"id": "5127a1cf-ba7a-3854-90bb-5955cb558173", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "565afbc4-c9c6-32b1-a6c1-0b0101210cf2", "product": {"name": "Linux"}, "product_version": "5.14"}, {"id": "6abb56cf-cacc-3e4c-905e-302788325e8c", "product": {"name": "Linux"}, "product_version": "patch: 5.15.186"}, {"id": "7b45d0ff-84b1-3b23-8a6f-8583d6eda4b6", "product": {"name": "Linux"}, "product_version": "patch: 6.16"}, {"id": "8c763e11-76eb-369d-9435-dfae77a69c74", "product": {"name": "Linux"}, "product_version": "73f37068d540eba5f93ba3a0019bf479d35ebd76 <259119595227fd20f6aa29d85abe086b6fdd9eb1"}, {"id": "8dfe1e36-621c-3074-871f-002a481a905a", "product": {"name": "Linux"}, "product_version": "patch: 6.16-rc2"}, {"id": "9b56c682-6539-3547-ae2d-2f55f07d98a0", "product": {"name": "Linux"}, "product_version": "73f37068d540eba5f93ba3a0019bf479d35ebd76 <ef8fc007c28a30a4c0d90bf755e0f343d99bb392"}, {"id": "b5d765c5-bede-38cb-bcc4-e97f3f48ec66", "product": {"name": "Linux"}, "product_version": "73f37068d540eba5f93ba3a0019bf479d35ebd76 <87f7ce260a3c838b49e1dc1ceedf1006795157a2"}, {"id": "b8337f67-8fda-3668-8a76-0ed434635261", "product": {"name": "Linux"}, "product_version": "patch: 6.12.34"}, {"id": "eddad72a-e8f3-3c70-9b8a-8f20fb8540cb", "product": {"name": "Linux"}, "product_version": "patch: 6.15.3"}], "enisaIdVendor": [{"id": "51fd8f16-be00-35b7-8a0d-7a6cb5abb624", "vendor": {"name": "Linux"}}], "isExploited": false}