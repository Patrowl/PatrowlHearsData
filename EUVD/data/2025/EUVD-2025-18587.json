{"id": "EUVD-2025-18587", "enisaUuid": "737a612c-8e18-3669-8f79-d8d318b3cefc", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\ndm cache: prevent BUG_ON by blocking retries on failed device resumes\n\nA cache device failing to resume due to mapping errors should not be\nretried, as the failure leaves a partially initialized policy object.\nRepeating the resume operation risks triggering BUG_ON when reloading\ncache mappings into the incomplete policy object.\n\nReproduce steps:\n\n1. create a cache metadata consisting of 512 or more cache blocks,\n   with some mappings stored in the first array block of the mapping\n   array. Here we use cache_restore v1.0 to build the metadata.\n\ncat <<EOF >> cmeta.xml\n<superblock uuid=\"\" block_size=\"128\" nr_cache_blocks=\"512\" \\\npolicy=\"smq\" hint_width=\"4\">\n  <mappings>\n    <mapping cache_block=\"0\" origin_block=\"0\" dirty=\"false\"/>\n  </mappings>\n</superblock>\nEOF\ndmsetup create cmeta --table \"0 8192 linear /dev/sdc 0\"\ncache_restore -i cmeta.xml -o /dev/mapper/cmeta --metadata-version=2\ndmsetup remove cmeta\n\n2. wipe the second array block of the mapping array to simulate\n   data degradations.\n\nmapping_root=$(dd if=/dev/sdc bs=1c count=8 skip=192 \\\n2>/dev/null | hexdump -e '1/8 \"%u\\n\"')\nablock=$(dd if=/dev/sdc bs=1c count=8 skip=$((4096*mapping_root+2056)) \\\n2>/dev/null | hexdump -e '1/8 \"%u\\n\"')\ndd if=/dev/zero of=/dev/sdc bs=4k count=1 seek=$ablock\n\n3. try bringing up the cache device. The resume is expected to fail\n   due to the broken array block.\n\ndmsetup create cmeta --table \"0 8192 linear /dev/sdc 0\"\ndmsetup create cdata --table \"0 65536 linear /dev/sdc 8192\"\ndmsetup create corig --table \"0 524288 linear /dev/sdc 262144\"\ndmsetup create cache --notable\ndmsetup load cache --table \"0 524288 cache /dev/mapper/cmeta \\\n/dev/mapper/cdata /dev/mapper/corig 128 2 metadata2 writethrough smq 0\"\ndmsetup resume cache\n\n4. try resuming the cache again. An unexpected BUG_ON is triggered\n   while loading cache mappings.\n\ndmsetup resume cache\n\nKernel logs:\n\n(snip)\n------------[ cut here ]------------\nkernel BUG at drivers/md/dm-cache-policy-smq.c:752!\nOops: invalid opcode: 0000 [#1] PREEMPT SMP KASAN NOPTI\nCPU: 0 UID: 0 PID: 332 Comm: dmsetup Not tainted 6.13.4 #3\nRIP: 0010:smq_load_mapping+0x3e5/0x570\n\nFix by disallowing resume operations for devices that failed the\ninitial attempt.", "datePublished": "2025-06-18T12:30:33", "dateUpdated": "2025-12-17T21:30:31", "baseScore": 0.0, "references": ["https://git.kernel.org/stable/c/c614584c2a66b538f469089ac089457a34590c14", "https://git.kernel.org/stable/c/c5356a5e80442131e2714d0d26bb110590e4e568", "https://git.kernel.org/stable/c/025c8f477625eb39006ded650e7d027bcfb20e79", "https://git.kernel.org/stable/c/00586b78eeb7c626a14ca13453a1631f88a7cf36", "https://git.kernel.org/stable/c/3986ef4a9b6a0d9c28bc325d8713beba5e67586f", "https://git.kernel.org/stable/c/cc80a5cc520939d0a7d071cc4ae4b3c55ef171d0", "https://git.kernel.org/stable/c/f3128e3074e8af565cc6a66fe3384a56df87f803", "https://git.kernel.org/stable/c/5da692e2262b8f81993baa9592f57d12c2703dea", "https://nvd.nist.gov/vuln/detail/CVE-2025-38066", "https://lists.debian.org/debian-lts-announce/2025/10/msg00007.html", "https://lists.debian.org/debian-lts-announce/2025/10/msg00008.html"], "aliases": ["CVE-2025-38066"], "assigner": "Linux", "epss": 0.03, "enisaIdProduct": [{"id": "020a5b73-c28e-3d0b-9b1e-d3b981263c9f", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <f3128e3074e8af565cc6a66fe3384a56df87f803"}, {"id": "0829ddb1-fc4e-3ef5-9604-ef77355b1023", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <c614584c2a66b538f469089ac089457a34590c14"}, {"id": "0cf05c62-0e58-335d-8865-839f0f663c86", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <cc80a5cc520939d0a7d071cc4ae4b3c55ef171d0"}, {"id": "155be1e5-5b80-37c2-b0ac-0ef07d5ad7dd", "product": {"name": "Linux"}, "product_version": "patch: 5.4.294"}, {"id": "317656e1-0e3d-3c8b-8f5b-4666b8f981fd", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <00586b78eeb7c626a14ca13453a1631f88a7cf36"}, {"id": "3e14a52c-d31c-36ac-bacd-5037fee8b494", "product": {"name": "Linux"}, "product_version": "patch: 6.15"}, {"id": "4ca579d4-68c2-3992-a3e7-d958c83a9c27", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <5da692e2262b8f81993baa9592f57d12c2703dea"}, {"id": "4db62e86-6558-3426-8c9c-11a2e4111a16", "product": {"name": "Linux"}, "product_version": "patch: 6.12.31"}, {"id": "80ceb612-e0d2-3e91-a8d7-966570c8012c", "product": {"name": "Linux"}, "product_version": "patch: 6.14.9"}, {"id": "8ba04d3f-7098-34b9-b700-2c77416ba164", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <c5356a5e80442131e2714d0d26bb110590e4e568"}, {"id": "9c5c224d-4c4c-3e5d-a3f4-464beb25bff3", "product": {"name": "Linux"}, "product_version": "patch: 6.1.141"}, {"id": "9f84cf6d-8a99-3f3a-8e11-7aa76f332a4c", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <025c8f477625eb39006ded650e7d027bcfb20e79"}, {"id": "a0b6b116-28b2-3f68-9d76-2106427fdcf4", "product": {"name": "Linux"}, "product_version": "patch: 5.10.238"}, {"id": "a8c75d2e-72c2-3b76-99da-fd9581178856", "product": {"name": "Linux"}, "product_version": "1da177e4c3f41524e886b7f1b8a0c1fc7321cac2 <3986ef4a9b6a0d9c28bc325d8713beba5e67586f"}, {"id": "adcd04fe-ff76-34cc-8b73-1dca8c8a19bb", "product": {"name": "Linux"}, "product_version": "patch: 5.15.185"}, {"id": "ba48932c-860d-3bd9-9850-551cbf01e566", "product": {"name": "Linux"}, "product_version": "patch: 6.6.93"}], "enisaIdVendor": [{"id": "78eb7d70-6164-3979-9d93-549804895ada", "vendor": {"name": "Linux"}}], "isExploited": false}