{"id": "EUVD-2026-2515", "enisaUuid": "e7c2fe8f-975a-3641-a876-b0dc0d287a35", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nKVM: x86: Fix VM hard lockup after prolonged inactivity with periodic HV timer\n\nWhen advancing the target expiration for the guest's APIC timer in periodic\nmode, set the expiration to \"now\" if the target expiration is in the past\n(similar to what is done in update_target_expiration()).  Blindly adding\nthe period to the previous target expiration can result in KVM generating\na practically unbounded number of hrtimer IRQs due to programming an\nexpired timer over and over.  In extreme scenarios, e.g. if userspace\npauses/suspends a VM for an extended duration, this can even cause hard\nlockups in the host.\n\nCurrently, the bug only affects Intel CPUs when using the hypervisor timer\n(HV timer), a.k.a. the VMX preemption timer.  Unlike the software timer,\na.k.a. hrtimer, which KVM keeps running even on exits to userspace, the\nHV timer only runs while the guest is active.  As a result, if the vCPU\ndoes not run for an extended duration, there will be a huge gap between\nthe target expiration and the current time the vCPU resumes running.\nBecause the target expiration is incremented by only one period on each\ntimer expiration, this leads to a series of timer expirations occurring\nrapidly after the vCPU/VM resumes.\n\nMore critically, when the vCPU first triggers a periodic HV timer\nexpiration after resuming, advancing the expiration by only one period\nwill result in a target expiration in the past.  As a result, the delta\nmay be calculated as a negative value.  When the delta is converted into\nan absolute value (tscdeadline is an unsigned u64), the resulting value\ncan overflow what the HV timer is capable of programming.  I.e. the large\nvalue will exceed the VMX Preemption Timer's maximum bit width of\ncpu_preemption_timer_multi + 32, and thus cause KVM to switch from the\nHV timer to the software timer (hrtimers).\n\nAfter switching to the software timer, periodic timer expiration callbacks\nmay be executed consecutively within a single clock interrupt handler,\nbecause hrtimers honors KVM's request for an expiration in the past and\nimmediately re-invokes KVM's callback after reprogramming.  And because\nthe interrupt handler runs with IRQs disabled, restarting KVM's hrtimer\nover and over until the target expiration is advanced to \"now\" can result\nin a hard lockup.\n\nE.g. the following hard lockup was triggered in the host when running a\nWindows VM (only relevant because it used the APIC timer in periodic mode)\nafter resuming the VM from a long suspend (in the host).\n\n  NMI watchdog: Watchdog detected hard LOCKUP on cpu 45\n  ...\n  RIP: 0010:advance_periodic_target_expiration+0x4d/0x80 [kvm]\n  ...\n  RSP: 0018:ff4f88f5d98d8ef0 EFLAGS: 00000046\n  RAX: fff0103f91be678e RBX: fff0103f91be678e RCX: 00843a7d9e127bcc\n  RDX: 0000000000000002 RSI: 0052ca4003697505 RDI: ff440d5bfbdbd500\n  RBP: ff440d5956f99200 R08: ff2ff2a42deb6a84 R09: 000000000002a6c0\n  R10: 0122d794016332b3 R11: 0000000000000000 R12: ff440db1af39cfc0\n  R13: ff440db1af39cfc0 R14: ffffffffc0d4a560 R15: ff440db1af39d0f8\n  FS:  00007f04a6ffd700(0000) GS:ff440db1af380000(0000) knlGS:000000e38a3b8000\n  CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n  CR2: 000000d5651feff8 CR3: 000000684e038002 CR4: 0000000000773ee0\n  PKRU: 55555554\n  Call Trace:\n   <IRQ>\n   apic_timer_fn+0x31/0x50 [kvm]\n   __hrtimer_run_queues+0x100/0x280\n   hrtimer_interrupt+0x100/0x210\n   ? ttwu_do_wakeup+0x19/0x160\n   smp_apic_timer_interrupt+0x6a/0x130\n   apic_timer_interrupt+0xf/0x20\n   </IRQ>\n\nMoreover, if the suspend duration of the virtual machine is not long enough\nto trigger a hard lockup in this scenario, since commit 98c25ead5eda\n(\"KVM: VMX: Move preemption timer <=> hrtimer dance to common x86\"), KVM\nwill continue using the software timer until the guest reprograms the APIC\ntimer in some way.  Since the periodic timer does not require frequent APIC\ntimer register programming, the guest may continue to use the software\ntimer in \n---truncated---", "datePublished": "2026-01-14T15:05:53", "dateUpdated": "2026-01-14T15:05:53", "baseScore": 0.0, "references": ["https://nvd.nist.gov/vuln/detail/CVE-2025-71104", "https://git.kernel.org/stable/c/18ab3fc8e880791aa9f7c000261320fc812b5465", "https://git.kernel.org/stable/c/7b54ccef865e0aa62e4871d4ada2ba4b9dcb8bed", "https://git.kernel.org/stable/c/807dbe8f3862fa7c164155857550ce94b36a11b9", "https://git.kernel.org/stable/c/e23f46f1a971c73dad2fd63e1408696114ddebe2", "https://git.kernel.org/stable/c/e746e51947053a02af2ea964593dc4887108d379"], "aliases": ["CVE-2025-71104", "GHSA-37vf-xcvf-jrjr"], "assigner": "Linux", "epss": 0.02, "enisaIdProduct": [{"id": "035349a7-b03a-3e9b-be4e-1ddab3e40632", "product": {"name": "Linux"}, "product_version": "patch: 6.18.3"}, {"id": "04bf4eeb-c7c4-38e5-a73a-aa8e407fe8ee", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "0c62b439-8226-3bd7-afad-370f5398fbde", "product": {"name": "Linux"}, "product_version": "patch: 6.1.160"}, {"id": "131c44d0-bfc0-37e8-94a6-9a27ee292158", "product": {"name": "Linux"}, "product_version": "4.17"}, {"id": "1cd30a19-7238-3ebd-bf34-bc83684a1005", "product": {"name": "Linux"}, "product_version": "patch: 6.19-rc1"}, {"id": "7a37a5b0-0bf1-3e4c-aee8-ced9feb5e2ce", "product": {"name": "Linux"}, "product_version": "5a69b7b69beae9bb86e7e1b095685087976cba47"}, {"id": "8a140a44-85bd-34ac-ba66-1a5449cdc40b", "product": {"name": "Linux"}, "product_version": "d8f2f498d9ed0c5010bc1bbc1146f94c8bf9f8cc <7b54ccef865e0aa62e4871d4ada2ba4b9dcb8bed"}, {"id": "9a381b93-0899-39b3-91ba-7d4b8343f047", "product": {"name": "Linux"}, "product_version": "d8f2f498d9ed0c5010bc1bbc1146f94c8bf9f8cc <e746e51947053a02af2ea964593dc4887108d379"}, {"id": "c0672e77-62a5-3605-a449-8f0166b8909d", "product": {"name": "Linux"}, "product_version": "d8f2f498d9ed0c5010bc1bbc1146f94c8bf9f8cc <807dbe8f3862fa7c164155857550ce94b36a11b9"}, {"id": "c494be05-23ee-3e77-b57b-3484841036a1", "product": {"name": "Linux"}, "product_version": "d8f2f498d9ed0c5010bc1bbc1146f94c8bf9f8cc <18ab3fc8e880791aa9f7c000261320fc812b5465"}, {"id": "dcac0b0d-e0d9-3520-b0a2-00ca6cccb6c6", "product": {"name": "Linux"}, "product_version": "patch: 6.12.64"}, {"id": "dd602898-7957-3bdc-a114-3f89d864bf9e", "product": {"name": "Linux"}, "product_version": "d8f2f498d9ed0c5010bc1bbc1146f94c8bf9f8cc <e23f46f1a971c73dad2fd63e1408696114ddebe2"}, {"id": "e502266d-d6dd-3e66-aae7-18d1307ebe42", "product": {"name": "Linux"}, "product_version": "421e1fadb0b0a648cc75afd5b3c826fa7daeaffc"}, {"id": "f11dc508-bfb4-3e3a-9b41-2351754108de", "product": {"name": "Linux"}, "product_version": "patch: 6.6.120"}], "enisaIdVendor": [{"id": "7e30a037-555f-3ef7-bbf5-6179d23038d9", "vendor": {"name": "Linux"}}], "isExploited": false}