{"id": "EUVD-2024-50487", "enisaUuid": "f20aa022-2a06-3027-8eda-639d638b982c", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\ndrm/panthor: Be stricter about IO mapping flags\n\nThe current panthor_device_mmap_io() implementation has two issues:\n\n1. For mapping DRM_PANTHOR_USER_FLUSH_ID_MMIO_OFFSET,\n   panthor_device_mmap_io() bails if VM_WRITE is set, but does not clear\n   VM_MAYWRITE. That means userspace can use mprotect() to make the mapping\n   writable later on. This is a classic Linux driver gotcha.\n   I don't think this actually has any impact in practice:\n   When the GPU is powered, writes to the FLUSH_ID seem to be ignored; and\n   when the GPU is not powered, the dummy_latest_flush page provided by the\n   driver is deliberately designed to not do any flushes, so the only thing\n   writing to the dummy_latest_flush could achieve would be to make *more*\n   flushes happen.\n\n2. panthor_device_mmap_io() does not block MAP_PRIVATE mappings (which are\n   mappings without the VM_SHARED flag).\n   MAP_PRIVATE in combination with VM_MAYWRITE indicates that the VMA has\n   copy-on-write semantics, which for VM_PFNMAP are semi-supported but\n   fairly cursed.\n   In particular, in such a mapping, the driver can only install PTEs\n   during mmap() by calling remap_pfn_range() (because remap_pfn_range()\n   wants to **store the physical address of the mapped physical memory into\n   the vm_pgoff of the VMA**); installing PTEs later on with a fault\n   handler (as panthor does) is not supported in private mappings, and so\n   if you try to fault in such a mapping, vmf_insert_pfn_prot() splats when\n   it hits a BUG() check.\n\nFix it by clearing the VM_MAYWRITE flag (userspace writing to the FLUSH_ID\ndoesn't make sense) and requiring VM_SHARED (copy-on-write semantics for\nthe FLUSH_ID don't make sense).\n\nReproducers for both scenarios are in the notes of my patch on the mailing\nlist; I tested that these bugs exist on a Rock 5B machine.\n\nNote that I only compile-tested the patch, I haven't tested it; I don't\nhave a working kernel build setup for the test machine yet. Please test it\nbefore applying it.", "datePublished": "2024-11-19T17:22:38", "dateUpdated": "2025-10-01T20:17:16", "baseScore": 5.5, "baseScoreVersion": "3.1", "baseScoreVector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H", "references": ["https://git.kernel.org/stable/c/2604afd65043e8f9d4be036cb1242adf6b5723cf", "https://git.kernel.org/stable/c/f432a1621f049bb207e78363d9d0e3c6fa2da5db"], "aliases": ["CVE-2024-53071"], "assigner": "Linux", "epss": 0.04, "enisaIdProduct": [{"id": "1c80d4c5-d73c-3f49-b6d4-8fc0e0ad546f", "product": {"name": "Linux"}, "product_version": "patch: 6.11.8"}, {"id": "3b8221e8-0cac-394d-8cb7-5563486c227a", "product": {"name": "Linux"}, "product_version": "6.10"}, {"id": "7625c297-de00-3c21-9140-db09aa510791", "product": {"name": "Linux"}, "product_version": "5fe909cae118a757a77afb37174b99436a36d2e2 <2604afd65043e8f9d4be036cb1242adf6b5723cf"}, {"id": "78a224ba-3c5e-34a6-ac9a-0fbf1cee4599", "product": {"name": "Linux"}, "product_version": "5fe909cae118a757a77afb37174b99436a36d2e2 <f432a1621f049bb207e78363d9d0e3c6fa2da5db"}, {"id": "9cfcef13-02e1-3308-acdd-97f35c54c591", "product": {"name": "Linux"}, "product_version": "patch: 6.12"}, {"id": "f9aed988-cd94-3266-a0c1-15b8df80c5e5", "product": {"name": "Linux"}, "product_version": "patch: 0"}], "enisaIdVendor": [{"id": "ccb07f50-969e-3cf1-ae69-4d76289d3e35", "vendor": {"name": "Linux"}}], "isExploited": false}