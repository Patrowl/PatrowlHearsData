{"id": "EUVD-2024-45144", "enisaUuid": "e0ce0534-ba6b-3a1a-873e-41670b14ba18", "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nnfsd: cancel nfsd_shrinker_work using sync mode in nfs4_state_shutdown_net\n\nIn the normal case, when we excute `echo 0 > /proc/fs/nfsd/threads`, the\nfunction `nfs4_state_destroy_net` in `nfs4_state_shutdown_net` will\nrelease all resources related to the hashed `nfs4_client`. If the\n`nfsd_client_shrinker` is running concurrently, the `expire_client`\nfunction will first unhash this client and then destroy it. This can\nlead to the following warning. Additionally, numerous use-after-free\nerrors may occur as well.\n\nnfsd_client_shrinker         echo 0 > /proc/fs/nfsd/threads\n\nexpire_client                nfsd_shutdown_net\n  unhash_client                ...\n                               nfs4_state_shutdown_net\n                                 /* won't wait shrinker exit */\n  /*                             cancel_work(&nn->nfsd_shrinker_work)\n   * nfsd_file for this          /* won't destroy unhashed client1 */\n   * client1 still alive         nfs4_state_destroy_net\n   */\n\n                               nfsd_file_cache_shutdown\n                                 /* trigger warning */\n                                 kmem_cache_destroy(nfsd_file_slab)\n                                 kmem_cache_destroy(nfsd_file_mark_slab)\n  /* release nfsd_file and mark */\n  __destroy_client\n\n====================================================================\nBUG nfsd_file (Not tainted): Objects remaining in nfsd_file on\n__kmem_cache_shutdown()\n--------------------------------------------------------------------\nCPU: 4 UID: 0 PID: 764 Comm: sh Not tainted 6.12.0-rc3+ #1\n\n dump_stack_lvl+0x53/0x70\n slab_err+0xb0/0xf0\n __kmem_cache_shutdown+0x15c/0x310\n kmem_cache_destroy+0x66/0x160\n nfsd_file_cache_shutdown+0xac/0x210 [nfsd]\n nfsd_destroy_serv+0x251/0x2a0 [nfsd]\n nfsd_svc+0x125/0x1e0 [nfsd]\n write_threads+0x16a/0x2a0 [nfsd]\n nfsctl_transaction_write+0x74/0xa0 [nfsd]\n vfs_write+0x1a5/0x6d0\n ksys_write+0xc1/0x160\n do_syscall_64+0x5f/0x170\n entry_SYSCALL_64_after_hwframe+0x76/0x7e\n\n====================================================================\nBUG nfsd_file_mark (Tainted: G    B   W         ): Objects remaining\nnfsd_file_mark on __kmem_cache_shutdown()\n--------------------------------------------------------------------\n\n dump_stack_lvl+0x53/0x70\n slab_err+0xb0/0xf0\n __kmem_cache_shutdown+0x15c/0x310\n kmem_cache_destroy+0x66/0x160\n nfsd_file_cache_shutdown+0xc8/0x210 [nfsd]\n nfsd_destroy_serv+0x251/0x2a0 [nfsd]\n nfsd_svc+0x125/0x1e0 [nfsd]\n write_threads+0x16a/0x2a0 [nfsd]\n nfsctl_transaction_write+0x74/0xa0 [nfsd]\n vfs_write+0x1a5/0x6d0\n ksys_write+0xc1/0x160\n do_syscall_64+0x5f/0x170\n entry_SYSCALL_64_after_hwframe+0x76/0x7e\n\nTo resolve this issue, cancel `nfsd_shrinker_work` using synchronous\nmode in nfs4_state_shutdown_net.", "datePublished": "2024-11-05T17:10:50", "dateUpdated": "2025-11-03T20:43:43", "baseScore": 7.8, "baseScoreVersion": "3.1", "baseScoreVector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "references": ["https://git.kernel.org/stable/c/f67138dd338cb564ade7d3755c8cd4f68b46d397", "https://git.kernel.org/stable/c/5ade4382de16c34d9259cb548f36ec5c4555913c", "https://git.kernel.org/stable/c/36775f42e039b01d4abe8998bf66771a37d3cdcc", "https://git.kernel.org/stable/c/f965dc0f099a54fca100acf6909abe52d0c85328", "https://git.kernel.org/stable/c/add1df5eba163a3a6ece11cb85890e2e410baaea", "https://git.kernel.org/stable/c/d5ff2fb2e7167e9483846e34148e60c0c016a1f6", "https://nvd.nist.gov/vuln/detail/CVE-2024-50121", "https://lists.debian.org/debian-lts-announce/2025/03/msg00001.html", "https://lists.debian.org/debian-lts-announce/2025/03/msg00002.html"], "aliases": ["CVE-2024-50121"], "assigner": "Linux", "epss": 0.02, "enisaIdProduct": [{"id": "008c6a92-5168-3a58-9cf2-9dc231ef7eb1", "product": {"name": "Linux"}, "product_version": "patch: 6.1.123"}, {"id": "030c0a1a-5d79-332b-8787-6fad0b9539b0", "product": {"name": "Linux"}, "product_version": "f3ea5ec83d1a827f074b2b660749817e0bf2b23e <36775f42e039b01d4abe8998bf66771a37d3cdcc"}, {"id": "1432bc25-7454-3cc5-ad40-0899694a635c", "product": {"name": "Linux"}, "product_version": "958294a3eb82026fcfff20b0287a90e9c854785e <5ade4382de16c34d9259cb548f36ec5c4555913c"}, {"id": "1d4d4301-7af1-3949-aa71-30abcc9c3ed1", "product": {"name": "Linux"}, "product_version": "2bbf10861d51dae76c6da7113516d0071c782653 <f67138dd338cb564ade7d3755c8cd4f68b46d397"}, {"id": "5ab20de1-1068-3152-865a-b98efd327ffb", "product": {"name": "Linux"}, "product_version": "7c24fa225081f31bc6da6a355c1ba801889ab29a <f965dc0f099a54fca100acf6909abe52d0c85328"}, {"id": "6a0986a5-e0c7-3eb6-bfd4-41f5507175cb", "product": {"name": "Linux"}, "product_version": "patch: 5.15.176"}, {"id": "7ac71712-3490-3161-8b24-6fe4ba9f7fc2", "product": {"name": "Linux"}, "product_version": "7c24fa225081f31bc6da6a355c1ba801889ab29a <d5ff2fb2e7167e9483846e34148e60c0c016a1f6"}, {"id": "7f4207ba-9b68-3aad-9578-84f6fc8b530c", "product": {"name": "Linux"}, "product_version": "7c24fa225081f31bc6da6a355c1ba801889ab29a <add1df5eba163a3a6ece11cb85890e2e410baaea"}, {"id": "80fcc1ea-c694-3cec-a7d4-191546033673", "product": {"name": "Linux"}, "product_version": "patch: 5.10.233"}, {"id": "964bcac1-776e-3c56-9bc8-1a3995fe4c76", "product": {"name": "Linux"}, "product_version": "6.2"}, {"id": "9b10a930-91d9-34c8-8c51-eec8a8670aa3", "product": {"name": "Linux"}, "product_version": "patch: 6.11.6"}, {"id": "accda0a4-750c-381d-b72f-0c339f41372d", "product": {"name": "Linux"}, "product_version": "patch: 6.6.59"}, {"id": "c8a10493-80ed-3549-b660-498564b11da6", "product": {"name": "Linux"}, "product_version": "patch: 0"}, {"id": "fd7a1e53-8fe1-39c3-9ad6-3fa134901299", "product": {"name": "Linux"}, "product_version": "patch: 6.12"}], "enisaIdVendor": [{"id": "60316494-9581-393b-9e6b-8a070b73ca1c", "vendor": {"name": "Linux"}}], "isExploited": false}