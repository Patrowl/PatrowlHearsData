{"publishedDate": "2024-12-27T14:15Z", "lastModifiedDate": "2025-02-11T16:15Z", "cve": {"data_type": "CVE", "data_format": "MITRE", "data_version": "1.0", "CVE_data_meta": {"ID": "CVE-2024-56541", "ASSIGNER": "416baaa9-dc9f-4396-8d5f-8c081fb06d67"}, "description": {"description_data": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nwifi: ath12k: fix use-after-free in ath12k_dp_cc_cleanup()\n\nDuring ath12k module removal, in ath12k_core_deinit(),\nath12k_mac_destroy() un-registers ah->hw from mac80211 and frees\nthe ah->hw as well as all the ar's in it. After this\nath12k_core_soc_destroy()-> ath12k_dp_free()-> ath12k_dp_cc_cleanup()\ntries to access one of the freed ar's from pending skb.\n\nThis is because during mac destroy, driver failed to flush few\ndata packets, which were accessed later in ath12k_dp_cc_cleanup()\nand freed, but using ar from the packet led to this use-after-free.\n\nBUG: KASAN: use-after-free in ath12k_dp_cc_cleanup.part.0+0x5e2/0xd40 [ath12k]\nWrite of size 4 at addr ffff888150bd3514 by task modprobe/8926\nCPU: 0 UID: 0 PID: 8926 Comm: modprobe Not tainted\n6.11.0-rc2-wt-ath+ #1746\nHardware name: Intel(R) Client Systems NUC8i7HVK/NUC8i7HVB, BIOS\nHNKBLi70.86A.0067.2021.0528.1339 05/28/2021\n\nCall Trace:\n  <TASK>\n  dump_stack_lvl+0x7d/0xe0\n  print_address_description.constprop.0+0x33/0x3a0\n  print_report+0xb5/0x260\n  ? kasan_addr_to_slab+0x24/0x80\n  kasan_report+0xd8/0x110\n  ? ath12k_dp_cc_cleanup.part.0+0x5e2/0xd40 [ath12k]\n  ? ath12k_dp_cc_cleanup.part.0+0x5e2/0xd40 [ath12k]\n  kasan_check_range+0xf3/0x1a0\n  __kasan_check_write+0x14/0x20\n  ath12k_dp_cc_cleanup.part.0+0x5e2/0xd40 [ath12k]\n  ath12k_dp_free+0x178/0x420 [ath12k]\n  ath12k_core_stop+0x176/0x200 [ath12k]\n  ath12k_core_deinit+0x13f/0x210 [ath12k]\n  ath12k_pci_remove+0xad/0x1c0 [ath12k]\n  pci_device_remove+0x9b/0x1b0\n  device_remove+0xbf/0x150\n  device_release_driver_internal+0x3c3/0x580\n  ? __kasan_check_read+0x11/0x20\n  driver_detach+0xc4/0x190\n  bus_remove_driver+0x130/0x2a0\n  driver_unregister+0x68/0x90\n  pci_unregister_driver+0x24/0x240\n  ? find_module_all+0x13e/0x1e0\n  ath12k_pci_exit+0x10/0x20 [ath12k]\n  __do_sys_delete_module+0x32c/0x580\n  ? module_flags+0x2f0/0x2f0\n  ? kmem_cache_free+0xf0/0x410\n  ? __fput+0x56f/0xab0\n  ? __fput+0x56f/0xab0\n  ? debug_smp_processor_id+0x17/0x20\n  __x64_sys_delete_module+0x4f/0x70\n  x64_sys_call+0x522/0x9f0\n  do_syscall_64+0x64/0x130\n  entry_SYSCALL_64_after_hwframe+0x4b/0x53\nRIP: 0033:0x7f8182c6ac8b\n\nCommit 24de1b7b231c (\"wifi: ath12k: fix flush failure in recovery\nscenarios\") added the change to decrement the pending packets count\nin case of recovery which make sense as ah->hw as well all\nar's in it are intact during recovery, but during core deinit there\nis no use in decrementing packets count or waking up the empty waitq\nas the module is going to be removed also ar's from pending skb's\ncan't be used and the packets should just be released back.\n\nTo fix this, avoid accessing ar from skb->cb when driver is being\nunregistered.\n\nTested-on: QCN9274 hw2.0 PCI WLAN.WBE.1.1.1-00214-QCAHKSWPL_SILICONZ-1\nTested-on: WCN7850 hw2.0 PCI WLAN.HMT.1.0.c5-00481-QCAHMTSWPL_V1.0_V2.0_SILICONZ-3"}, {"lang": "es", "value": "En el kernel de Linux, se ha resuelto la siguiente vulnerabilidad: wifi: ath12k: arreglo de use-after-free en ath12k_dp_cc_cleanup() Durante la eliminaci\u00f3n del m\u00f3dulo ath12k, en ath12k_core_deinit(), ath12k_mac_destroy() anula el registro de ah-&gt;hw de mac80211 y libera el ah-&gt;hw as\u00ed como todos los ar en \u00e9l. Despu\u00e9s de esto, ath12k_core_soc_destroy()-&gt; ath12k_dp_free()-&gt; ath12k_dp_cc_cleanup() intenta acceder a uno de los ar liberados del skb pendiente. Esto se debe a que durante la destrucci\u00f3n de mac, el controlador no pudo limpiar algunos paquetes de datos, a los que se accedi\u00f3 m\u00e1s tarde en ath12k_dp_cc_cleanup() y se liberaron, pero el uso de ar del paquete provoc\u00f3 este use-after-free. ERROR: KASAN: use-after-free en ath12k_dp_cc_cleanup.part.0+0x5e2/0xd40 [ath12k] Escritura de tama\u00f1o 4 en la direcci\u00f3n ffff888150bd3514 por la tarea modprobe/8926 CPU: 0 UID: 0 PID: 8926 Comm: modprobe No contaminado 6.11.0-rc2-wt-ath+ #1746 Nombre del hardware: Intel(R) Client Systems NUC8i7HVK/NUC8i7HVB, BIOS HNKBLi70.86A.0067.2021.0528.1339 28/05/2021 Seguimiento de llamadas:  dump_stack_lvl+0x7d/0xe0 direcci\u00f3n_de_impresi\u00f3n_descripci\u00f3n.constprop.0+0x33/0x3a0 informe_de_impresi\u00f3n+0xb5/0x260 ? direcci\u00f3n_kasan_a_losa+0x24/0x80 informe_kasan+0xd8/0x110 ? ath12k_dp_cc_cleanup.part.0+0x5e2/0xd40 [ath12k] ? ath12k_dp_cc_cleanup.part.0+0x5e2/0xd40 [ath12k] rango de comprobaci\u00f3n de kasan+0xf3/0x1a0 __comprobaci\u00f3n de escritura de kasan+0x14/0x20 ath12k_dp_cc_cleanup.part.0+0x5e2/0xd40 [ath12k] dp_free+0x178/0x420 [ath12k] n\u00facleo_detenci\u00f3n+0x176/0x200 [ath12k] n\u00facleo_deinit+0x13f/0x210 [ath12k] eliminaci\u00f3n de pci+0xad/0x1c0 [ath12k] eliminaci\u00f3n de dispositivo pci+0x9b/0x1b0 dispositivo_eliminar+0xbf/0x150 dispositivo_liberaci\u00f3n_controlador_interno+0x3c3/0x580 ? __kasan_check_read+0x11/0x20 controlador_desconectar+0xc4/0x190 bus_eliminar_controlador+0x130/0x2a0 controlador_anular_registro+0x68/0x90 pci_anular_registro_controlador+0x24/0x240 ? buscar_m\u00f3dulo_todos+0x13e/0x1e0 ath12k_pci_exit+0x10/0x20 [ath12k] __do_sys_eliminar_m\u00f3dulo+0x32c/0x580 ? m\u00f3dulo_indicadores+0x2f0/0x2f0 ? kmem_cache_libre+0xf0/0x410 ? __fput+0x56f/0xab0 ? __fput+0x56f/0xab0 ? debug_smp_processor_id+0x17/0x20 __x64_sys_delete_module+0x4f/0x70 x64_sys_call+0x522/0x9f0 do_syscall_64+0x64/0x130 entry_SYSCALL_64_after_hwframe+0x4b/0x53 RIP: 0033:0x7f8182c6ac8b Commit 24de1b7b231c (\"wifi: ath12k: corregir falla de vaciado en escenarios de recuperaci\u00f3n\") agreg\u00f3 el cambio para disminuir el conteo de paquetes pendientes en caso de recuperaci\u00f3n, lo que tiene sentido ya que ah-&gt;hw y todos los ar en \u00e9l est\u00e1n intactos durante la recuperaci\u00f3n, pero durante la desincializaci\u00f3n del n\u00facleo no tiene sentido disminuir el conteo de paquetes o despertar el waitq vac\u00edo ya que el m\u00f3dulo tambi\u00e9n se eliminar\u00e1. Los paquetes de skb pendientes no se pueden usar y los paquetes deber\u00edan simplemente liberarse. Para solucionar esto, evite acceder a ar desde skb-&gt;cb cuando se est\u00e1 anulando el registro del controlador. Probado en: QCN9274 hw2.0 PCI WLAN.WBE.1.1.1-00214-QCAHKSWPL_SILICONZ-1 Probado en: WCN7850 hw2.0 PCI WLAN.HMT.1.0.c5-00481-QCAHMTSWPL_V1.0_V2.0_SILICONZ-3"}]}, "references": {"reference_data": [{"url": "https://git.kernel.org/stable/c/35be5018a2a4d1b07bdfcf957c81121d22d16355", "name": "", "refsource": "", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/bdb281103373fd80eb5c91cede1e115ba270b4e9", "name": "", "refsource": "", "tags": ["Patch"]}, {"url": "https://git.kernel.org/stable/c/e5e15c8b42923bfb6c84d3d906a9965d9a0f111d", "name": "", "refsource": "", "tags": ["Patch"]}]}, "problemtype": {"problemtype_data": [{"description": [{"lang": "en", "value": "CWE-416"}]}]}}, "impact": {"baseMetricV3": {"exploitabilityScore": 1.8, "impactScore": 5.9, "cvssV3": {"version": "3.1", "vectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H", "baseScore": 7.8, "baseSeverity": "HIGH", "attackVector": "LOCAL", "attackComplexity": "LOW", "privilegesRequired": "LOW", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "HIGH", "availabilityImpact": "HIGH"}}}, "configurations": {"CVE_data_version": "4.0", "nodes": [{"operator": "OR", "negate": false, "children": [], "cpe_match": [{"vulnerable": true, "cpe23Uri": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "matchCriteriaId": "158A6B22-9260-41D7-965A-A81798A5A969", "cpe_name": [], "versionStartIncluding": "6.10", "versionEndExcluding": "6.11.11"}, {"vulnerable": true, "cpe23Uri": "cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*", "matchCriteriaId": "D8882B1B-2ABC-4838-AC1D-DBDBB5764776", "cpe_name": [], "versionStartIncluding": "6.12", "versionEndExcluding": "6.12.2"}]}]}}