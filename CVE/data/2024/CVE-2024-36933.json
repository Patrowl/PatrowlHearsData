{"cve": {"data_type": "CVE", "data_format": "MITRE", "data_version": "4.0", "CVE_data_meta": {"ID": "CVE-2024-36933", "ASSIGNER": "cve@kernel.org"}, "problemtype": {"problemtype_data": [{"description": []}]}, "references": {"reference_data": [{"url": "https://git.kernel.org/stable/c/29a07f2ee4d273760c2acbfc756e29eccd82470a", "name": "https://git.kernel.org/stable/c/29a07f2ee4d273760c2acbfc756e29eccd82470a", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/29a07f2ee4d273760c2acbfc756e29eccd82470a", "name": "https://git.kernel.org/stable/c/29a07f2ee4d273760c2acbfc756e29eccd82470a", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/37ed6f244ec5bda2e90b085084e322ea55d0aaa2", "name": "https://git.kernel.org/stable/c/37ed6f244ec5bda2e90b085084e322ea55d0aaa2", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/37ed6f244ec5bda2e90b085084e322ea55d0aaa2", "name": "https://git.kernel.org/stable/c/37ed6f244ec5bda2e90b085084e322ea55d0aaa2", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/46134031c20fd313d03b90169d64b2e05ca6b65c", "name": "https://git.kernel.org/stable/c/46134031c20fd313d03b90169d64b2e05ca6b65c", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/46134031c20fd313d03b90169d64b2e05ca6b65c", "name": "https://git.kernel.org/stable/c/46134031c20fd313d03b90169d64b2e05ca6b65c", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/4b911a9690d72641879ea6d13cce1de31d346d79", "name": "https://git.kernel.org/stable/c/4b911a9690d72641879ea6d13cce1de31d346d79", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/4b911a9690d72641879ea6d13cce1de31d346d79", "name": "https://git.kernel.org/stable/c/4b911a9690d72641879ea6d13cce1de31d346d79", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/5a4603fbc285752d19e4b415466db18ef3617e4a", "name": "https://git.kernel.org/stable/c/5a4603fbc285752d19e4b415466db18ef3617e4a", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/5a4603fbc285752d19e4b415466db18ef3617e4a", "name": "https://git.kernel.org/stable/c/5a4603fbc285752d19e4b415466db18ef3617e4a", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/696d18bb59727a2e0526c0802a812620be1c9340", "name": "https://git.kernel.org/stable/c/696d18bb59727a2e0526c0802a812620be1c9340", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/696d18bb59727a2e0526c0802a812620be1c9340", "name": "https://git.kernel.org/stable/c/696d18bb59727a2e0526c0802a812620be1c9340", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/a7c2c3c1caabcb4a3d6c47284c397507aaf54fe9", "name": "https://git.kernel.org/stable/c/a7c2c3c1caabcb4a3d6c47284c397507aaf54fe9", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/a7c2c3c1caabcb4a3d6c47284c397507aaf54fe9", "name": "https://git.kernel.org/stable/c/a7c2c3c1caabcb4a3d6c47284c397507aaf54fe9", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/bbccf0caef2fa917d6d0692385a06ce3c262a216", "name": "https://git.kernel.org/stable/c/bbccf0caef2fa917d6d0692385a06ce3c262a216", "refsource": "", "tags": []}, {"url": "https://git.kernel.org/stable/c/bbccf0caef2fa917d6d0692385a06ce3c262a216", "name": "https://git.kernel.org/stable/c/bbccf0caef2fa917d6d0692385a06ce3c262a216", "refsource": "", "tags": []}, {"url": "https://lists.debian.org/debian-lts-announce/2024/06/msg00019.html", "name": "https://lists.debian.org/debian-lts-announce/2024/06/msg00019.html", "refsource": "", "tags": []}, {"url": "https://lists.debian.org/debian-lts-announce/2024/06/msg00020.html", "name": "https://lists.debian.org/debian-lts-announce/2024/06/msg00020.html", "refsource": "", "tags": []}, {"url": "https://security.netapp.com/advisory/ntap-20240912-0006/", "name": "https://security.netapp.com/advisory/ntap-20240912-0006/", "refsource": "", "tags": []}]}, "description": {"description_data": [{"lang": "en", "value": "In the Linux kernel, the following vulnerability has been resolved:\n\nnsh: Restore skb->{protocol,data,mac_header} for outer header in nsh_gso_segment().\n\nsyzbot triggered various splats (see [0] and links) by a crafted GSO\npacket of VIRTIO_NET_HDR_GSO_UDP layering the following protocols:\n\n  ETH_P_8021AD + ETH_P_NSH + ETH_P_IPV6 + IPPROTO_UDP\n\nNSH can encapsulate IPv4, IPv6, Ethernet, NSH, and MPLS.  As the inner\nprotocol can be Ethernet, NSH GSO handler, nsh_gso_segment(), calls\nskb_mac_gso_segment() to invoke inner protocol GSO handlers.\n\nnsh_gso_segment() does the following for the original skb before\ncalling skb_mac_gso_segment()\n\n  1. reset skb->network_header\n  2. save the original skb->{mac_heaeder,mac_len} in a local variable\n  3. pull the NSH header\n  4. resets skb->mac_header\n  5. set up skb->mac_len and skb->protocol for the inner protocol.\n\nand does the following for the segmented skb\n\n  6. set ntohs(ETH_P_NSH) to skb->protocol\n  7. push the NSH header\n  8. restore skb->mac_header\n  9. set skb->mac_header + mac_len to skb->network_header\n 10. restore skb->mac_len\n\nThere are two problems in 6-7 and 8-9.\n\n  (a)\n  After 6 & 7, skb->data points to the NSH header, so the outer header\n  (ETH_P_8021AD in this case) is stripped when skb is sent out of netdev.\n\n  Also, if NSH is encapsulated by NSH + Ethernet (so NSH-Ethernet-NSH),\n  skb_pull() in the first nsh_gso_segment() will make skb->data point\n  to the middle of the outer NSH or Ethernet header because the Ethernet\n  header is not pulled by the second nsh_gso_segment().\n\n  (b)\n  While restoring skb->{mac_header,network_header} in 8 & 9,\n  nsh_gso_segment() does not assume that the data in the linear\n  buffer is shifted.\n\n  However, udp6_ufo_fragment() could shift the data and change\n  skb->mac_header accordingly as demonstrated by syzbot.\n\n  If this happens, even the restored skb->mac_header points to\n  the middle of the outer header.\n\nIt seems nsh_gso_segment() has never worked with outer headers so far.\n\nAt the end of nsh_gso_segment(), the outer header must be restored for\nthe segmented skb, instead of the NSH header.\n\nTo do that, let's calculate the outer header position relatively from\nthe inner header and set skb->{data,mac_header,protocol} properly.\n\n[0]:\nBUG: KMSAN: uninit-value in ipvlan_process_outbound drivers/net/ipvlan/ipvlan_core.c:524 [inline]\nBUG: KMSAN: uninit-value in ipvlan_xmit_mode_l3 drivers/net/ipvlan/ipvlan_core.c:602 [inline]\nBUG: KMSAN: uninit-value in ipvlan_queue_xmit+0xf44/0x16b0 drivers/net/ipvlan/ipvlan_core.c:668\n ipvlan_process_outbound drivers/net/ipvlan/ipvlan_core.c:524 [inline]\n ipvlan_xmit_mode_l3 drivers/net/ipvlan/ipvlan_core.c:602 [inline]\n ipvlan_queue_xmit+0xf44/0x16b0 drivers/net/ipvlan/ipvlan_core.c:668\n ipvlan_start_xmit+0x5c/0x1a0 drivers/net/ipvlan/ipvlan_main.c:222\n __netdev_start_xmit include/linux/netdevice.h:4989 [inline]\n netdev_start_xmit include/linux/netdevice.h:5003 [inline]\n xmit_one net/core/dev.c:3547 [inline]\n dev_hard_start_xmit+0x244/0xa10 net/core/dev.c:3563\n __dev_queue_xmit+0x33ed/0x51c0 net/core/dev.c:4351\n dev_queue_xmit include/linux/netdevice.h:3171 [inline]\n packet_xmit+0x9c/0x6b0 net/packet/af_packet.c:276\n packet_snd net/packet/af_packet.c:3081 [inline]\n packet_sendmsg+0x8aef/0x9f10 net/packet/af_packet.c:3113\n sock_sendmsg_nosec net/socket.c:730 [inline]\n __sock_sendmsg net/socket.c:745 [inline]\n __sys_sendto+0x735/0xa10 net/socket.c:2191\n __do_sys_sendto net/socket.c:2203 [inline]\n __se_sys_sendto net/socket.c:2199 [inline]\n __x64_sys_sendto+0x125/0x1c0 net/socket.c:2199\n do_syscall_x64 arch/x86/entry/common.c:52 [inline]\n do_syscall_64+0xcf/0x1e0 arch/x86/entry/common.c:83\n entry_SYSCALL_64_after_hwframe+0x63/0x6b\n\nUninit was created at:\n slab_post_alloc_hook mm/slub.c:3819 [inline]\n slab_alloc_node mm/slub.c:3860 [inline]\n __do_kmalloc_node mm/slub.c:3980 [inline]\n __kmalloc_node_track_caller+0x705/0x1000 mm/slub.c:4001\n kmalloc_reserve+0x249/0x4a0 net/core/skbuff.c:582\n __\n---truncated---"}]}}, "configurations": {"CVE_data_version": "4.0", "nodes": []}, "impact": {}, "publishedDate": "2024-05-30T16:15Z", "lastModifiedDate": "2024-11-21T09:22Z"}